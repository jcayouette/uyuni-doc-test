<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security :: Uyuni Documentation (Prototype)</title>
    <meta name="generator" content="Antora 1.0.3">
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="stylesheet" href="../../_/css/site-extra.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css">
    <!-- fetched from https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css -->
    <link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <a href="https://jcayouette.github.io/personal-blog">Belief and Reason</a>
        <span class="separator">//</span>
        <a href="../..">Library</a>
      </div>
      <div class="navbar-item">
        <input id="search-input" type="text" placeholder="Search docs">
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <div class="navbar-link">Projects</div>
          <div class="navbar-dropdown">
            <div class="navbar-item"><strong>Resources</strong></div>
            <a class="navbar-item" href="https://github.com/jcayouette/personal-blog">Repository</a>
            <a class="navbar-item" href="https://github.com/jcayouette/personal-blog/issues">Issue Tracker</a>
<!--
            <hr class="navbar-divider">
            <div class="navbar-item"><strong>Custom UI (coming soon!)</strong></div>
            <a class="navbar-item" href="https://gitlab.com/antora/antora-ui-default">Repository</a>
            <a class="navbar-item" href="https://gitlab.com/antora/antora-ui-default/issues">Issue Tracker</a>
            <hr class="navbar-divider">
          -->
            <a class="navbar-item" href="https://github.com/jcayouette/blob/master/contributing.adoc">Contributing</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <div class="navbar-link">Community</div>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="https://discord.gg/vmrAYE3">Discord Chat</a>
          </div>
        </div>
        <a class="navbar-item" href="https://twitter.com/BaR-project">
          <span class="icon">
            <svg aria-hidden="true" data-icon="twitter" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
              <path fill="#57aaee" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path>
            </svg>
          </span>
        </a>
      </div>
    </div>
  </nav>
</header>
<div class="main-wrapper">
<div class="navigation-container" data-component="uyuni" data-version="dev">
  <aside class="navigation">
    <div class="panels">
<div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="MAIN-manager.html">Uyuni</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="book_mgr_getting_started.html">Getting Started</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="quickstart3_chap_install_overview.html">Overview and Requirements</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.introduction">Introduction</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.prereq">Prerequisites for Installation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.prereq.scc">SUSE SCC Credentials</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.prereq.installmedia">Get Uyuni</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.prereq.hardware">Hardware Requirements</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.prereq.network">Network Requirements</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.prereq.clientos">Supported Client Systems</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="quickstart3_chap_suma_installation_jeos.html">Installation via JeOS</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.kvm.settings">Configuring KVM</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#jeos.kvm.settings">JeOS KVM Settings</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#jeos.susemgr.prep">Preparing JeOS for Uyuni</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quickstart3_chap_suma_installation_sles.html">Installation via SLES</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quickstart3_chap_suma_setup_with_yast.html">Setup and Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quickstart3_chap_suma_keys_and_first_client.html">Connecting Clients</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quickstart3_chap_suma_salt_gs.html">Introduction to Salt</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="book_mgr_best_practices.html">Best Practices</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="book_suma_reference_manual.html">WebUI Reference</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="book_suma_advanced_topics.html">Advanced Topics</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="navigation-explore" data-panel="explore">
  <div class="context">
    <span class="title">Uyuni</span>
    <span class="version">dev</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Uyuni</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="MAIN-manager.html">dev</a>
        </li>
        <li class="version">
          <a href="../3.2/MAIN-manager.html">3.2</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
  <main class="main">
<div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
  <a href="MAIN-manager.html" class="home-link"></a>
<nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="MAIN-manager.html">Uyuni</a></li>
    <li class="crumb"><a href="advanced_topics_security.html">Security</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="versions-menu-toggle" title="Show other versions of page">dev</button>
  <div class="versions-menu">
    <a class="version is-current" href="advanced_topics_security.html">dev</a>
    <a class="version" href="../3.2/advanced_topics_security.html">3.2</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/jcayouette/uyuni-doc-test/edit/master/docs/modules/ROOT/pages/advanced_topics_security.adoc">Edit this Page</a></div>
</div>
<article class="doc">
<h1>Security</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#at.security">Setup a Minion to Master Validation Fingerprint</a></li>
<li><a href="#_signing_repository_metadata">Signing Repository Metadata</a>
<ul class="sectlevel2">
<li><a href="#_generate_a_custom_gpg_key">Generate a Custom GPG key</a></li>
<li><a href="#_configure_signing_metadata">Configure signing metadata</a></li>
<li><a href="#_regenerate_all_metadata">Regenerate all metadata</a></li>
<li><a href="#_trust_the_gpg_key_on_all_clients">Trust the GPG key on all clients</a></li>
</ul>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="at.security"><a class="anchor" href="#at.security"></a><a class="link" href="#at.security">Setup a Minion to Master Validation Fingerprint</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>In highly secure network configurations you may wish to ensure your minions are connecting a specific master.
To setup validation from minion to master enter the masters fingerprint within the <code class="path">/etc/salt/minion</code> configuration file.
See the following procedure:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the master enter the following command as root and note the fingerprint:</p>
<div class="listingblock">
<div class="content">
<pre>salt-key -F master</pre>
</div>
</div>
<div class="paragraph">
<p>On your minion, open the minion configuration file located in <code class="path">/etc/salt/minion</code>.
Uncomment the following line and enter the masters fingerprint replacing the example fingerprint:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>master_finger: 'ba:30:65:2a:d6:9e:20:4f:d8:b2:f3:a7:d4:65:11:13'</pre>
</div>
</div>
</li>
<li>
<p>Restart the salt-minion service:</p>
<div class="listingblock">
<div class="content">
<pre># systemctl restart salt-minion</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>For more information on configuring security from a minion see: <a href="https://docs.saltstack.com/en/latest/ref/configuration/minion.html" class="bare">https://docs.saltstack.com/en/latest/ref/configuration/minion.html</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_signing_repository_metadata"><a class="anchor" href="#_signing_repository_metadata"></a><a class="link" href="#_signing_repository_metadata">Signing Repository Metadata</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_generate_a_custom_gpg_key"><a class="anchor" href="#_generate_a_custom_gpg_key"></a><a class="link" href="#_generate_a_custom_gpg_key">Generate a Custom GPG key</a></h3>
<div class="paragraph">
<p>To sign repository metadata a custom GPG key is required. Create a new GPG key as <strong>root</strong> via the following steps.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$&gt; gpg --gen-key

Please select what kind of key you want:
   (1) RSA and RSA (default)
   (2) DSA and Elgamal
   (3) DSA (sign only)
   (4) RSA (sign only)
Your selection? 1
RSA keys may be between 1024 and 4096 bits long.
What keysize do you want? (2048)
Requested keysize is 2048 bits
Please specify how long the key should be valid.
         0 = key does not expire
      &lt;n&gt;  = key expires in n days
      &lt;n&gt;w = key expires in n weeks
      &lt;n&gt;m = key expires in n months
      &lt;n&gt;y = key expires in n years
Key is valid for? (0)
Key does not expire at all
Is this correct? (y/N) y

GnuPG needs to construct a user ID to identify your key.

Real name: company sign key
Email address: company@example.com
Comment:
You selected this USER-ID:
    "company sign key &lt;company@example.com&gt;"

Change (N)ame, (C)omment, (E)mail or (O)kay/(Q)uit? O
You need a Passphrase to protect your secret key.

gpg: key 607FABDB marked as ultimately trusted
public and secret key created and signed.

gpg: checking the trustdb
gpg: 3 marginal(s) needed, 1 complete(s) needed, PGP trust model
gpg: depth: 0  valid:   1  signed:   0  trust: 0-, 0q, 0n, 0m, 0f, 1u
pub   2048R/607FABDB 2018-07-09
      Key fingerprint = ACF5 4698 EC70 FD6A F8C9  942B A7A1 9301 607F ABDB
uid       [ultimate] company sign key &lt;company@example.com&gt;
sub   2048R/A812FA62 2018-07-09</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configure_signing_metadata"><a class="anchor" href="#_configure_signing_metadata"></a><a class="link" href="#_configure_signing_metadata">Configure signing metadata</a></h3>
<div class="paragraph">
<p>There are two configuration files which needs to be changed to enable signing of metadata.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code class="filename">/etc/rhn/signing.conf</code> to specify KEYID and PASSPHRASE</p>
</li>
<li>
<p><code class="filename">/etc/rhn/rhn.conf</code> to enable signing metadata</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Example for <code class="filename">/etc/rhn/signing.conf</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>KEYID="607FABDB"

GPGPASS="MySecretPassword"</pre>
</div>
</div>
<div class="paragraph">
<p>To enable signing of metadata please add the following in <code class="filename">/etc/rhn/rhn.conf</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sign_metadata = 1</pre>
</div>
</div>
<div class="paragraph">
<p>All spacewalk services must be restarted after modifying 'rhn.conf'.</p>
</div>
</div>
<div class="sect2">
<h3 id="_regenerate_all_metadata"><a class="anchor" href="#_regenerate_all_metadata"></a><a class="link" href="#_regenerate_all_metadata">Regenerate all metadata</a></h3>
<div class="paragraph">
<p>After enabling signing metadata, all metadata needs to be re-generated.
This can be done with a small SQL script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$&gt; spacewalk-sql -i
psql (9.6.9)
Type "help" for help.

susemanager=# insert into rhnRepoRegenQueue (id, CHANNEL_LABEL, REASON, FORCE)
susemanager-# (select sequence_nextval('rhn_repo_regen_queue_id_seq'), C.label, 'changed signing of metadata', 'Y' from rhnChannel C);
INSERT 0 40
susemanager=# \q
$&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_trust_the_gpg_key_on_all_clients"><a class="anchor" href="#_trust_the_gpg_key_on_all_clients"></a><a class="link" href="#_trust_the_gpg_key_on_all_clients">Trust the GPG key on all clients</a></h3>
<div class="paragraph">
<p>When this feature is enabled, all clients have to trust the new GPG key.
If the new GPG key is not imported on the client, installation or updating of packages is not possible.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Export the GPG key and make it availabel in the 'pub/' directory.</p>
<div class="listingblock">
<div class="content">
<pre># gpg --batch --export -a -o &lt;output filename&gt; &lt;KEYID&gt;
$&gt; gpg --batch --export -a -o /srv/www/htdocs/pub/company.key 607FABDB</pre>
</div>
</div>
</li>
<li>
<p>Import the GPG key on all clients</p>
<div class="paragraph">
<p>This can be done using a remote command on all clients</p>
</div>
<div class="listingblock">
<div class="content">
<pre># rpm --import http://&lt;server.domain.top/pub/keyname.key
$&gt; rpm --import http://suma-refhead-srv.mgr.suse.de/pub/company.key</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title=":bulb:"></i>
</td>
<td class="content">
<div class="title">Tip</div>
<div class="paragraph">
<p>For salt managed systems it might make sense to use a state to trust GPG keys.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</article>
  </main>
</div>
<footer class="footer">
  <p>Copyright (C) 2017-2018 <a href="https://jcayouette.github.io/personal-blog">Belief and Reason</a></p>
  <p>Except where otherwise noted, jcayouette.github.io/personal-blog, BoR, are licensed under the <a href="https://www.mozilla.org/en-US/MPL/2.0/">Mozilla Public License Version 2.0</a> (MPL-2.0).</p>
</footer>
<script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<!-- fetched from https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js -->
<script>
function focusSearchInput () { document.querySelector('#search-input').focus() }
var search = docsearch({
  appId: '#',
  apiKey: '#',
  indexName: '#',
  inputSelector: '#search-input',
  autocompleteOptions: { hint: false, keyboardShortcuts: ['s'] },
  algoliaOptions: { hitsPerPage: 10 }
}).autocomplete
search.on('autocomplete:closed', function () { search.autocomplete.setVal() })
focusSearchInput()
window.addEventListener('load', focusSearchInput)
</script>
<script src="../../_/js/site.js"></script>
<script src="../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>
  </body>
</html>
