<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salt Formulas and  :: Uyuni Documentation (Prototype)</title>
    <meta name="generator" content="Antora 1.0.3">
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="stylesheet" href="../../_/css/site-extra.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css">
    <!-- fetched from https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css -->
    <link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <a href="https://jcayouette.github.io/personal-blog">Belief and Reason</a>
        <span class="separator">//</span>
        <a href="../..">Library</a>
      </div>
      <div class="navbar-item">
        <input id="search-input" type="text" placeholder="Search docs">
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <div class="navbar-link">Projects</div>
          <div class="navbar-dropdown">
            <div class="navbar-item"><strong>Resources</strong></div>
            <a class="navbar-item" href="https://github.com/jcayouette/personal-blog">Repository</a>
            <a class="navbar-item" href="https://github.com/jcayouette/personal-blog/issues">Issue Tracker</a>
<!--
            <hr class="navbar-divider">
            <div class="navbar-item"><strong>Custom UI (coming soon!)</strong></div>
            <a class="navbar-item" href="https://gitlab.com/antora/antora-ui-default">Repository</a>
            <a class="navbar-item" href="https://gitlab.com/antora/antora-ui-default/issues">Issue Tracker</a>
            <hr class="navbar-divider">
          -->
            <a class="navbar-item" href="https://github.com/jcayouette/blob/master/contributing.adoc">Contributing</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <div class="navbar-link">Community</div>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="https://discord.gg/vmrAYE3">Discord Chat</a>
          </div>
        </div>
        <a class="navbar-item" href="https://twitter.com/BaR-project">
          <span class="icon">
            <svg aria-hidden="true" data-icon="twitter" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
              <path fill="#57aaee" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path>
            </svg>
          </span>
        </a>
      </div>
    </div>
  </nav>
</header>
<div class="main-wrapper">
<div class="navigation-container" data-component="uyuni" data-version="dev">
  <aside class="navigation">
    <div class="panels">
<div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="MAIN-manager.html">Uyuni</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="book_mgr_getting_started.html">Getting Started</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="quickstart3_chap_install_overview.html">Overview and Requirements</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.introduction">Introduction</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.prereq">Prerequisites for Installation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.prereq.scc">SUSE SCC Credentials</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.prereq.installmedia">Get Uyuni</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.prereq.hardware">Hardware Requirements</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.prereq.network">Network Requirements</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.prereq.clientos">Supported Client Systems</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="quickstart3_chap_suma_installation_jeos.html">Installation via JeOS</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.kvm.settings">Configuring KVM</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#jeos.kvm.settings">JeOS KVM Settings</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#jeos.susemgr.prep">Preparing JeOS for Uyuni</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quickstart3_chap_suma_installation_sles.html">Installation via SLES</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quickstart3_chap_suma_setup_with_yast.html">Setup and Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quickstart3_chap_suma_keys_and_first_client.html">Connecting Clients</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quickstart3_chap_suma_salt_gs.html">Introduction to Salt</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="book_mgr_best_practices.html">Best Practices</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="book_suma_reference_manual.html">WebUI Reference</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="book_suma_advanced_topics.html">Advanced Topics</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="navigation-explore" data-panel="explore">
  <div class="context">
    <span class="title">Uyuni</span>
    <span class="version">dev</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Uyuni</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="MAIN-manager.html">dev</a>
        </li>
        <li class="version">
          <a href="../3.2/MAIN-manager.html">3.2</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
  <main class="main">
<div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
  <a href="MAIN-manager.html" class="home-link"></a>
<nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="MAIN-manager.html">Uyuni</a></li>
    <li class="crumb"><a href="bp_chap_getting_started_with_salt_formulas.html">Salt Formulas and </a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="versions-menu-toggle" title="Show other versions of page">dev</button>
  <div class="versions-menu">
    <a class="version is-current" href="bp_chap_getting_started_with_salt_formulas.html">dev</a>
    <a class="version" href="../3.2/bp_chap_getting_started_with_salt_formulas.html">3.2</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/jcayouette/uyuni-doc-test/edit/master/docs/modules/ROOT/pages/bp_chap_getting_started_with_salt_formulas.adoc">Edit this Page</a></div>
</div>
<article class="doc">
<h1>Salt Formulas and </h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#best.practice.salt.formulas.what">What are Salt Formulas?</a></li>
<li><a href="#best.practice.salt.formulas.install">Installing Salt Formulas via RPM</a></li>
<li><a href="#best.practice.salt.formulas.filedir">File Structure Overview</a></li>
<li><a href="#best.practice.salt.formulas.pillar">Editing Pillar Data in </a>
<ul class="sectlevel2">
<li><a href="#salt.formulas.ex.edit-group">Simple edit-group Example</a></li>
</ul>
</li>
<li><a href="#best.practice.salt.formulas.writing">Writing Salt Formulas</a></li>
<li><a href="#best.practice.salt.formulas.data">Separating Data</a></li>
<li><a href="#best.practice.salt.formulas.pillardata"> Generated Pillar Data</a></li>
<li><a href="#best.practice.salt.formulas.req">Formula Requirements</a></li>
<li><a href="#best.practice.salt.formulas.using">Using Salt Formulas with </a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This chapter provides an introduction for using Salt Formulas with .
Creation of custom formulas will also be introduced.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="best.practice.salt.formulas.what"><a class="anchor" href="#best.practice.salt.formulas.what"></a><a class="link" href="#best.practice.salt.formulas.what">What are Salt Formulas?</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Formulas are collections of Salt States that have been pre-written by other Salt users and contain generic parameter fields.
Formulas allow for reliable reproduction of a specific configuration again and again.
Formulas can be installed from RPM packages or an external git repository.</p>
</div>
<div class="paragraph">
<p>The following list will help you in making the decision to use a state or a formula.</p>
</div>
<div class="ulist">
<div class="title">Formula Tips</div>
<ul>
<li>
<p>When writing states for trivial tasks, formulas are probably not worth the time investment.</p>
</li>
<li>
<p>For large, non-trivial configurations use formulas.</p>
</li>
<li>
<p>Formulas and States both act as a kind of configuration documentation.
Once written and stored you will have a snapshot of what your infrastructure should look like.</p>
</li>
<li>
<p>You can greatly decrease the amount of time required for writing a formula by grabbing one of the many pre-written formulas on github.
There are pre-written formulas for hundreds of configurations.
You can find these located at <a href="https://github.com/saltstack-formulas" class="bare">https://github.com/saltstack-formulas</a>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
<div class="title">Formula with Forms Improvements</div>
<div class="ulist">
<ul>
<li>
<p>Formula data can now be managed via the XMLRPC API</p>
</li>
<li>
<p>New types were added to help SUSE Manager handle almost any kind of upstream formula.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="best.practice.salt.formulas.install"><a class="anchor" href="#best.practice.salt.formulas.install"></a><a class="link" href="#best.practice.salt.formulas.install">Installing Salt Formulas via RPM</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>SUSE releases formulas as RPM packages.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
<div class="title">Formula Channel Location</div>
<div class="paragraph">
<p>Available formulas can be located within the <code class="systemitem">SUSE-Manager-Server-3.2-Pool</code> channel.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure: Installing Salt Formulas from an RPM</div>
<ol class="arabic">
<li>
<p>To search for available formulas, execute the following command on your  server:</p>
<div class="listingblock">
<div class="content">
<pre>zypper se --type package formula</pre>
</div>
</div>
<div class="paragraph">
<p>You will see a list of available Salt formulas:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>S | Name              | Summary                                                    | Type
--+-------------------+------------------------------------------------------------+-----------
  | locale-formula    | Locale Salt Formula for SUSE Manager                       | package</pre>
</div>
</div>
</li>
<li>
<p>For more information about a formula, run the following command:</p>
<div class="listingblock">
<div class="content">
<pre>zypper info locale-formula</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>Information for package locale-formula:
-----------------------------------------
Repository: SUSE-Manager-Server-{productnumber}-Pool
Name:  locale-formula
Version:  0.2-1.1
Arch: noarch
Vendor:  SUSE LLC &lt;https://www.suse.com/&gt;
Support Level: Level 3
Status: not installed
Installed Size: 47.9 KiB
Installed: No
Source package : locale-formula-0.2-1.1.src
Summary        : Locale Salt Formula for SUSE Manager
Description    : Salt Formula for SUSE Manager. Sets up the locale.</pre>
</div>
</div>
</li>
<li>
<p>To install a formula run as root:</p>
<div class="listingblock">
<div class="content">
<pre>zypper in locale-formula</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="best.practice.salt.formulas.filedir"><a class="anchor" href="#best.practice.salt.formulas.filedir"></a><a class="link" href="#best.practice.salt.formulas.filedir">File Structure Overview</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>RPM-based formulas must be placed in a specific directory structure to ensure proper functionality.
A formula always consists of two separate directories: The <code class="path">states</code> directory and the <code class="path">metadata</code> directory.
Folders in these directories need to have an exactly matching name, for example <code>locale</code>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">The Formula State Directory</dt>
<dd>
<p>The formula states directory contains anything necessary for a Salt state to work independently.
This includes <code class="path">.sls</code> files, a <code class="path">map.jinja</code> file and any other required files.
This directory should only be modified by RPMs and should not be edited manually.
For example, the <span class="package">locale-formula</span> states directory is located in:</p>
<div class="listingblock">
<div class="content">
<pre>/usr/share/susemanager/formulas/states/locale/</pre>
</div>
</div>
</dd>
<dt class="hdlist1">The Formula Metadata Directory</dt>
<dd>
<p>The metadata directory contains a <code class="path">form.yml</code>
file which defines the forms for 
and an optional <code class="path">metadata.yml</code>
file that can contain additional information about a formula.
For example, the <span class="package">locale-formula</span>
metadata directory is located in:</p>
<div class="listingblock">
<div class="content">
<pre>/usr/share/susemanager/formulas/metadata/locale/</pre>
</div>
</div>
</dd>
<dt class="hdlist1">Custom Formulas</dt>
<dd>
<p>Custom formula data or (non-RPM) formulas need to be placed into any state directory configured as a Salt file root:</p>
<div class="dlist">
<dl>
<dt class="hdlist1">State directory</dt>
<dd>
<p>Custom state formula data need to be placed in:</p>
<div class="listingblock">
<div class="content">
<pre>/srv/salt/custom/</pre>
</div>
</div>
</dd>
<dt class="hdlist1">Metadata Directory</dt>
<dd>
<p>Custom metadata (information) need to be placed in:</p>
<div class="listingblock">
<div class="content">
<pre>/srv/formula_metadata/custom/</pre>
</div>
</div>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>All custom folders located in the following directories needs to contain a <code class="path">form.yml</code> file.
These files are detected as form recipes and may be applied to groups and systems from the WebUI:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/srv/salt/formula_metadata/`custom-formula-name`/form.yml</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="best.practice.salt.formulas.pillar"><a class="anchor" href="#best.practice.salt.formulas.pillar"></a><a class="link" href="#best.practice.salt.formulas.pillar">Editing Pillar Data in </a></h2>
<div class="sectionbody">
<div class="paragraph">
<p> requires a file called <code class="path">form.yml</code>, to describe how formula data should look within the WebUI.
<code class="path">form.yml</code> is used by  to generate the desired form, with values editable by a user.</p>
</div>
<div class="paragraph">
<p>For example, the <code class="path">form.yml</code> that is included with the <span class="package">locale-formula</span> is placed in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/usr/share/susemanager/formulas/metadata/locale/form.yml</pre>
</div>
</div>
<div class="paragraph">
<p>See part of the following <span class="package">locale-formula</span> example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># This file is part of locale-formula.
#
# Foobar is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# Foobar is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with Foobar.  If not, see &lt;http://www.gnu.org/licenses/&gt;.

timezone:
  $type: group

  name:
    $type: select
    $values: ["CET",
              "CST6CDT",
              "EET",
              "EST",
              "EST5EDT",
              "GMT",
              "GMT+0",
              "GMT-0",
              "GMT0",
              "Greenwich",
              "HST",
              "MET",
              "MST",
              "MST7MDT",
              "NZ",
              "NZ-CHAT",
              "Navajo",
              "PST8PDT",
              "UCT",
              "UTC",
              "Universal",
              "W-SU",
              "WET",
              "Zulu",
              "Etc/GMT+1",
              "Etc/GMT+2",
              "Etc/GMT+3",
              "Etc/GMT+4",
              "Etc/GMT+5",
              "Etc/GMT+6",
              "Etc/GMT+7",
              "Etc/GMT+8",
              "Etc/GMT+9",
              "Etc/GMT+10",
              "Etc/GMT+11",
              "Etc/GMT+12",
              "Etc/GMT-1",
              "Etc/GMT-2",
              "Etc/GMT-3",
              "Etc/GMT-4",
              "Etc/GMT-5",
              "Etc/GMT-6",
              "Etc/GMT-7",
              "Etc/GMT-8",
              "Etc/GMT-9",
              "Etc/GMT-10",
              "Etc/GMT-11",
              "Etc/GMT-12",
              "Etc/GMT-13",
              "Etc/GMT-14",
              "Etc/GMT",
              "Etc/GMT+0",
              "Etc/GMT-0",
              "Etc/GMT0",
              "Etc/Greenwich",
              "Etc/UCT",
              "Etc/UTC",
              "Etc/Universal",
              "Etc/Zulu"
              ]
    $default: CET

  hardware_clock_set_to_utc:
    $type: boolean
    $default: True
...</pre>
</div>
</div>
<div class="paragraph">
<p><code class="path">form.yml</code> contains additional information that describes how the form for a pillar should look for .
This information is contained in attributes that always start with a <code>$</code> sign.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
<div class="title">Ignored Values</div>
<div class="paragraph">
<p>All values that start with a <code>$</code> sign are annotations used to display the UI that users interact with.
These annotations are not part of pillar data itself and are handled as metadata.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following are valid attributes.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">$type</dt>
<dd>
<p>The most important attribute is the <code>$type</code> attribute.
It defines the type of the pillar value and the form-field that is generated.
The following represent the supported types:</p>
<div class="ulist">
<ul>
<li>
<p><code>text</code></p>
</li>
<li>
<p><code>password</code></p>
</li>
<li>
<p><code>number</code></p>
</li>
<li>
<p><code>url</code></p>
</li>
<li>
<p><code>email</code></p>
</li>
<li>
<p><code>date</code></p>
</li>
<li>
<p><code>time</code></p>
</li>
<li>
<p><code>datetime</code></p>
</li>
<li>
<p><code>boolean</code></p>
</li>
<li>
<p><code>color</code></p>
</li>
<li>
<p><code>select</code></p>
</li>
<li>
<p><code>group</code></p>
</li>
<li>
<p><code>edit-group</code></p>
</li>
<li>
<p><code>namespace</code></p>
</li>
<li>
<p><code>hidden-group</code> (obsolete, renamed to <code>namespace</code>)</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
<div class="title">Text Attribute</div>
<div class="paragraph">
<p>The text attribute is the default and does not need to be specified explicitly.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Many of these values are self-explanatory:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>text</code> type generates a simple text field</p>
</li>
<li>
<p>The <code>password</code> type generates a password field</p>
</li>
<li>
<p>The <code>color</code> type generates a color picker.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>group</code>, <code>edit-group</code>, and <code>namespace</code> (formerly <code>hidden-group</code>) types do not generate an editable field and are used to structure form and pillar data.
The difference between <code>group</code> and <code>namespace</code> is <code>group</code> generates a visible border with a heading, and <code>namespace</code> shows nothing visually (and is only used to structure pillar data).
The difference between <code>group</code> and <code>edit-group</code> is <code>edit-group</code> allows to structure and restrict editable fields in a more flexible way.
For example, <code>edit-group</code> supports the <code>$minItems</code> and <code>$maxItems</code> attributes, and thus it simplifies complex and repeatable input structures.
For an <code>edit-group</code> example, see <a href="#salt.formulas.ex.edit-group">Simple edit-group Example</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">$default</dt>
<dd>
<p><code>$default</code> allows you to specify a default value that is displayed and used, if no other value is entered.
In an <code>edit-group</code> it allows to create initial members of the group and populate them with specified data.</p>
</dd>
<dt class="hdlist1">$name</dt>
<dd>
<p><code>$name</code> allows you to specify the name of a value that is shown in the form.
If this value is not set, the pillar name is used and capitalized without underscores and dashes.
You reference it in the same section with <code>${name}</code>.</p>
</dd>
<dt class="hdlist1">$help and $placeholder</dt>
<dd>
<p>The <code>$help</code> and <code>$placeholder</code> attributes are used to give a user a better understanding of what the value should be.</p>
<div class="ulist">
<ul>
<li>
<p><code>$help</code> defines the message a user sees when hovering over a field</p>
</li>
<li>
<p><code>$placeholder</code> displays a gray placeholder text in the field.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>$placeholder</code> may only be used with text fields like text, password, email or date.
It does not make sense to add a placeholder if you also use <code>$default</code> as this will hide the placeholder.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">$minItems and $maxItems</dt>
<dd>
<p>In an <code>edit-group</code>, <code>$minItems</code> and <code>$maxItems</code> allow you to specify the lowest and highest number the group can occur.</p>
</dd>
<dt class="hdlist1">$itemName</dt>
<dd>
<p>In an <code>edit-group</code>, <code>$itemName</code> allows to define a template for the name to be used for the members of the group.</p>
</dd>
<dt class="hdlist1">$prototype</dt>
<dd>
<p>In an <code>edit-group</code>, <code>$prototype</code> allows to define default (or pre-filled) values for newly added members in the group.</p>
</dd>
<dt class="hdlist1">$scope</dt>
<dd>
<p><code>$scope</code> allows you to specify a hierarchy level at which a value may be edited.
Possible values are <code>system</code>, <code>group</code> and <code>readonly</code>.</p>
<div class="paragraph">
<p>The default <code>$scope: system</code> allows values to be edited at group and system levels.
A value can be entered for each system but if no value is entered the system will fall back to the group default.</p>
</div>
<div class="paragraph">
<p>If using <code>$scope: group</code>, a value may only be edited for a group.
On the system level you will be able to see the value, but not edit it.</p>
</div>
<div class="paragraph">
<p>The <code>$scope: readonly</code> option makes a field read-only.
It can be used to show a user data which should be known, but should not be editable.
This option only makes sense in combination with the $default attribute.</p>
</div>
</dd>
<dt class="hdlist1">$visibleIf</dt>
<dd>
<p><code>$visibleIf</code> allows you to show a field or group if a simple condition is met.
A condition always looks similar to the following example:</p>
<div class="listingblock">
<div class="content">
<pre>some_group#another_group#my_checkbox == true</pre>
</div>
</div>
<div class="paragraph">
<p>The left part of the above statement is the path to another value, and groups are separated by <code>$</code> signs.
The middle section of the command should be either <code>==</code> for a value to be equal or <code>!=</code> for values that should be not equal.
The last field in the statement can be any value which a field should have or not have.</p>
</div>
<div class="paragraph">
<p>The field with this attribute associated with it will now be shown only when the condition is met.
In this example the field will be shown only if <code>my_checkbox</code> is checked.
The ability to use conditional statements is not limited to check boxes.
It may also be used to check values of select-fields, text-fields, etc.</p>
</div>
<div class="paragraph">
<p>A check box should be structured like the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>some_group:
  $type: group

  another_group:
    $type: group

      my_checkbox:
        $type: boolean</pre>
</div>
</div>
<div class="paragraph">
<p>Relative paths can be specified using prefix dots. One dot means sibling, 2 dots mean parent, etc. This is mostly useful for <code>edit-group</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>some_group:
  $type: group

  another_group:
    $type: group

    my_checkbox:
      $type: boolean

    my_text:
      $visibleIf: .my_checkbox

  yet_another_group:
    $type: group

    my_text2:
      $visibleIf: ..another_group#my_checkbox</pre>
</div>
</div>
<div class="paragraph">
<p>By using multiple groups with the attribute, you can allow a user to select an option and show a completely different form, dependent upon the selected value.</p>
</div>
<div class="paragraph">
<p>Values from hidden fields may be merged into the pillar data and sent to the minion.
A formula must check the condition again and use the appropriate data.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>show_option:
  $type: checkbox
some_text:
  $visibleIf: show_option == true</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>{% if pillar.show_option %}
do_something:
  with: {{ pillar.some_text }}
{% endif %}</pre>
</div>
</div>
</dd>
<dt class="hdlist1">$values</dt>
<dd>
<p><code>$values</code> can only be used together with <code>$type</code>: select to specify the different options in the select-field.
<code>$values</code> must be a list of possible values to select.
For example:</p>
<div class="listingblock">
<div class="content">
<pre>select_something:
  $type: select
  $values: ["option1", "option2"]</pre>
</div>
</div>
<div class="paragraph">
<p>Or alternatively:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>select_something:
  $type: select
  $values:
    - option1
    - option2</pre>
</div>
</div>
</dd>
</dl>
</div>
<div class="sect2">
<h3 id="salt.formulas.ex.edit-group"><a class="anchor" href="#salt.formulas.ex.edit-group"></a><a class="link" href="#salt.formulas.ex.edit-group">Simple edit-group Example</a></h3>
<div class="paragraph">
<p>See the following <strong>edit-group</strong> example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>partitions:
  $name: "Hard Disk Partitions"
  $type: "edit-group"
  $minItems: 1
  $maxItems: 4
  $itemName: "Partition ${name}"
  $prototype:
    name:
      $default: "New partition"
    mountpoint:
      $default: "/var"
    size:
      $type: "number"
      $name: "Size in GB"
  $default:
    - name: "Boot"
      mountpoint: "/boot"
    - name: "Root"
      mountpoint: "/"
      size: 5000</pre>
</div>
</div>
<div class="paragraph">
<p>After clicking <b class="button">Add</b> for one time you will see <a href="#fig-formula-custom-harddisk-partitions"><code>edit-group</code> Example in the WebUI</a> filled with the default values.
The formula itself is called <code class="path">hd-partitions</code> and will appear as <code class="guimenu">Hd Partitions</code> in the WebUI.</p>
</div>
<div id="fig-formula-custom-harddisk-partitions" class="imageblock">
<div class="content">
<img src="_images/formula-custom-harddisk-partitions.png" alt="formula custom harddisk partitions">
</div>
<div class="title">Figure 1. <code>edit-group</code> Example in the WebUI</div>
</div>
<div class="paragraph">
<p>To remove definition of a partition click the minus symbol in the title line of an inner group.
When form fields are properly filled confirm with clicking <b class="button">Save Formula</b> in the upper right corner of the formula.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="best.practice.salt.formulas.writing"><a class="anchor" href="#best.practice.salt.formulas.writing"></a><a class="link" href="#best.practice.salt.formulas.writing">Writing Salt Formulas</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Salt formulas are pre-written Salt states, which may be configured with pillar data.
You can parametrize state files using Jinja.
Jinja allows you to access pillar data by using the following syntax.
(This syntax works best when your uncertain a pillar value exists as it will throw an error):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>pillar.some.value</pre>
</div>
</div>
<div class="paragraph">
<p>When you are sure a pillar exists may also use the following syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>salt['pillar.get']('some:value', 'default value')</pre>
</div>
</div>
<div class="paragraph">
<p>You may also replace the <code>pillar</code> value with <code>grains</code> (for example, <code>grains.some.value</code>) allowing access to grains.</p>
</div>
<div class="paragraph">
<p>Using data this way allows you to make a formula configurable.
The following code snippet will install a package specified in the pillar <code>package_name</code>.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>install_a_package:
  pkg.installed:
    - name: {{ pillar.package_name }}</pre>
</div>
</div>
<div class="paragraph">
<p>You may also use more complex constructs such as <code>if/else</code> and <code>for-loops</code> to provide greater functionality.
For Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{% if pillar.installSomething %}
something:
  pkg.installed
{% else %}
anotherPackage:
  pkg.installed
{% endif %}</pre>
</div>
</div>
<div class="paragraph">
<p>Another example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{% for service in pillar.services %}
start_{{ service }}:
  service.running:
    - name: {{ service }}
{% endfor %}</pre>
</div>
</div>
<div class="paragraph">
<p>Jinja also provides other helpful functions.
For example, you can iterate over a dictionary:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{% for key, value in some_dictionary.items() %}
do_something_with_{{ key }}: {{ value }}
{% endfor %}</pre>
</div>
</div>
<div class="paragraph">
<p>You may want to have Salt manage your files (for example, configuration files for a program), and you can change these with pillar data.
For example, the following snippet shows how you can manage a file using Salt:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/etc/my_program/my_program.conf:
  file.managed:
    - source: salt://my_state/files/my_program.conf
    - template: jinja</pre>
</div>
</div>
<div class="paragraph">
<p>Salt will copy the file <code class="path">salt-file_roots/my_state/files/my_program.conf</code> on the salt master to <code class="path">/etc/my_program/my_program.conf</code> on the minion and template it with Jinja.
This allows you to use Jinja in the file, exactly like shown above for states:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>some_config_option = {{ pillar.config_option_a }}</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="best.practice.salt.formulas.data"><a class="anchor" href="#best.practice.salt.formulas.data"></a><a class="link" href="#best.practice.salt.formulas.data">Separating Data</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is often a good idea to separate data from a state to increase its flexibility and add re-usability value.
This is often done by writing values into a separate file named <code class="path">map.jinja</code>.
This file should be placed within the same directory as your state files.</p>
</div>
<div class="paragraph">
<p>The following example will set <code>data</code> to a dictionary with different values, depending on which system the state runs on.
It will also merge data with the pillar using the <code>some.pillar.data</code> value so you can access <code>some.pillar.data.value</code> by just using <code>data.value</code>.</p>
</div>
<div class="paragraph">
<p>You can also choose to override defined values from pillars (for example, by overriding <code>some.pillar.data.package</code> in the example).</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{% set data = salt['grains.filter_by']({
    'Suse': {
        'package': 'packageA',
        'service': 'serviceA'
    },
    'RedHat': {
        'package': 'package_a',
        'service': 'service_a'
    }
}, merge=salt['pillar.get']('some:pillar:data')) %}</pre>
</div>
</div>
<div class="paragraph">
<p>After creating a map file like the above example, you can easily maintain compatibility with multiple system types while accessing "deep" pillar data in a simpler way.
Now you can import and use <code>data</code> in any file.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{% from "some_folder/map.jinja" import data with context %}

install_package_a:
  pkg.installed:
    - name: {{ data.package }}</pre>
</div>
</div>
<div class="paragraph">
<p>You can also define multiple variables by copying the <code>{% set &#8230;&#8203;%}</code> statement with different values and then merge it with other pillars.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{% set server = salt['grains.filter_by']({
    'Suse': {
        'package': 'my-server-pkg'
    }
}, merge=salt['pillar.get']('myFormula:server')) %}
{% set client = salt['grains.filter_by']({
    'Suse': {
        'package': 'my-client-pkg'
    }
}, merge=salt['pillar.get']('myFormula:client')) %}</pre>
</div>
</div>
<div class="paragraph">
<p>To import multiple variables, separate them with a comma.
For Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{% from "map.jinja" import server, client with context %}</pre>
</div>
</div>
<div class="paragraph">
<p>Formulas utilized with  should follow formula conventions listed in the official documentation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.saltstack.com/en/latest/topics/development/conventions/formulas.html" class="bare">https://docs.saltstack.com/en/latest/topics/development/conventions/formulas.html</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="best.practice.salt.formulas.pillardata"><a class="anchor" href="#best.practice.salt.formulas.pillardata"></a><a class="link" href="#best.practice.salt.formulas.pillardata"> Generated Pillar Data</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>When pillar data is generated (for example, after applying the highstate) the following external pillar script generates pillar data for packages, group ids, etc.
and includes all pillar data for a system:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/usr/share/susemanager/modules/pillar/suma_minion.py</pre>
</div>
</div>
<div class="paragraph">
<p>The process is executed as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <code>suma_minion.py</code> script starts and finds all formulas for a system (by checking the <code>group_formulas.json</code> and <code>server_formulas.json</code> files).</p>
</li>
<li>
<p><code>suma_minion.py</code> loads the values for each formula (groups and from the system) and merges them with the highstate (default: if no values are found, a group overrides a system if $scope: group etc.).</p>
</li>
<li>
<p><code>suma_minion.py</code> also includes a list of formulas applied to the system in a pillar named formulas.
This structure makes it possible to include states.
The top file (in this case specifically generated by the <code>mgr_master_tops.py</code> script) includes a state called formulas for each system.
This includes the <code>formulas.sls</code> file located in:</p>
<div class="listingblock">
<div class="content">
<pre>/usr/share/susemanager/formulas/states/</pre>
</div>
</div>
<div class="paragraph">
<p>The content looks similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>include: {{ pillar["formulas"] }}</pre>
</div>
</div>
<div class="paragraph">
<p>This pillar includes all formulas, that are specified in pillar data generated from the external pillar script.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="best.practice.salt.formulas.req"><a class="anchor" href="#best.practice.salt.formulas.req"></a><a class="link" href="#best.practice.salt.formulas.req">Formula Requirements</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Formulas should be designed/created directly after a  installation, but if you encounter any issues check the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The external pillar script (<code>suma_minion.py</code>) must include formula data.</p>
</li>
<li>
<p>Data is saved to <code class="path">/srv/susemanager/formula_data</code> and the <code class="path">pillar</code> and <code class="path">group_pillar</code> sub-directories.
These should be automatically generated by the server.</p>
</li>
<li>
<p>Formulas must be included for every minion listed in the top file.
Currently this process is initiated by the <code class="path">mgr_master_tops.py</code> script which includes the formulas.sls file located in:</p>
<div class="listingblock">
<div class="content">
<pre>/usr/share/susemanager/formulas/states/</pre>
</div>
</div>
<div class="paragraph">
<p>This directory must be a salt file root.
File roots are configured on the salt-master () located in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/etc/salt/master.d/susemanager.conf</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="best.practice.salt.formulas.using"><a class="anchor" href="#best.practice.salt.formulas.using"></a><a class="link" href="#best.practice.salt.formulas.using">Using Salt Formulas with </a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following procedure provides an overview on using Salt Formulas with .</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Official formulas may be installed as RPMs.
Place the custom states within <code class="path">/srv/salt/your-formula-name/</code> and the metadata (<code class="path">form.yml</code> and <code class="path">metadata.yml</code>) in <code class="path">/srv/formula_metadata/your-formula-name/</code>.
After installing your formulas they will appear in <span class="menuseq"><b class="menu">Salt</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Formula Catalog</b></span>.</p>
</li>
<li>
<p>To begin using a formula, apply it to a group or system.
Apply a formula to a group or system by selecting the <span class="menuseq"><b class="menu">System Details</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Formulas</b></span> tab of a <code class="guimenu">System Details</code> page or <code class="guimenu">System Group</code>. From the <span class="menuseq"><b class="menu">System Details</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Formulas</b></span> page you can select any formulas you wish to apply to a group or system.
Click the <b class="button">Save</b> button to save your changes to the database.</p>
</li>
<li>
<p>After applying one or more formulas to a group or system, additional tabs will become available from the top menu, one for each formula selected.
From these tabs you may configure your formulas.</p>
</li>
<li>
<p>When you have finished customizing your formula values you will need to apply the highstate for them to take effect.
Applying the highstate will execute the state associated with the formula and configure targeted systems.
You can use the <b class="button">Apply Highstate</b> button from any formulas page of a group.</p>
</li>
<li>
<p>When a change to any of your values is required or you need to re-apply the formula state because of a failure or bug, change values located on your formula pages and re-apply the highstate.
Salt will ensure that only modified values are adjusted and restart or reinstall services only when necessary.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This conclude your introduction to Salt Formulas.
For additional information, see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.saltstack.com/en/latest/topics/development/conventions/formulas.html" class="bare">https://docs.saltstack.com/en/latest/topics/development/conventions/formulas.html</a></p>
</li>
</ul>
</div>
</div>
</div>
</article>
  </main>
</div>
<footer class="footer">
  <p>Copyright (C) 2017-2018 <a href="https://jcayouette.github.io/personal-blog">Belief and Reason</a></p>
  <p>Except where otherwise noted, jcayouette.github.io/personal-blog, BoR, are licensed under the <a href="https://www.mozilla.org/en-US/MPL/2.0/">Mozilla Public License Version 2.0</a> (MPL-2.0).</p>
</footer>
<script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<!-- fetched from https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js -->
<script>
function focusSearchInput () { document.querySelector('#search-input').focus() }
var search = docsearch({
  appId: '#',
  apiKey: '#',
  indexName: '#',
  inputSelector: '#search-input',
  autocompleteOptions: { hint: false, keyboardShortcuts: ['s'] },
  algoliaOptions: { hitsPerPage: 10 }
}).autocomplete
search.on('autocomplete:closed', function () { search.autocomplete.setVal() })
focusSearchInput()
window.addEventListener('load', focusSearchInput)
</script>
<script src="../../_/js/site.js"></script>
<script src="../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>
  </body>
</html>
