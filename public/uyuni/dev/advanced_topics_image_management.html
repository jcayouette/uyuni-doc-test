<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Building and Management :: Uyuni Documentation (Prototype)</title>
    <meta name="generator" content="Antora 1.0.3">
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="stylesheet" href="../../_/css/site-extra.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css">
    <!-- fetched from https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css -->
    <link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <a href="https://jcayouette.github.io/personal-blog">Belief and Reason</a>
        <span class="separator">//</span>
        <a href="../..">Library</a>
      </div>
      <div class="navbar-item">
        <input id="search-input" type="text" placeholder="Search docs">
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <div class="navbar-link">Projects</div>
          <div class="navbar-dropdown">
            <div class="navbar-item"><strong>Resources</strong></div>
            <a class="navbar-item" href="https://github.com/jcayouette/personal-blog">Repository</a>
            <a class="navbar-item" href="https://github.com/jcayouette/personal-blog/issues">Issue Tracker</a>
<!--
            <hr class="navbar-divider">
            <div class="navbar-item"><strong>Custom UI (coming soon!)</strong></div>
            <a class="navbar-item" href="https://gitlab.com/antora/antora-ui-default">Repository</a>
            <a class="navbar-item" href="https://gitlab.com/antora/antora-ui-default/issues">Issue Tracker</a>
            <hr class="navbar-divider">
          -->
            <a class="navbar-item" href="https://github.com/jcayouette/blob/master/contributing.adoc">Contributing</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <div class="navbar-link">Community</div>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="https://discord.gg/vmrAYE3">Discord Chat</a>
          </div>
        </div>
        <a class="navbar-item" href="https://twitter.com/BaR-project">
          <span class="icon">
            <svg aria-hidden="true" data-icon="twitter" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
              <path fill="#57aaee" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path>
            </svg>
          </span>
        </a>
      </div>
    </div>
  </nav>
</header>
<div class="main-wrapper">
<div class="navigation-container" data-component="uyuni" data-version="dev">
  <aside class="navigation">
    <div class="panels">
<div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="MAIN-manager.html">Uyuni</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="book_mgr_getting_started.html">Getting Started</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="quickstart3_chap_install_overview.html">Overview and Requirements</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.introduction">Introduction</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.prereq">Prerequisites for Installation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.prereq.scc">SUSE SCC Credentials</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.prereq.installmedia">Get Uyuni</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.prereq.hardware">Hardware Requirements</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.prereq.network">Network Requirements</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.prereq.clientos">Supported Client Systems</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="quickstart3_chap_suma_installation_jeos.html">Installation via JeOS</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.kvm.settings">Configuring KVM</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#jeos.kvm.settings">JeOS KVM Settings</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#jeos.susemgr.prep">Preparing JeOS for Uyuni</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quickstart3_chap_suma_installation_sles.html">Installation via SLES</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quickstart3_chap_suma_setup_with_yast.html">Setup and Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quickstart3_chap_suma_keys_and_first_client.html">Connecting Clients</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quickstart3_chap_suma_salt_gs.html">Introduction to Salt</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="book_mgr_best_practices.html">Best Practices</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="book_suma_reference_manual.html">WebUI Reference</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="book_suma_advanced_topics.html">Advanced Topics</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="navigation-explore" data-panel="explore">
  <div class="context">
    <span class="title">Uyuni</span>
    <span class="version">dev</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Uyuni</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="MAIN-manager.html">dev</a>
        </li>
        <li class="version">
          <a href="../3.2/MAIN-manager.html">3.2</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
  <main class="main">
<div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
  <a href="MAIN-manager.html" class="home-link"></a>
<nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="MAIN-manager.html">Uyuni</a></li>
    <li class="crumb"><a href="advanced_topics_image_management.html">Image Building and Management</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="versions-menu-toggle" title="Show other versions of page">dev</button>
  <div class="versions-menu">
    <a class="version is-current" href="advanced_topics_image_management.html">dev</a>
    <a class="version" href="../3.2/advanced_topics_image_management.html">3.2</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/jcayouette/uyuni-doc-test/edit/master/docs/modules/ROOT/pages/advanced_topics_image_management.adoc">Edit this Page</a></div>
</div>
<article class="doc">
<h1>Image Building and Management</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#at.images.overview">Image Building Overview</a></li>
<li><a href="#at.images.docker">Container Images</a>
<ul class="sectlevel2">
<li><a href="#at.images.docker.requirements">Requirements</a></li>
<li><a href="#at.images.docker.buildhost">Creating a Build Host</a></li>
<li><a href="#at.images.docker.imagestore">Creating an Image Store</a></li>
<li><a href="#at.images.docker.profile">Creating an Image Profile</a></li>
<li><a href="#at.images.docker.sourceexample">Example Dockerfile and add_packages Script</a></li>
<li><a href="#at.images.docker.building">Building an Image</a></li>
<li><a href="#at.images.docker.importing">Importing an Image</a></li>
<li><a href="#at.images.docker.troubleshooting">Troubleshooting</a></li>
</ul>
</li>
<li><a href="#at.images.kiwi">OS Images</a>
<ul class="sectlevel2">
<li><a href="#at.images.kiwi.enablement">Enabling OS Image Building</a></li>
<li><a href="#at.images.kiwi.requirements">Requirements</a></li>
<li><a href="#at.images.kiwi.buildhost">Creating a Build Host</a></li>
<li><a href="#at.images.kiwi.imagestore">Image Store</a></li>
<li><a href="#at.images.kiwi.profile">Creating an Image Profile</a></li>
<li><a href="#at.images.kiwi.sourceexample">Example of Kiwi sources</a></li>
<li><a href="#at.images.kiwi.building">Building an Image</a></li>
<li><a href="#at.images.kiwi.inspection">Image Inspection and Salt Integration</a></li>
<li><a href="#at.images.kiwi.troubleshooting">Troubleshooting</a></li>
<li><a href="#at.images.kiwi.limitations">Limitations</a></li>
</ul>
</li>
<li><a href="#at.images.listing">Listing Image Profiles Available for Building</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="at.images.overview"><a class="anchor" href="#at.images.overview"></a><a class="link" href="#at.images.overview">Image Building Overview</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p> enables system administrators to build containers, systems, and virtual images.
 helps with creating Image Stores and managing Image Profiles.</p>
</div>
<div class="paragraph">
<p> supports two distinct build types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dockerfile{mdash}for more information, see <a href="#at.images.docker">Container Images</a></p>
</li>
<li>
<p>Kiwi image system{mdash}for more information, see <a href="#at.images.kiwi">OS Images</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="at.images.docker"><a class="anchor" href="#at.images.docker"></a><a class="link" href="#at.images.docker">Container Images</a></h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="_images/image-building.png" alt="image building">
</div>
</div>
<div class="sect2">
<h3 id="at.images.docker.requirements"><a class="anchor" href="#at.images.docker.requirements"></a><a class="link" href="#at.images.docker.requirements">Requirements</a></h3>
<div class="paragraph">
<p>The containers feature is available for Salt minions running SUSE Linux Enterprise Server 12 or later.
Before you begin, ensure your environment meets these requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An existing external GitHub or internal GitLab repository containing a Dockerfile and configuration scripts (example scripts are provided in this chapter).</p>
</li>
<li>
<p>A properly configured image registry.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
<div class="title">Registry Provider Solutions</div>
<div class="paragraph">
<p>If you require a private image registry you can use an open source solution such as <code>Portus</code>.
For additional information on setting up Portus as a registry provider, see the <a href="http://port.us.org/">Portus Documentation</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more information on Containers or CaaS Platform, see:</p>
</div>
</li>
<li>
<p><a href="https://www.suse.com/documentation/sles-12/book_sles_docker/data/book_sles_docker.html">SUSE Linux Enterprise Server 12 SP3 Docker Guide</a></p>
</li>
<li>
<p><a href="https://www.suse.com/documentation/suse-caasp-2/">SUSE CaaS Platform 2 Documentation</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="at.images.docker.buildhost"><a class="anchor" href="#at.images.docker.buildhost"></a><a class="link" href="#at.images.docker.buildhost">Creating a Build Host</a></h3>
<div class="paragraph">
<p>To build images with , you will need to create and configure a build host.
Build hosts are Salt minions running SUSE Linux Enterprise 12 or later.
This section guides you though the initial configuration for a build host.</p>
</div>
<div class="paragraph">
<p>From the  WebUI perform these steps to configure a build host.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select a minion to be designated as a build host from the <span class="menuseq"><b class="menu">Systems</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Overview</b></span> page.</p>
</li>
<li>
<p>From the <code class="guimenu">System Details</code> page for the selected minion assign the containers modules by going to <span class="menuseq"><b class="menu">Software</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Software Channels</b></span> and enabling <code class="guimenu">SLE-Module-Containers12-Pool</code> and <code class="guimenu">SLE-Module-Containers12-Updates</code>. Confirm by clicking <b class="button">Change Subscriptions</b>.</p>
</li>
<li>
<p>From the <span class="menuseq"><b class="menu">System Details</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Properties</b></span> page, enable <code class="guimenu">Add-on System Type</code> and <code>Container Build Host</code> and confirm by clicking <b class="button">Update Properties</b>.</p>
</li>
<li>
<p>Install all required packages by applying <code>Highstate</code>. From the system details page select <span class="menuseq"><b class="menu">States</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Highstate</b></span> and click <code class="guimenu">Apply Highstate</code>.
Alternatively, apply Highstate from the  Server command line:</p>
<div class="listingblock">
<div class="content">
<pre>salt '$your_minion' state.highstate</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="at.images.docker.buildchannels"><a class="anchor" href="#at.images.docker.buildchannels"></a><a class="link" href="#at.images.docker.buildchannels">Define Container Build Channels with an Activation Key</a></h4>
<div class="paragraph">
<p>Create an activation key associated with the channel that your images will use.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
<div class="title">Relationship Between Activation Keys and Image Profiles</div>
<div class="paragraph">
<p>To build containers, you will need an activation key that is associated with a channel other than "SUSE Manager Default".</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/systems_create_activation_key.png" alt="systems create activation key">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select <span class="menuseq"><b class="menu">Main Menu</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Systems</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Activation Keys</b></span>.</p>
</li>
<li>
<p>Click <b class="button">Create Key</b>.</p>
</li>
<li>
<p>Enter a <code class="guimenu">Description</code> and a <code class="guimenu">Key</code> name. Use the drop-down menu to select the <code class="guimenu">Base Channel</code> to associate with this key.</p>
</li>
<li>
<p>Confirm with <b class="button">Create Activation Key</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For more information, see <a href="#bp.key.managment">[bp.key.managment]</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="at.images.docker.imagestore"><a class="anchor" href="#at.images.docker.imagestore"></a><a class="link" href="#at.images.docker.imagestore">Creating an Image Store</a></h3>
<div class="paragraph">
<p>Define a location to store all of your images by creating an Image Store.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/images_image_stores.png" alt="images image stores">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select <span class="menuseq"><b class="menu">Main Menu</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Images</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Stores</b></span>.</p>
</li>
<li>
<p>Click <code class="guimenu">Create</code> to create a new store.</p>
<div class="imageblock">
<div class="content">
<img src="_images/images_image_stores_create.png" alt="images image stores create">
</div>
</div>
</li>
<li>
<p> currently provides support only for the <code>Registry</code> store type. Define a name for the image store in the <code class="guimenu">Label</code> field.</p>
</li>
<li>
<p>Provide the path to your image registry by filling in the <code class="guimenu">URI</code> field, as a fully qualified domain name (FQDN) for the container registry host (whether internal or external).</p>
<div class="listingblock">
<div class="content">
<pre>registry.example.com</pre>
</div>
</div>
<div class="paragraph">
<p>The Registry URI can also be used to specify an image store on a used registry.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>registry.example.com:5000/myregistry/myproject</pre>
</div>
</div>
</li>
<li>
<p>Click <b class="button">Create</b> to add the new image store.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="at.images.docker.profile"><a class="anchor" href="#at.images.docker.profile"></a><a class="link" href="#at.images.docker.profile">Creating an Image Profile</a></h3>
<div class="paragraph">
<p>Manage Image Profiles from the <code>Image Profile</code> page.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/images_image_profiles.png" alt="images image profiles">
</div>
</div>
<div class="olist arabic">
<div class="title">Procedure: Create an Image Profile</div>
<ol class="arabic">
<li>
<p>To create an image profile select <span class="menuseq"><b class="menu">Image</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Profiles</b></span> and click <b class="button">Create</b>.</p>
<div class="imageblock">
<div class="content">
<img src="_images/images_image_create_profile.png" alt="images image create profile">
</div>
</div>
</li>
<li>
<p>Provide a name for the image profile by filling in the <b class="menuref">Label</b> field.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Only lowercase characters are permitted in container labels.
If your container image tag is in a format such as <code>myproject/myimage</code>, make sure your image store registry URI contains the <code>/myproject</code> suffix.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Use a <code>Dockerfile</code> as the <code>Image Type</code></p>
</li>
<li>
<p>Use the drop-down menu to select your registry from the <code>Target Image Store</code> field.</p>
</li>
<li>
<p>Enter a Github or Gitlab repository URL (http, https, or token authentication) in the <code class="guimenu">Path</code> field using one of the following formats:</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Github Path Options</div>
<ul>
<li>
<p>Github single user project repository</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>https://github.com/USER/project.git#branchname:folder</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Github organization project repository</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>https://github.com/ORG/project.git#branchname:folder</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Github token authentication:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If your git repository is private and not publicly accessible, you need to modify the profile&#8217;s git URL to include authentication.
Use this URL format to authenticate with a Github token:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>https://USER:&lt;AUTHENTICATION_TOKEN&gt;@github.com/USER/project.git#master:/container/</pre>
</div>
</div>
<div class="ulist">
<div class="title">Gitlab Path Options</div>
<ul>
<li>
<p>Gitlab single user project repository</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>https://gitlab.example.com/USER/project.git#master:/container/</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Gitlab groups project repository</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>https://gitlab.example.com/GROUP/project.git#master:/container/</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Gitlab token authentication
If your git repository is private and not publicly accessible, you need to modify the profile&#8217;s git URL to include authentication.
Use this URL format to authenticate with a Gitlab token:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>https://gitlab-ci-token:&lt;AUTHENTICATION_TOKEN&gt;@gitlab.example.com/USER/project.git#master:/container/</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
<div class="title">Specifying a Github or Gitlab Branch</div>
<div class="paragraph">
<p>If a branch is not specified, the <code>master</code> branch will be used by default.
If a <code>folder</code> is not specified the image sources (<code>Dockerfile</code> sources) are expected to be in the root directory of the Github or Gitlab checkout.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select an <code>Activation Key</code>.  Activation Keys ensure that images using a profile are assigned to the correct channel and packages.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
<div class="title">Relationship Between Activation Keys and Image Profiles</div>
<div class="paragraph">
<p>When you associate an activation key with an image profile you are ensuring any image using the profile will use the correct software channel and any packages in the channel.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Click the <b class="button">Create</b> button.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="at.images.docker.sourceexample"><a class="anchor" href="#at.images.docker.sourceexample"></a><a class="link" href="#at.images.docker.sourceexample">Example Dockerfile and add_packages Script</a></h3>
<div class="paragraph">
<p>This section contains an example Dockerfile.
You specify a Dockerfile that will be used during image building when creating an image profile.
A Dockerfile and any associated scripts should be stored within an internal or external Github or Gitlab repository:</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
<div class="title">Required Dockerfile Lines</div>
<div class="paragraph">
<p>The Dockerfile provides access to a specific repository version served by .
This example Dockerfile is used by  to trigger a build job on a build host minion.
The <code class="command">ARG</code> parameters ensure that the image that is built is associated with the desired repository version served by .
The <code class="command">ARG</code> parameters also allow you to build image versions of SUSE Linux Enterprise Server which may differ from the version of SUSE Linux Enterprise Server used by the build host itself.</p>
</div>
<div class="paragraph">
<p>For example: The <code class="comand">ARG repo</code> parameter and the <code class="command">echo</code> command pointing to the repository file, creates and then injects the correct path into the repository file for the desired channel version.</p>
</div>
<div class="paragraph">
<p><em>The repository version is determined by the activation key that you assigned to your image profile.</em></p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre>FROM registry.example.com/sles12sp2
MAINTAINER Tux Administrator "tux@example.com"

### Begin: These lines Required for use with {productname}

ARG repo
ARG cert

# Add the correct certificate
RUN echo "$cert" &gt; /etc/pki/trust/anchors/RHN-ORG-TRUSTED-SSL-CERT.pem

# Update certificate trust store
RUN update-ca-certificates

# Add the repository path to the image
RUN echo "$repo" &gt; /etc/zypp/repos.d/susemanager:dockerbuild.repo

### End: These lines required for use with {productname}

# Add the package script
ADD add_packages.sh /root/add_packages.sh

# Run the package script
RUN /root/add_packages.sh

# After building remove the repository path from image
RUN rm -f /etc/zypp/repos.d/susemanager:dockerbuild.repo</pre>
</div>
</div>
<div class="paragraph">
<p>This is an example <code class="path">add_packages.sh</code> script for use with your Dockerfile:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>#!/bin/bash
set -e

zypper --non-interactive --gpg-auto-import-keys ref

zypper --non-interactive in python python-xml aaa_base aaa_base-extras net-tools timezone vim less sudo tar</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
<div class="title">Packages Required for Inspecting Your Images</div>
<div class="paragraph">
<p>To inspect images and provide the package and product list of a container to the  WebUI you will need to install <span class="package">python</span> and <span class="package">python-xml</span> within the container.
If these packages remain uninstalled, your images will still build, but the package and product list will be unavailable from the WebUI.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="at.images.docker.building"><a class="anchor" href="#at.images.docker.building"></a><a class="link" href="#at.images.docker.building">Building an Image</a></h3>
<div class="paragraph">
<p>There are two ways to build an image.
You can select <span class="menuseq"><b class="menu">Images</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Build</b></span> from the left navigation bar, or click the build icon in the <span class="menuseq"><b class="menu">Images</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Profiles</b></span> list.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/images_image_build.png" alt="images image build">
</div>
</div>
<div class="olist arabic">
<div class="title">Procedure: Build an Image</div>
<ol class="arabic">
<li>
<p>For this example select <span class="menuseq"><b class="menu">Images</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Build</b></span>.</p>
</li>
<li>
<p>Add a different tag name if you want a version other than the default <code>latest</code> (only relevant to containers).</p>
</li>
<li>
<p>Select <code class="guimenu">Build Profile</code> and <code class="guimenu">Build Host</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
<div class="title">Profile Summary</div>
<div class="paragraph">
<p>Notice the <code class="guimenu">Profile Summary</code> to the right of the build fields.
When you have selected a build profile, detailed information about the selected profile will be displayed in this area.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>To schedule a build click the <b class="button">Build</b> button.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="at.images.docker.importing"><a class="anchor" href="#at.images.docker.importing"></a><a class="link" href="#at.images.docker.importing">Importing an Image</a></h3>
<div class="paragraph">
<p>You can import and inspect arbitrary images.
Select <span class="menuseq"><b class="menu">Images</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Images</b></span> from the left navigation bar.
Complete the text boxes of the <code class="guimenu">Import</code> dialog.
Once it has processed, the imported image will be listed on the <code class="guimenu">Images</code> page.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: Import an Image</div>
<ol class="arabic">
<li>
<p>From <span class="menuseq"><b class="menu">Images</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Images</b></span> click <b class="button">Import</b> to open the <code class="guimenu">Import Image</code> dialog.</p>
</li>
<li>
<p>In the <code class="guimenu">Import Image</code> dialog complete these fields:</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Image store</dt>
<dd>
<p>The registry from where the image will be pulled for inspection.</p>
</dd>
<dt class="hdlist1">Image name</dt>
<dd>
<p>The name of the image in the registry.</p>
</dd>
<dt class="hdlist1">Image version</dt>
<dd>
<p>The version of the image in the registry.</p>
</dd>
<dt class="hdlist1">Build host</dt>
<dd>
<p>The build host that will pull and inspect the image.</p>
</dd>
<dt class="hdlist1">Activation key</dt>
<dd>
<p>The activation key that provides the path to the software channel that the image will be inspected with.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For confirmation, click <b class="button">Import</b>.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The entry for the image is created in the database, and an <code>Inspect Image</code> action on  is scheduled.</p>
</div>
<div class="paragraph">
<p>Once it has been processed, you can find the imported image in the <code>Images</code> list.
It has a different icon in the <code>Build</code> column, to indicate that the image is imported (see screenshot).
The status icon for the imported image can also be seen on the <code>Overview</code> tab for the image.</p>
</div>
</div>
<div class="sect2">
<h3 id="at.images.docker.troubleshooting"><a class="anchor" href="#at.images.docker.troubleshooting"></a><a class="link" href="#at.images.docker.troubleshooting">Troubleshooting</a></h3>
<div class="paragraph">
<p>These are some known problems that you might encounter when working with images:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>HTTPS certificates to access the registry or the git repositories should be deployed to the minion by a custom state file.</p>
</li>
<li>
<p>SSH git access using Docker is currently unsupported.
You may test it, but SUSE will not provide support.</p>
</li>
<li>
<p>If the <span class="package">python</span> and <span class="package">python-xml</span> packages are not installed in your images during the build process, Salt cannot run within the container and reporting of installed packages or products will fail.
This will result in an <code>unknown</code> update status.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="at.images.kiwi"><a class="anchor" href="#at.images.kiwi"></a><a class="link" href="#at.images.kiwi">OS Images</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>OS images are built by the Kiwi image system.
They can be of various types: PXE, QCOW2, LiveCD images, and others.</p>
</div>
<div class="paragraph">
<p>For more information about the Kiwi build system, see the <a href="https://doc.opensuse.org/projects/kiwi/doc/">Kiwi documentation</a>.</p>
</div>
<div class="sect2">
<h3 id="at.images.kiwi.enablement"><a class="anchor" href="#at.images.kiwi.enablement"></a><a class="link" href="#at.images.kiwi.enablement">Enabling OS Image Building</a></h3>
<div class="paragraph">
<p>OS image building is disabled by default. You can enable it in <code>/etc/rhn/rhn.conf</code> by setting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>java.kiwi_os_image_building_enabled = true</pre>
</div>
</div>
<div class="paragraph">
<p>Restart the Spacewalk service to pick up the changes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>spacewalk-service restart</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="at.images.kiwi.requirements"><a class="anchor" href="#at.images.kiwi.requirements"></a><a class="link" href="#at.images.kiwi.requirements">Requirements</a></h3>
<div class="paragraph">
<p>The Kiwi image building feature is available for Salt minions running SUSE Linux Enterprise Server&#160;12 or later.</p>
</div>
<div class="paragraph">
<p>Kiwi image configuration files and configuration scripts must be accessible in one of these locations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Git repository</p>
</li>
<li>
<p>HTTP hosted tarball</p>
</li>
<li>
<p>Local build host directory</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example scripts are provided in the following sections.</p>
</div>
</div>
<div class="sect2">
<h3 id="at.images.kiwi.buildhost"><a class="anchor" href="#at.images.kiwi.buildhost"></a><a class="link" href="#at.images.kiwi.buildhost">Creating a Build Host</a></h3>
<div class="paragraph">
<p>To build all kinds of images with , create and configure a build host.
Build hosts are Salt minions running SUSE Linux Enterprise Server&#160;12 or later.
This procedure will guide you though the initial configuration for a build host.</p>
</div>
<div class="paragraph">
<p>From the  WebUI perform these steps to configure a build host:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select a minion that will be designated as a build host from the <span class="menuseq"><b class="menu">Main Menu</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Systems</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Overview</b></span> page.</p>
</li>
<li>
<p>From the <span class="menuseq"><b class="menu">System Details</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Properties</b></span> page, enable the <code class="guimenu">Add-on System Type:</code> <code class="guimenu">OS Image Build Host</code> and confirm with <b class="button">Update Properties</b>.</p>
<div class="imageblock">
<div class="content">
<img src="_images/os-image-build-host.png" alt="os image build host">
</div>
</div>
</li>
<li>
<p>From the <span class="menuseq"><b class="menu">System Details</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Software</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Software Channels</b></span> page, enable <code>SLE-Manager-Tools12-Pool</code> and <code>SLE-Manager-Tools12-Updates</code> (or a later version).
Schedule and click <b class="button">Confirm</b>.</p>
</li>
<li>
<p>Install Kiwi and all required packages by applying Highstate.
From the system details page select <span class="menuseq"><b class="menu">States</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Highstate</b></span> and click <b class="button">Apply Highstate</b>.
Alternatively, apply Highstate from the  Server command line:</p>
<div class="listingblock">
<div class="content">
<pre>salt '$your_minion' state.highstate</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title"> Web Server Public Certificate RPM</div>
<p>Build host provisioning copies the  certificate RPM to the build host.
This certificate is used for accessing repositories provided by .</p>
</div>
<div class="paragraph">
<p>The certificate is packaged in RPM by the <code>mgr-package-rpm-certificate-osimage</code> package script.
The package script is called automatically during a new  installation.</p>
</div>
<div class="paragraph">
<p>When you upgrade the <code>spacewalk-certs-tools</code> package, the upgrade scenario will call the package script using the default values.
However if the certificate path was changed or unavailable, you will need to call the package script manually using <code>--ca-cert-full-path &lt;path_to_certificate&gt;</code> after the upgrade procedure has finished.</p>
</div>
<div class="listingblock">
<div class="title">Package script call example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/usr/sbin/mgr-package-rpm-certificate-osimage --ca-cert-full-path /root/ssl-build/RHN-ORG-TRUSTED-SSL-CERT</code></pre>
</div>
</div>
<div class="paragraph">
<p>The RPM package with the certificate is stored in a salt-accessible directory such as <code>/usr/share/susemanager/salt/images/rhn-org-trusted-ssl-cert-osimage-1.0-1.noarch.rpm</code>.</p>
</div>
<div class="paragraph">
<p>The RPM package with the certificate is provided in the local build host repository <code>/var/lib/Kiwi/repo</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
<div class="title">The RPM Package with the  Certificate Must Be Specified in the Build Source</div>
<div class="paragraph">
<p>Make sure your build source Kiwi configuration contains <code>rhn-org-trusted-ssl-cert-osimage</code> as a required package in the <code>bootstrap</code> section.</p>
</div>
<div class="listingblock">
<div class="title">config.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">...
  &lt;packages type="bootstrap"&gt;
    ...
    &lt;package name="rhn-org-trusted-ssl-cert-osimage" bootinclude="true"/&gt;
  &lt;/packages&gt;
...</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="at.images.kiwi.buildchannels"><a class="anchor" href="#at.images.kiwi.buildchannels"></a><a class="link" href="#at.images.kiwi.buildchannels">Define Kiwi Build Channels with an Activation Key</a></h4>
<div class="paragraph">
<p>Create an activation key associated with the channel that your images will use.
Activation keys are mandatory for OS Image building.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
<div class="title">Relationship Between Activation Keys and Image Profiles</div>
<div class="paragraph">
<p>To build OS Images, you will need an activation key that is associated with a channel other than "SUSE Manager Default".</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/systems_create_activation_key.png" alt="systems create activation key">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the WebUI, select <span class="menuseq"><b class="menu">Main Menu</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Systems</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Activation Keys</b></span>.</p>
</li>
<li>
<p>Click <code class="guimenu">Create Key</code>.</p>
</li>
<li>
<p>Enter a <code class="guimenu">Description</code>, a <code class="guimenu">Key</code> name, and use the drop-down box to select a <code class="guimenu">Base Channel</code> to associate with the key.</p>
</li>
<li>
<p>Confirm with <b class="button">Create Activation Key</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For more information, see <a href="#bp.key.managment">[bp.key.managment]</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="at.images.kiwi.imagestore"><a class="anchor" href="#at.images.kiwi.imagestore"></a><a class="link" href="#at.images.kiwi.imagestore">Image Store</a></h3>
<div class="paragraph">
<p>OS images can require  a significant amount of storage space.
Therefore, we recommended that the OS image store is located on a partition of its own or on a btrfs subvolume, separate from the root partition.
By default, the image store will be located at <code class="path">/srv/www/os-images</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
<div class="title">Image stores for Kiwi build type</div>
<div class="paragraph">
<p>Image stores for Kiwi build type, used to build system, virtual and other images, are not supported yet.</p>
</div>
<div class="paragraph">
<p>Images are always stored in <code class="path">/srv/www/os-images/&lt;organization id&gt;</code> and are accessible via HTTP/HTTPS <code class="url"><a href="https://&lt;susemanager_host&gt;/os-images/&lt;organization" class="bare">https://&lt;susemanager_host&gt;/os-images/&lt;organization</a> id&gt;</code></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="at.images.kiwi.profile"><a class="anchor" href="#at.images.kiwi.profile"></a><a class="link" href="#at.images.kiwi.profile">Creating an Image Profile</a></h3>
<div class="paragraph">
<p>Manage Image Profiles using the WebUI.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/images_image_profiles.png" alt="images image profiles">
</div>
</div>
<div class="olist arabic">
<div class="title">Procedure: Create an Image Profile</div>
<ol class="arabic">
<li>
<p>To create an image profile select from <span class="menuseq"><b class="menu">Main Menu</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Images</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Images</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Profiles</b></span> and click <b class="button">Create</b>.</p>
<div class="imageblock">
<div class="content">
<img src="_images/images_image_create_profile_kiwi.png" alt="images image create profile kiwi">
</div>
</div>
</li>
<li>
<p>In the <code class="guimenu">Label</code> field, provide a name for the <code>Image Profile</code>.</p>
</li>
<li>
<p>Use <code>Kiwi</code> as the <code class="guimenu">Image Type</code>.</p>
</li>
<li>
<p>Image store is automatically selected.</p>
</li>
<li>
<p>Enter a <code class="guimenu">Config URL</code> to the directory containing the Kiwi configuration files:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Git URI</p>
</li>
<li>
<p>HTTPS tarball</p>
</li>
<li>
<p>Path to build host local directory</p>
</li>
</ol>
</div>
</li>
<li>
<p>Select an <code class="guimenu">Activation Key</code>. Activation keys ensure that images using a profile are assigned to the correct channel and packages.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
<div class="title">Relationship Between Activation Keys and Image Profiles</div>
<div class="paragraph">
<p>When you associate an activation key with an image profile you are ensuring any image using the profile will use the correct software channel and any packages in the channel.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Confirm with the <b class="button">Create</b> button.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Source format options</div>
<ul>
<li>
<p>Git/HTTP(S) URL to the repository</p>
<div class="paragraph">
<p>URL to the Git repository containing the sources of the image to be built.
Depending on the layout of the repository the URL can be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>https://github.com/SUSE/manager-build-profiles</pre>
</div>
</div>
<div class="paragraph">
<p>You can specify a branch after the <code>#</code> character in the URL.
In this example, we use the <code>master</code> branch:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>https://github.com/SUSE/manager-build-profiles#master</pre>
</div>
</div>
<div class="paragraph">
<p>You can specify a directory that contains the image sources after the <code>:</code> character.
In this example, we use <code>OSImage/POS_Image-JeOS6</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>https://github.com/SUSE/manager-build-profiles#master:OSImage/POS_Image-JeOS6</pre>
</div>
</div>
</li>
<li>
<p>HTTP(S) URL to the tarball</p>
<div class="paragraph">
<p>URL to the tar archive, compressed or uncompressed, hosted on the webserver.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>https://myimagesourceserver.example.org/MyKiwiImage.tar.gz</pre>
</div>
</div>
</li>
<li>
<p>Path to the directory on the build host</p>
<div class="paragraph">
<p>Enter the path to the directory with the Kiwi build system sources. This directory must be present on the selected build host.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/var/lib/Kiwi/MyKiwiImage</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="at.images.kiwi.sourceexample"><a class="anchor" href="#at.images.kiwi.sourceexample"></a><a class="link" href="#at.images.kiwi.sourceexample">Example of Kiwi sources</a></h3>
<div class="paragraph">
<p>Kiwi sources consist at least of <code>config.xml</code>.
Usually <code>config.sh</code> and <code>images.sh</code> are present as well.
Sources can also contain files to be installed in the final image under the <code>root</code> subdirectory.</p>
</div>
<div class="paragraph">
<p>For information about the Kiwi build system, see the <a href="https://doc.opensuse.org/projects/kiwi/doc/">Kiwi documentation</a>.</p>
</div>
<div class="paragraph">
<p>SUSE provides examples of fully functional image sources at the <a href="https://github.com/SUSE/manager-build-profiles">SUSE/manager-build-profiles</a> public GitHub repository.</p>
</div>
<div class="listingblock">
<div class="title">Example of JeOS config.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="utf-8"?&gt;

&lt;image schemaversion="6.1" name="POS_Image_JeOS6"&gt;
    &lt;description type="system"&gt;
        &lt;author&gt;Admin User&lt;/author&gt;
        &lt;contact&gt;noemail@example.com&lt;/contact&gt;
        &lt;specification&gt;SUSE Linux Enterprise 12 SP3 JeOS&lt;/specification&gt;
    &lt;/description&gt;
    &lt;preferences&gt;
        &lt;version&gt;6.0.0&lt;/version&gt;
        &lt;packagemanager&gt;zypper&lt;/packagemanager&gt;
        &lt;bootsplash-theme&gt;SLE&lt;/bootsplash-theme&gt;
        &lt;bootloader-theme&gt;SLE&lt;/bootloader-theme&gt;

        &lt;locale&gt;en_US&lt;/locale&gt;
        &lt;keytable&gt;us.map.gz&lt;/keytable&gt;
        &lt;timezone&gt;Europe/Berlin&lt;/timezone&gt;
        &lt;hwclock&gt;utc&lt;/hwclock&gt;

        &lt;rpm-excludedocs&gt;true&lt;/rpm-excludedocs&gt;
        &lt;type boot="saltboot/suse-SLES12" bootloader="grub2" checkprebuilt="true" compressed="false" filesystem="ext3" fsmountoptions="acl" fsnocheck="true" image="pxe" kernelcmdline="quiet"&gt;&lt;/type&gt;
    &lt;/preferences&gt;
    &lt;!--    CUSTOM REPOSITORY
    &lt;repository type="rpm-dir"&gt;
      &lt;source path="this://repo"/&gt;
    &lt;/repository&gt;
    --&gt;
    &lt;packages type="image"&gt;
        &lt;package name="patterns-sles-Minimal"/&gt;
        &lt;package name="aaa_base-extras"/&gt; &lt;!-- wouldn't be SUSE without that ;-) --&gt;
        &lt;package name="kernel-default"/&gt;
        &lt;package name="salt-minion"/&gt;
        ...
    &lt;/packages&gt;
    &lt;packages type="bootstrap"&gt;
        ...
        &lt;package name="sles-release"/&gt;
        &lt;!-- this certificate package is required to access {productname} repositories
             and is provided by {productname} automatically --&gt;
        &lt;package name="rhn-org-trusted-ssl-cert-osimage" bootinclude="true"/&gt;

    &lt;/packages&gt;
    &lt;packages type="delete"&gt;
        &lt;package name="mtools"/&gt;
        &lt;package name="initviocons"/&gt;
        ...
    &lt;/packages&gt;
&lt;/image&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="at.images.kiwi.building"><a class="anchor" href="#at.images.kiwi.building"></a><a class="link" href="#at.images.kiwi.building">Building an Image</a></h3>
<div class="paragraph">
<p>There are two ways to build an image using the WebUI.
Either select <span class="menuseq"><b class="menu">Main Menu</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Images</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Build</b></span>, or click the build icon in the <span class="menuseq"><b class="menu">Main Menu</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Images</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Profiles</b></span> list.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/images_image_build.png" alt="images image build">
</div>
</div>
<div class="olist arabic">
<div class="title">Procedure: Build an Image</div>
<ol class="arabic">
<li>
<p>Select <span class="menuseq"><b class="menu">Main Menu</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Images</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Build</b></span>.</p>
</li>
<li>
<p>Add a different tag name if you want a version other than the default <code>latest</code> (applies only to containers).</p>
</li>
<li>
<p>Select the <code class="guimenu">Image Profile</code> and a <code class="guimenu">Build Host</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
<div class="title">Profile Summary</div>
<div class="paragraph">
<p>A <code class="guimenu">Profile Summary</code> is displayed to the right of the build fields.
When you have selected a build profile detailed information about the selected profile will show up in this area.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>To schedule a build, click the <b class="button">Build</b> button.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="at.images.kiwi.inspection"><a class="anchor" href="#at.images.kiwi.inspection"></a><a class="link" href="#at.images.kiwi.inspection">Image Inspection and Salt Integration</a></h3>
<div class="paragraph">
<p>After the image is successfully built, the inspection phase begins.
During the inspection phase {susemgr} collects information about the image:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>List of packages installed in the image</p>
</li>
<li>
<p>Checksum of the image</p>
</li>
<li>
<p>Image type and other image details</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the built image type is <code>PXE</code>, a Salt pillar will also be generated.
Image pillars are stored in the <code>/srv/susemanager/pillar_data/images/</code> directory and the Salt subsystem can access details about the generated image.
Details include where the pillar is located and provided, image checksums, information needed for network boot, and more.</p>
</div>
<div class="paragraph">
<p>The generated pillar is available to all connected minions.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="at.images.kiwi.troubleshooting"><a class="anchor" href="#at.images.kiwi.troubleshooting"></a><a class="link" href="#at.images.kiwi.troubleshooting">Troubleshooting</a></h3>
<div class="paragraph">
<p>Building an image requires of several dependent steps.
When the build fails, investigation of salt states results can help you to identify the source of the failure.
Usual checks when the build fails:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The build host can access the build sources</p>
</li>
<li>
<p>There is enough disk space for the image on both the build host and the  server</p>
</li>
<li>
<p>The activation key has the correct channels associated with it</p>
</li>
<li>
<p>The build sources used are valid</p>
</li>
<li>
<p>The RPM package with the  public certificate is up to date and available at <code>/usr/share/susemanager/salt/images/rhn-org-trusted-ssl-cert-osimage-1.0-1.noarch.rpm</code>.</p>
<div class="paragraph">
<p>For more on how to refresh a public certificate RPM, see <a href="#at.images.kiwi.buildhost">Creating a Build Host</a>.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="at.images.kiwi.limitations"><a class="anchor" href="#at.images.kiwi.limitations"></a><a class="link" href="#at.images.kiwi.limitations">Limitations</a></h3>
<div class="paragraph">
<p>The section contains some known issues when working with images.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>HTTPS certificates used to access the HTTP sources or Git repositories should be deployed to the minion by a custom state file, or configured manually.</p>
</li>
<li>
<p>Importing Kiwi-based images is not supported.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="at.images.listing"><a class="anchor" href="#at.images.listing"></a><a class="link" href="#at.images.listing">Listing Image Profiles Available for Building</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>To list images available for building select <span class="menuseq"><b class="menu">Main Menu</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Images</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Images</b></span>.
A list of all images will be displayed.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/images_list_images.png" alt="images list images">
</div>
</div>
<div class="paragraph">
<p>Displayed data about images includes an image <code class="guimenu">Name</code>, its <code class="guimenu">Version</code> and the build <code class="guimenu">Status</code>.
You will also see the image update status with a listing of possible patch and package updates that are available for the image.</p>
</div>
<div class="paragraph">
<p>Clicking the <b class="button">Details</b> button on an image will provide a detailed view including an exact list of relevant patches and a list of all packages installed within the image.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The patch and the package list is only available if the inspect state after a build was successful.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</article>
  </main>
</div>
<footer class="footer">
  <p>Copyright (C) 2017-2018 <a href="https://jcayouette.github.io/personal-blog">Belief and Reason</a></p>
  <p>Except where otherwise noted, jcayouette.github.io/personal-blog, BoR, are licensed under the <a href="https://www.mozilla.org/en-US/MPL/2.0/">Mozilla Public License Version 2.0</a> (MPL-2.0).</p>
</footer>
<script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<!-- fetched from https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js -->
<script>
function focusSearchInput () { document.querySelector('#search-input').focus() }
var search = docsearch({
  appId: '#',
  apiKey: '#',
  indexName: '#',
  inputSelector: '#search-input',
  autocompleteOptions: { hint: false, keyboardShortcuts: ['s'] },
  algoliaOptions: { hitsPerPage: 10 }
}).autocomplete
search.on('autocomplete:closed', function () { search.autocomplete.setVal() })
focusSearchInput()
window.addEventListener('load', focusSearchInput)
</script>
<script src="../../_/js/site.js"></script>
<script src="../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>
  </body>
</html>
