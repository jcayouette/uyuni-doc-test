<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Best Practices :: Uyuni Documentation (Prototype)</title>
    <meta name="generator" content="Antora 1.0.3">
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="stylesheet" href="../../_/css/site-extra.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css">
    <!-- fetched from https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css -->
    <link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <a href="https://jcayouette.github.io/personal-blog">Belief and Reason</a>
        <span class="separator">//</span>
        <a href="../..">Library</a>
      </div>
      <div class="navbar-item">
        <input id="search-input" type="text" placeholder="Search docs">
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <div class="navbar-link">Projects</div>
          <div class="navbar-dropdown">
            <div class="navbar-item"><strong>Resources</strong></div>
            <a class="navbar-item" href="https://github.com/jcayouette/personal-blog">Repository</a>
            <a class="navbar-item" href="https://github.com/jcayouette/personal-blog/issues">Issue Tracker</a>
<!--
            <hr class="navbar-divider">
            <div class="navbar-item"><strong>Custom UI (coming soon!)</strong></div>
            <a class="navbar-item" href="https://gitlab.com/antora/antora-ui-default">Repository</a>
            <a class="navbar-item" href="https://gitlab.com/antora/antora-ui-default/issues">Issue Tracker</a>
            <hr class="navbar-divider">
          -->
            <a class="navbar-item" href="https://github.com/jcayouette/blob/master/contributing.adoc">Contributing</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <div class="navbar-link">Community</div>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="https://discord.gg/vmrAYE3">Discord Chat</a>
          </div>
        </div>
        <a class="navbar-item" href="https://twitter.com/BaR-project">
          <span class="icon">
            <svg aria-hidden="true" data-icon="twitter" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
              <path fill="#57aaee" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path>
            </svg>
          </span>
        </a>
      </div>
    </div>
  </nav>
</header>
<div class="main-wrapper">
<div class="navigation-container" data-component="uyuni" data-version="dev">
  <aside class="navigation">
    <div class="panels">
<div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="MAIN-manager.html">Uyuni</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="book_mgr_getting_started.html">Getting Started</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="quickstart3_chap_install_overview.html">Overview and Requirements</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.introduction">Introduction</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.prereq">Prerequisites for Installation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.prereq.scc">SUSE SCC Credentials</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.prereq.installmedia">Get Uyuni</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.prereq.hardware">Hardware Requirements</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.prereq.network">Network Requirements</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.prereq.clientos">Supported Client Systems</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="quickstart3_chap_suma_installation_jeos.html">Installation via JeOS</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.kvm.settings">Configuring KVM</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#jeos.kvm.settings">JeOS KVM Settings</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#jeos.susemgr.prep">Preparing JeOS for Uyuni</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quickstart3_chap_suma_installation_sles.html">Installation via SLES</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quickstart3_chap_suma_setup_with_yast.html">Setup and Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quickstart3_chap_suma_keys_and_first_client.html">Connecting Clients</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quickstart3_chap_suma_salt_gs.html">Introduction to Salt</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="book_mgr_best_practices.html">Best Practices</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="book_suma_reference_manual.html">WebUI Reference</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="book_suma_advanced_topics.html">Advanced Topics</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="navigation-explore" data-panel="explore">
  <div class="context">
    <span class="title">Uyuni</span>
    <span class="version">dev</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Uyuni</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="MAIN-manager.html">dev</a>
        </li>
        <li class="version">
          <a href="../3.2/MAIN-manager.html">3.2</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
  <main class="main">
<div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
  <a href="MAIN-manager.html" class="home-link"></a>
<nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="MAIN-manager.html">Uyuni</a></li>
    <li class="crumb"><a href="book_mgr_best_practices.html">Best Practices</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="versions-menu-toggle" title="Show other versions of page">dev</button>
  <div class="versions-menu">
    <a class="version is-current" href="book_mgr_best_practices.html">dev</a>
    <a class="version" href="../3.2/book_mgr_best_practices.html">3.2</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/jcayouette/uyuni-doc-test/edit/master/docs/modules/ROOT/pages/book_mgr_best_practices.adoc">Edit this Page</a></div>
</div>
<article class="doc">
<h1>Best Practices</h1>
<div class="sect1">
<h2 id="mgr.conceptual.overview"><a class="anchor" href="#mgr.conceptual.overview"></a>1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This document targets system administrators.</p>
</div>
<div class="sect2">
<h3 id="_what_s_covered_in_this_guide"><a class="anchor" href="#_what_s_covered_in_this_guide"></a><a class="link" href="#_what_s_covered_in_this_guide">1.1. What&#8217;s Covered in this Guide?</a></h3>
<div class="paragraph">
<p>This document describes SUSE recommended best practices for .
This information has been collected from a large number of successful  real world implementations and includes feedback provided by product management, sales and engineering.</p>
</div>
<div class="paragraph">
<p><a href="common_version_info.html#common-version-info" class="page">Version Information</a></p>
</div>
<div class="paragraph">
<p>This chapter will discuss the following topics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Prerequisites</p>
</li>
<li>
<p>Network Requirements</p>
</li>
<li>
<p>Hardware Requirements</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a><a class="link" href="#_prerequisites">1.2. Prerequisites</a></h3>
<div class="paragraph">
<div class="title">Purchased Registration Keys</div>
<p>During initial setup  will request a product <code class="systemitem">Registration Key</code>.
This key will be provided to you after purchasing the product.
You can find your key located under your SUSE Customer Center account.
Log-in with your SUSE Customer Center credentials or register for a new account. {mdash}https://scc.suse.com</p>
</div>
<div class="paragraph">
<div class="title">Evaluation Keys</div>
<p>If you wish to run a test system (non-production) a 60 day evaluation key may be obtained.
On the  product page click <b class="button">TRY SUSE MANAGER</b>.
The evaluation key limits the number of systems that may be registered with SUSE Manager to 10.
For more information see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.suse.com/products/suse-manager/" class="bare">https://www.suse.com/products/suse-manager/</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">SCC Organization Credentials</div>
<p>During setup you will also be asked to enter your SUSE Customer Center <code class="systemitem">Organization Credentials</code>.</p>
</div>
<div class="paragraph">
<div class="title">Users and Passwords</div>
<p>During both the SUSE Linux Enterprise installation and setup of  several users and passwords will be created:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SUSE Linux Enterprise root user account</p>
</li>
<li>
<p>PostgreSQL database user and password</p>
</li>
<li>
<p>Certificate of Authority password</p>
</li>
<li>
<p> administrator user and password</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title=":bulb:"></i>
</td>
<td class="content">
<div class="title">Safe Passwords</div>
<div class="paragraph">
<p>Maintain security by creating safe passwords.
Store passwords within a secure location.
Use the following guidelines when creating your passwords.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>At least 8 characters long</p>
</li>
<li>
<p>Should contain uppercase characters <code class="command">A B C</code></p>
</li>
<li>
<p>Should contain lowercase characters <code class="command">a b c</code></p>
</li>
<li>
<p>Should contain numbers <code class="command">1 2 3</code></p>
</li>
<li>
<p>Should contain symbols <code class="command">~ ! @ #</code></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="bp.chapt.intro.network.requires"><a class="anchor" href="#bp.chapt.intro.network.requires"></a><a class="link" href="#bp.chapt.intro.network.requires">1.3. Network Requirements</a></h3>
<div class="paragraph">
<p> and SUSE Manager Proxy both contact several external addresses in order to maintain updates and subscriptions.
The following lists provide the up-to-date hostnames for each service requiring permission when used in combination with corporate firewall and content filters.</p>
</div>
<div class="ulist">
<div class="title">SUSE Customer Center Hostnames (Required)</div>
<ul>
<li>
<p><a href="https://scc.suse.com" class="bare">https://scc.suse.com</a></p>
</li>
<li>
<p><a href="https://updates.suse.com" class="bare">https://updates.suse.com</a></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Novell Customer Center Hostnames (Legacy)</div>
<ul>
<li>
<p><a href="https://secure-www.novell.com" class="bare">https://secure-www.novell.com</a></p>
</li>
<li>
<p><a href="https://nu.novell.com" class="bare">https://nu.novell.com</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For  to function properly it requires the following pre-configured components within your network.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
<div class="title">Websocket Support</div>
<div class="paragraph">
<p>If SUSE Manager is accessed via an HTTP proxy (Squid, etc) the proxy must support websocket connections.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Networking Hardware</div>
<p>The following table provides networking hardware info.
As  will likely be managing a large number of systems (quite possibly numbering in hundreds or even thousands), networking hardware that increases bandwidth becomes increasingly more valuable.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Hardware</th>
<th class="tableblock halign-left valign-top">Recommended</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100Mbits/s Link</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Non-production test server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1Gb/s Link<br></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Production Server</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">DHCP Server</div>
<p>The purpose of the Dynamic Host Configuration Protocol (DHCP) is to assign network settings centrally (from a server) rather than configuring them locally on each and every workstation.
A host configured to use DHCP does not have control over its own static address.
It is enabled to configure itself completely and automatically according to directions from the server.
A DHCP server supplies not only the IP address and the netmask, but also the host name, domain name, gateway, and name server addresses for the client to use.
For more information on configuring DHCP see also:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.suse.com/documentation/sles-12/book_sle_admin/data/cha_dhcp.html" class="bare">https://www.suse.com/documentation/sles-12/book_sle_admin/data/cha_dhcp.html</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">FQDN (Fully Qualified Domain Name)</div>
<p>DNS assists in assigning an IP address to one or more names and assigning a name to an IP address.
In Linux, this conversion is usually carried out by a special type of software known as bind.
The machine that takes care of this conversion is called a <em>name server</em>.
The names make up a hierarchical system in which each name component is separated by a period.
The name hierarchy is, however, independent of the IP address hierarchy described above.
Consider a complete name, such as <code class="replaceable">jupiter.example.com</code>, written in the format <code class="replaceable">hostname.domain</code>.
A full name, referred to as a <em>fully qualified domain name</em> (FQDN), consists of a host name and a domain name (example.com).
For more information on configuring a name server see also:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.suse.com/documentation/sles-12/book_sle_admin/data/sec_basicnet_nameres.html" class="bare">https://www.suse.com/documentation/sles-12/book_sle_admin/data/sec_basicnet_nameres.html</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">DNS (Dynamic Name System) Server</div>
<p>A DNS Server is required for resolving domain names and host names into IP addresses.
For example, the IP address 192.168.2.100 could be assigned to the host name jupiter.
In the case of  the DNS server must be resolvable both via DNS and reverse lookup.
For more information on configuring DNS see also:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.suse.com/documentation/sles-12/book_sle_admin/data/cha_dns.html" class="bare">https://www.suse.com/documentation/sles-12/book_sle_admin/data/cha_dns.html</a></p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
<div class="title">Microsoft NT Lan Manager Compatibility</div>
<div class="paragraph">
<p>Microsoft NT Lan Manager can be configured for use with basic authentication and will work with  but authentication using native (NTLM) Microsoft protocols is not supported.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Open Port List</div>
<p>During the setup process of  all required ports will be opened automatically.
The following tables provide you with an overview of ports which are used by .</p>
</div>
<table id="tab.install.ports.server" class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Required Server Ports</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Port</th>
<th class="tableblock halign-left valign-top">Protocol</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSH</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">67</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">69</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TFTP, used to support PXE services</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP, used in some bootstrap cases</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">123</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NTP time service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS, used for WebUI, client, Proxy server, and API traffic</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4505</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Salt, used by the Salt-master to accept communication requests from minions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4506</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Salt, used by the Salt-master to accept communication requests from minions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5222</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XMPP client, used for communications with the <code class="systemitem">osad</code> daemon on traditional client systems</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5269</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XMPP server, used for pushing actions to SUSE Manager Proxy</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For more information, see <a href="#">advanced.topics.app.ports.server.adoc#at-ports</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title=":bulb:"></i>
</td>
<td class="content">
<div class="title">Denying External Network Access</div>
<div class="paragraph">
<p>When your network requires denying external network access to and from , an RMT or SMT Server may be registered against .
The RMT or SMT server can then be used to synchronize the necessary SUSE repositories.
For more information on utilizing an RMT or SMT Server, see: <a href="#disconnect-setup">Disconnected Setup with RMT or SMT (DMZ)</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
<div class="title">Blocking Port 80</div>
<div class="paragraph">
<p>Port 80 may be blocked as traffic is automatically redirected through port 443.
It should be noted you will lose redirection.
Keep in mind you will need additional ports open when using traditional clients in combination with <code class="systemitem">osad</code> (XMPP TCP 5222).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_hardware_recommendations"><a class="anchor" href="#_hardware_recommendations"></a><a class="link" href="#_hardware_recommendations">1.4. Hardware Recommendations</a></h3>
<div class="paragraph">
<p>This section provides tested production recommendations for small to mid size networks that will be managed by .</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Hardware</th>
<th class="tableblock halign-left valign-top">Recommended</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multi-core 64bit CPU (x86_64, ppc64le).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RAM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum 4 GB+ for test server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum 16 GB+ for base installation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum 32 GB+ for a production server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Free Disk Space</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum 100 GB+ for root partition</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum 50 GB+ for <code class="path">/var/lib/pgsql</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum 50 GB per SUSE product, or 200 GB per Red Hat product <code class="path">/var/spacewalk</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">Advised Number of CPUs</div>
<p>Review the following list for CPU recommendations.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Connecting 200 systems or less to  : 4 CPUs</p>
</li>
<li>
<p>Connecting 500 systems or less to  : 4-8 CPUs</p>
</li>
<li>
<p>When implementing RHEL channels: 8 CPUs</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Disk Space</div>
<p> stores information in several directories.
For these directories it is strongly recommend that you create separate file-systems or use an NFS share.
During installation one VG will be created that contains all disks selected during installation.
Therefore the first disk should be large enough to contain the OS.
Normally 20GB - 50GB is sufficient.
A 50 GB partition would be the recommended size.
The following directories should be created on a separate file-system.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code class="path">/var/spacewalk</code> This directory will contain all rpm&#8217;s. Each RPM will be stored only once.
The needed size will depend on the number of channels and type of channels that will be downloaded.
The general rule would be that per SUSE Service Pack (including SUSE RedHat Expanded Support) around 50 GB should be enough.
An extra 150 GB for RES/CentOS repositories should be added on top.
If other non-enterprise distributions (eg OpenSUSE) are added,  calculated 50 GB per distribution.
This directory could also be stored on an NFS share.</p>
</li>
<li>
<p><code class="path">/var/lib/pgsql</code> This directory contains the PostgreSQL database.
Recommended is to create a file-system of 50 GB.
This volume should be monitored, because a full file-system where the database is running on can cause unexpected errors (and this even months after it happened).</p>
</li>
<li>
<p><code class="path">/srv/tftpboot</code> If PXE/cobbler is used, this directory will contain the images (initrd and linux) for all created auto-installation profiles.
Each image is around 50 MB.
Depending on the number of profiles a decision has to be made if it would be useful to move this directory to a separate file-system.</p>
</li>
<li>
<p><code class="path">/var/log</code> As SUSE Manager writes a large number of logs, it is recommended to create a separate file-system for /var/log.
The size should be around 20 GB.</p>
</li>
<li>
<p><code class="path">/var/spacewalk/db_backup</code> For the backup of the PostgreSQL database, it is recommended the create a separate directory.
As the database can be rather large, it is advised to mount it on a separate file-system.
A safe estimate would be to provide twice space as for the directory created for <code class="path">/var/lib/pqsql</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Supported Databases</div>
<p> 3 and later no longer provides support for an external Oracle database.
The default database is an embedded PostgreSQL.
During  setup the database will be created and configured.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="suma.choosing.dist.scheme"><a class="anchor" href="#suma.choosing.dist.scheme"></a><a class="link" href="#suma.choosing.dist.scheme">2. Managing Your Subscriptions</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are two methods for managing your subscriptions.
Both methods access SUSE Customer Center
and provide specialized benefits.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Directly connecting to SUSE Customer Center is the recommended default way of managing your  server.</p>
</li>
<li>
<p>If you have special network security requirements which do not allow access from your internal network to the internet then you can use SUSE Linux Enterprise Server 12 running the {rmtool} (RMT) or {smtool} (SMT).  These tools will contact SUSE Customer Center from a system connected to the external network and obtain updates for your clients which you may then mount on your internal  server. This is the preferred method for managing client systems within a highly secure network infrastructure.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="scc"><a class="anchor" href="#scc"></a><a class="link" href="#scc">2.1. SUSE Customer Center (SCC)</a></h3>
<div class="paragraph">
<p>SUSE Customer Center
(SCC) is the central place to manage your purchased SUSE
subscriptions, helping you access your update channels and get in contact with SUSE
experts.
The user-friendly interface gives you a centralized view of all your SUSE
subscriptions, allowing you to easily find all subscription information you need.
The improved registration provides faster access to your patches and updates. SUSE Customer Center
is also designed to provide a common platform for your support requests and feedback.
Discover a new way of managing your SUSE
account and subscriptions via one interface&#8212;&#8203;anytime, anywhere.
For more information on using SUSE Customer Center
, see <a href="https://scc.suse.com/docs/userguide" class="bare">https://scc.suse.com/docs/userguide</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="disconnect-setup"><a class="anchor" href="#disconnect-setup"></a><a class="link" href="#disconnect-setup">2.2. Disconnected Setup with RMT or SMT (DMZ)</a></h3>
<div class="paragraph">
<p>If it is not possible to connect 
directly or via a proxy to the Internet, a disconnected setup in combination with RMT or SMT is the recommended solution.
In this scenario, RMT or SMT stays in an &#8220;external&#8221;
 network with a connection to SUSE Customer Center
 and synchronizes the software channels and repositories on a removable storage medium.
Then you separate the storage medium from RMT or SMT, and mount it locally on your 
 server to read the updated data.</p>
</div>
<div class="paragraph">
<div class="title">RMT</div>
<p>The successor of SMT and currently runs on the following systems:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SUSE Linux Enterprise 15 (when available)</p>
</li>
<li>
<p>Temporarily (for testing only): 12 SP2, and 12 SP3</p>
</li>
<li>
<p>Not officially supported: openSUSE Leap 42.2, Leap 42.3, and openSUSE Tumbleweed</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>RMT allows you to provision updates for all of your devices running a product based on SUSE Linux Enterprise
 12 SPx and later as well as openSUSE Leap.</p>
</div>
<div class="paragraph">
<div class="title">SMT</div>
<p>The predecessor of RMT and is no longer actively developed.
It runs on SUSE Linux Enterprise Server
 12 SPx and allows you to provision updates for products based on SUSE Linux Enterprise
 12 SPx and earlier.
You will still need it, if you want to update SUSE Linux Enterprise
 11 clients.</p>
</div>
<div class="sect3">
<h4 id="rmtool"><a class="anchor" href="#rmtool"></a><a class="link" href="#rmtool">2.2.1. {rmtool} (RMT) and Disconnected Setup (DMZ)</a></h4>
<div class="paragraph">
<p>The following procedure will guide you through using RMT.
It will work best with a dedicated RMT instance per 
.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: RMT: Fetching Repository Data from SUSE Customer Center</div>
<ol class="arabic">
<li>
<p>Configure RMT in the external network with SCC. For details about configuring RMT, see the official guide (when available).</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Preparation work:</p>
<div class="paragraph">
<p>Run <code class="command">rmt-cli sync</code> to download available products and repositories data for your organization from SCC.</p>
</div>
<div class="paragraph">
<p>Run <code class="command">rmt-cli products list --all</code> to see the list of products that are available for your organization.</p>
</div>
<div class="paragraph">
<p>Run <code class="command">rmt-cli repos list --all</code> to see the list of all repositories available.</p>
</div>
</li>
<li>
<p>With <code class="command">rmt-cli repos enable</code> enable repositories you want to mirror.</p>
</li>
<li>
<p>With <code class="command">rmt-cli products enable</code>enable products. For example, to enable SLES _15:</p>
<div class="listingblock">
<div class="content">
<pre>rmt-cli product enable sles/15/x86_64</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Using RMT, mirror all required repositories.</p>
</li>
<li>
<p>Get the required JSON responses from SCC and save them as files at the specified path (for example, <code class="path">/mnt/usb</code> ).</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
<div class="title">Write Permissions for RMT User</div>
The directory being written to must be writeable for the same user as the rmt service.
The rmt user setting is defined in the <code>cli</code> section of <code class="path">/etc/rmt.conf</code>
.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Enter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{prompt.root}rmt-cli export data /mnt/usb</pre>
</div>
</div>
</li>
<li>
<p>Export settings about repositories to mirror to the specified path (in this case, <code class="path">/mnt/usb</code> ); this command will create a <code class="path">repos.json</code> file there:</p>
<div class="listingblock">
<div class="content">
<pre>{prompt.root}rmt-cli export settings /mnt/usb</pre>
</div>
</div>
</li>
<li>
<p>Mirror the repositories according to the settings in the <code class="path">repos.json</code> file to the specified path (in this case, <code class="path">/mnt/usb</code> ).</p>
<div class="listingblock">
<div class="content">
<pre>{prompt.root}rmt-cli export repos /mnt/usb</pre>
</div>
</div>
</li>
<li>
<p>Unmount the storage medium and carry it securely to your  server.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>On the 
server, continue with <a href="#disconnect.mgr.update-repos">Updating Repositories on  From Storage Media</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sub.mgr.tool"><a class="anchor" href="#sub.mgr.tool"></a><a class="link" href="#sub.mgr.tool">2.2.2. {smtool} (SMT) and Disconnected Setup (DMZ)</a></h4>
<div class="paragraph">
<p>The following procedure will guide you through using SMT.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: SMT: Fetching Repository Data from SUSE Customer Center</div>
<ol class="arabic">
<li>
<p>Configure SMT in the external network with SCC. For details about configuring SMT with SUSE Linux Enterprise 12, see <a href="https://www.suse.com/documentation/sles-12/book_smt/data/book_smt.html" class="bare">https://www.suse.com/documentation/sles-12/book_smt/data/book_smt.html</a>.</p>
</li>
<li>
<p>Using SMT, mirror all required repositories.</p>
</li>
<li>
<p>Create a &#8220;database replacement file&#8221; (for example, <code class="path">/tmp/dbrepl.xml</code> ).</p>
<div class="listingblock">
<div class="content">
<pre>{prompt.root}smt-sync --createdbreplacementfile /tmp/dbrepl.xml</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="pro.mgr.tool.mount.storage" class="olist arabic">
<ol class="arabic">
<li>
<p>Mount a removable storage medium such as an external hard disk or USB flash drive.</p>
</li>
<li>
<p>Export the data to the mounted medium:</p>
<div class="listingblock">
<div class="content">
<pre>smt-sync --todir /media/disk/
smt-mirror --dbreplfile /tmp/dbrepl.xml --directory /media/disk \
           --fromlocalsmt -L /var/log/smt/smt-mirror-export.log</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
<div class="title">Write Permissions for SMT User</div>
The directory being written to must be writeable for the same user as the smt daemon (user=smt). The smt user setting is defined in <code class="path">/etc/smt.conf</code>
.
You can check if the correct user is specified via the following command:
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>{prompt.root}egrep '^smtUser' /etc/smt.conf</pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>+
.Keeping the Disconnected Server Up-to-date
NOTE: <code class="command">smt-sync</code> also exports your subscription data.
To keep 
 up-to-date with your subscriptions, you must frequently import and export this data.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Unmount the storage medium and carry it securely to your  server.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>On the 
server, continue with <a href="#disconnect.mgr.update-repos">Updating Repositories on  From Storage Media</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="disconnect.mgr.update-repos"><a class="anchor" href="#disconnect.mgr.update-repos"></a><a class="link" href="#disconnect.mgr.update-repos">2.2.3. Updating Repositories on  From Storage Media</a></h4>
<div class="paragraph">
<p>This procedure will show you how to update the repositories on the 
server from the storage media.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: Updating the Server from the Storage Medium</div>
<ol class="arabic">
<li>
<p>Mount the storage medium on your  server (for example, at <code class="path">/media/disk</code> ).</p>
</li>
<li>
<p>Specify the local path on the  server in <code>/etc/rhn/rhn.conf</code>:</p>
<div class="listingblock">
<div class="content">
<pre>server.susemanager.fromdir = /media/disk</pre>
</div>
</div>
<div class="paragraph">
<p>This setting is mandatory for SUSE Customer Center
and <code class="command">mgr-sync</code>.</p>
</div>
</li>
<li>
<p>Restart Tomcat:</p>
<div class="listingblock">
<div class="content">
<pre>systemctl restart tomcat</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="pro.mgr.tool.sync" class="olist arabic">
<ol class="arabic">
<li>
<p>Before performing another operation on the server execute a full sync:</p>
<div class="listingblock">
<div class="content">
<pre>mgr-sync refresh   # SCC (fromdir in rhn.conf required!)</pre>
</div>
</div>
</li>
<li>
<p><code class="command">mgr-sync</code> can now be executed normally:</p>
<div class="listingblock">
<div class="content">
<pre>mgr-sync list channels
mgr-sync add channel channel-label</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title=":warning:"></i>
</td>
<td class="content">
<div class="title">Data Corruption</div>
The disk must always be available at the same mount point.
To avoid data corruption, do not trigger a sync, if the storage medium is not mounted.
If you have already added a channel from a local repository path, you will not be able to change its URL to point to a different path afterwards.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Up-to-date data is now available on your 
server and is ready for updating client systems.
According to your maintenance windows or update schedule refresh the data on the storage medium with RMT or SMT.</p>
</div>
</div>
<div class="sect3">
<h4 id="_refreshing_data_on_the_storage_medium"><a class="anchor" href="#_refreshing_data_on_the_storage_medium"></a><a class="link" href="#_refreshing_data_on_the_storage_medium">2.2.4. Refreshing Data on the Storage Medium</a></h4>
<div class="olist arabic">
<div class="title">Procedure: Refreshing Data on the Storage Medium from RMT or SMT</div>
<ol class="arabic">
<li>
<p>On your  server, unmount the storage medium and carry it to your RMT or SMT.</p>
</li>
<li>
<p>On your RMT or SMT system, continue with the synchronization step (either <a href="#pro.rmtool.export.repos">[pro.rmtool.export.repos]</a> or <a href="#pro.mgr.tool.sync">[pro.mgr.tool.sync]</a>).</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title=":warning:"></i>
</td>
<td class="content">
<div class="title">Data Corruption</div>
<div class="paragraph">
<p>The storage medium must always be available at the same mount point.
To avoid data corruption, do not trigger a sync if the storage medium is not mounted.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>This concludes using RMT or SMT with 
.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bp.expanded-support"><a class="anchor" href="#bp.expanded-support"></a><a class="link" href="#bp.expanded-support">3. Expanded Support</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the following sections find information about Red Hat and Centos clients.</p>
</div>
<div class="sect2">
<h3 id="bp.expanded-support.resclients"><a class="anchor" href="#bp.expanded-support.resclients"></a><a class="link" href="#bp.expanded-support.resclients">3.1. Managing Red Hat Enterprise Linux Clients</a></h3>
<div class="paragraph">
<p>The following sections provide guidance on managing Red Hat Expanded Support clients, this includes Salt minions and traditional systems.</p>
</div>
<div class="sect3">
<h4 id="bp.expanded-support.resclients.server"><a class="anchor" href="#bp.expanded-support.resclients.server"></a><a class="link" href="#bp.expanded-support.resclients.server">3.1.1. Server Configuration for Red Hat Enterprise Linux Channels</a></h4>
<div class="paragraph">
<p>This section provides guidance on server configuration for Red Hat Enterprise Linux Channels provided by SUSE.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Minimum of 8 GB RAM and at least two physical or virtual CPUs. Taskomatic will use one of these CPUs.</p>
</li>
<li>
<p>Taskomatic requires of minimum of 3072 MB RAM. This should be set in <code class="path">/etc/rhn/rhn.conf</code>:</p>
<div class="listingblock">
<div class="content">
<pre>taskomatic.java.maxmemory=3072</pre>
</div>
</div>
</li>
<li>
<p>Provision enough disk space. <code class="path">/var/spacewalk</code> contains all mirrored RPMs. For example, Red Hat Enterprise Linux 6 x86_64 channels require 90 GB and more.</p>
</li>
<li>
<p>LVM or an NFS mount is recommended.</p>
</li>
<li>
<p>Access to RHEL 5/6/7 Subscription Media.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title=":warning:"></i>
</td>
<td class="content">
<div class="title">Access to RHEL Media or Repositories</div>
<div class="paragraph">
<p>Access to Red Hat base media repositories and RHEL installation media is the responsibility of the user.
Ensure that all your RHEL systems obtain support from RHEL or all your RHEL systems obtain support from SUSE.
If you do not follow these practices you may violate terms with Red Hat.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="bp.expanded-support.resclients.tips"><a class="anchor" href="#bp.expanded-support.resclients.tips"></a><a class="link" href="#bp.expanded-support.resclients.tips">3.1.2. Red Hat Enterprise Linux Channel Management Tips</a></h4>
<div class="paragraph">
<p>This section provides tips on Red Hat Enterprise Linux channel management.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The base parent distribution Red Hat Enterprise Linux channel per architecture contains zero packages. No base media is provided by SUSE. The RHEL media or installation ISOs should be added as child channels of the Red Hat Enterprise Linux parent channel.</p>
</li>
<li>
<p>The Red Hat Enterprise Linux and tools channels are provided by SUSE Customer Center (SCC) using <code class="command">mgr-sync</code>.</p>
</li>
<li>
<p>It can take up to 24 hours for an initial channel synchronization to complete.</p>
</li>
<li>
<p>When you have completed the initial synchronization process of any Red Hat Enterprise Linux channel it is recommended to clone the channel before working with it. This provides you with a backup of the original synchronization.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_mirroring_rhel_media_into_a_channel"><a class="anchor" href="#_mirroring_rhel_media_into_a_channel"></a><a class="link" href="#_mirroring_rhel_media_into_a_channel">3.1.3. Mirroring RHEL Media into a Channel</a></h4>
<div class="paragraph">
<p>The following procedure guides you through setup of the RHEL media as a  channel.
All packages on the RHEL media will be mirrored into a child channel located under RES 5/6/7 distribution per architecture.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: Mirroring RHEL Media into a Channel</div>
<ol class="arabic">
<li>
<p>Create a new Channel by log in to the WebUI and selecting <span class="menuseq"><b class="menu">Channels</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Manage Software Channels</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Create Channel</b></span> .</p>
</li>
<li>
<p>Fill in basic channel details and add the channel as a child to the corresponding RES 5/6/7 distribution channel per architecture from SCC. The base parent channel should contain zero packages.</p>
</li>
<li>
<p>Modify the RES 5/6/7 activation key to include this new child channel.</p>
</li>
<li>
<p>As {rootuser} on the  command line copy the ISO to the <code class="path">/tmp</code> directory.</p>
</li>
<li>
<p>Create a directory to contain the media content:</p>
<div class="listingblock">
<div class="content">
<pre>{prompt.root}mkdir -p /srv/www/htdocs/pub/rhel</pre>
</div>
</div>
</li>
<li>
<p>Mount the ISO:</p>
<div class="listingblock">
<div class="content">
<pre>{prompt.root}mount -o loop /tmp/name_of_iso /srv/www/htdocs/pub/rhel</pre>
</div>
</div>
</li>
<li>
<p>Start <code class="command">spacewalk-repo-sync</code> to synchronize Red Hat Enterprise Linux 7 packages:</p>
<div class="listingblock">
<div class="content">
<pre>{prompt.root}spacewalk-repo-sync -c channel_name -u https://127.0.0.1/pub/rhel/
Repo URL: https://127.0.0.1/pub/rhel/
Packages in repo:              [...]
Packages already synced:       [...]
Packages to sync:              [...]
[...]</pre>
</div>
</div>
<div class="paragraph">
<p>To synchronize RES 5/6 packages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{prompt.root}spacewalk-repo-sync -c channel_name -u https://127.0.0.1/pub/rhel/Server/
Repo URL: https://127.0.0.1/pub/rhel/Server/
Packages in repo:              [...]
Packages already synced:       [...]
Packages to sync:              [...]
[...]</pre>
</div>
</div>
</li>
<li>
<p>When the channel has completed the synchronization process you can use the channel as any normal  channel.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Attempting to synchronize the repository will sometimes fail with this error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[Errno 256] No more mirrors to try.</pre>
</div>
</div>
<div class="paragraph">
<p>To troubleshoot this error, look at the HTTP protocol to determine if <code class="command">spacewalk-repo-sync</code> is running:</p>
</div>
<div class="olist arabic">
<div class="title">procedure: Debug spacewalk-repo-sync</div>
<ol class="arabic">
<li>
<p>Start debugging mode with <code class="command">export URLGRABBER_DEBUG=DEBUG</code></p>
</li>
<li>
<p>Check the output of <code class="command">/usr/bin/spacewalk-repo-sync --channel <em>&lt;channel-label&gt;</em> --type yum</code></p>
</li>
<li>
<p>If you want to disable debug mode, use <code class="command">unset URLGRABBER_DEBUG</code></p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_registering_res_salt_minions_with"><a class="anchor" href="#_registering_res_salt_minions_with"></a><a class="link" href="#_registering_res_salt_minions_with">3.1.4. Registering RES Salt Minions with </a></h4>
<div class="paragraph">
<p>This section will guide you through registering RHEL minions with .</p>
</div>
<div class="paragraph">
<p>This section assumes you have updated your server to the latest patch level.</p>
</div>
<div class="sect4">
<h5 id="_synchronizing_appropriate_red_hat_enterprise_linux_channels"><a class="anchor" href="#_synchronizing_appropriate_red_hat_enterprise_linux_channels"></a><a class="link" href="#_synchronizing_appropriate_red_hat_enterprise_linux_channels">Synchronizing Appropriate Red Hat Enterprise Linux Channels</a></h5>
<div class="paragraph">
<p>Ensure you have the corresponding Red Hat Enterprise Linux product enabled and required channels have been fully synchronized:</p>
</div>
<div class="ulist">
<div class="title">RHEL 7.x</div>
<ul>
<li>
<p>Product: Red Hat Enterprise Linux 7</p>
</li>
<li>
<p>Mandatory channels: <code class="systemitem">rhel-x86_64-server-7</code> , <code class="systemitem">res7-suse-manager-tools-x86_64</code> , <code class="systemitem">res7-x86_64</code> systemitem&gt;</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">RHEL 6.x</div>
<ul>
<li>
<p>Product: Red Hat Enterprise Linux 6</p>
</li>
<li>
<p>Mandatory channels: <code class="systemitem">rhel-x86_64-server-6</code> , <code class="systemitem">res6-suse-manager-tools-x86_64</code> , <code class="systemitem">res6-x86_64</code></p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title=":bulb:"></i>
</td>
<td class="content">
<div class="title">Checking Synchronization Progress</div>
<div class="paragraph">
<p>To check if a channel has finished synchronizing you can do one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>From the WebUI browse to <span class="menuseq"><b class="menu">Admin</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Setup Wizard</b></span> and select the <b class="menuref">SUSE Products</b> tab. Here you will find a percent completion bar for each product.</p>
</li>
<li>
<p>Alternatively, you may check the synchronization log file located under <code class="path">/var/log/rhn/reposync/channel-label.log</code> using cat or the tailf command. Keep in mind that base channels can contain multiple child channels. Each of these child channels will generate its own log during the synchronization progress. Do not assume a channel has finished synchronizing until you have checked all relevant log files including base and child channels.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Create an activation key associated with the Red Hat Enterprise Linux channel.</p>
</div>
</div>
<div class="sect4">
<h5 id="_creating_a_bootstrap_repository"><a class="anchor" href="#_creating_a_bootstrap_repository"></a><a class="link" href="#_creating_a_bootstrap_repository">Creating a Bootstrap Repository</a></h5>
<div class="paragraph">
<p>The following procedure demonstrate creating a bootstrap repository for RHEL:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the server command line as root, create a bootstrap repo for RHEL with the following command:</p>
<div class="listingblock">
<div class="content">
<pre>mgr-create-bootstrap-repo RHEL_activation_channel_key</pre>
</div>
</div>
</li>
<li>
<p>Rename <code class="command">bootstrap.sh</code> to <code class="command">resversion-boostrap.sh</code>:</p>
<div class="listingblock">
<div class="content">
<pre>{prompt.root}cp bootstrap.sh res7-bootstrap.sh</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_register_a_salt_minion_via_bootstrap"><a class="anchor" href="#_register_a_salt_minion_via_bootstrap"></a><a class="link" href="#_register_a_salt_minion_via_bootstrap">3.1.5. Register a Salt Minion via Bootstrap</a></h4>
<div class="paragraph">
<p>The following procedure will guide you through registering a Salt minion using the bootstrap script.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: Registration Using the Bootstrap Script</div>
<ol class="arabic">
<li>
<p>For your new minion download the bootstrap script from the  server:</p>
<div class="listingblock">
<div class="content">
<pre>wget --no-check-certificate https://`server`/pub/bootstrap/res7-bootstrap.sh</pre>
</div>
</div>
</li>
<li>
<p>Add the appropriate res-gpg-pubkey-<mark><mark></mark>-<mark></mark></mark>.key to the <code>ORG_GPG_KEY</code> key parameter, comma delimited in your <code class="command">res7-bootstrap.sh</code> script. These are located on your  server at:</p>
<div class="listingblock">
<div class="content">
<pre>http://`server`/pub/</pre>
</div>
</div>
</li>
<li>
<p>Make the <code class="command">res7-bootstrap.sh</code> script executable and run it. This will install necessary Salt packages from the bootstrap repository and start the Salt minion service:</p>
<div class="listingblock">
<div class="content">
<pre>{prompt.root}chmod +x res7-bootstrap.sh{prompt.root}./res7-boostrap.sh</pre>
</div>
</div>
</li>
<li>
<p>From the  WebUI select <span class="menuseq"><b class="menu">Salt</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Keys</b></span> and accept the new minion&#8217;s key.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
<div class="title">Troubleshooting Bootstrap</div>
<div class="paragraph">
<p>If bootstrapping a minion fails it is usually caused by missing packages.
These missing packages are contained on the RHEL installation media.
The RHEL installation media should be loop mounted and added as a child channel to the Red Hat Enterprise Linux channel.
See the warning in <a href="#bp.expanded-support.resclients">Managing Red Hat Enterprise Linux Clients</a> on access to RHEL Media.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_manual_salt_minion_registration"><a class="anchor" href="#_manual_salt_minion_registration"></a><a class="link" href="#_manual_salt_minion_registration">3.1.6. Manual Salt Minion Registration</a></h4>
<div class="paragraph">
<p>The following procedure will guide you through the registration of a Salt minion manually.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add the bootstrap repository:</p>
<div class="listingblock">
<div class="content">
<pre>yum-config-manager --add-repo https://`server`/pub/repositories/res/7/bootstrap</pre>
</div>
</div>
</li>
<li>
<p>Install the <span class="package">salt-minion</span> package:</p>
<div class="listingblock">
<div class="content">
<pre>{prompt.root}yum install salt-minion</pre>
</div>
</div>
</li>
<li>
<p>Edit the Salt minion configuration file to point to the  server:</p>
<div class="listingblock">
<div class="content">
<pre>{prompt.root}mkdir /etc/salt/minion.d{prompt.root}echo "master:`server_fqdn`" &gt; /etc/salt/minion.d/susemanager.conf</pre>
</div>
</div>
</li>
<li>
<p>Start the minion service:</p>
<div class="listingblock">
<div class="content">
<pre>{prompt.root}systemctl start salt-minion</pre>
</div>
</div>
</li>
<li>
<p>From the  WebUI select the <span class="menuseq"><b class="menu">Salt</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Keys</b></span> and accept the new minion&#8217;s key.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bp.expanded-support.centos_repos.trad"><a class="anchor" href="#bp.expanded-support.centos_repos.trad"></a><a class="link" href="#bp.expanded-support.centos_repos.trad">3.2. Preparing Channels and Repositories for CentOS Traditional Clients</a></h3>
<div class="paragraph">
<p>This following section provides an example procedure for configuring CentOS channels and repositories and finally registering a CentOS client with .</p>
</div>
<div class="paragraph">
<p>These steps will be identical for Scientific Linux and Fedora.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: Preparing Channels and Repositories</div>
<ol class="arabic">
<li>
<p>As {rootuser} install <span class="package">spacewalk-utils</span> on your  server:</p>
<div class="listingblock">
<div class="content">
<pre>zypper in spacewalk-utils</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
<div class="title">Supported Tools</div>
The <span class="package">spacewalk-utils</span> package contains a collection of upstream command line tools which provide assistance with spacewalk administrative operations.
You will be using the <code class="command">spacewalk-common-channels</code> tool.
Keep in mind SUSE only provides support for <code class="command">spacewalk-clone-by-date</code> and <code class="command">spacewalk-manage-channel-lifecycle</code> tools.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Run the <code class="command">spacewalk-common-channels</code> script to add the CentOS7 base, updates, and Spacewalk client channels.</p>
<div class="listingblock">
<div class="content">
<pre>{prompt.root}spacewalk-common-channels -u admin -p`secret`-a x86_64 'centos7'{prompt.root}spacewalk-common-channels -u admin -p`secret`-a x86_64 'centos7-updates'{prompt.root}spacewalk-common-channels -u admin -p`secret`-a x86_64 'spacewalk26-client-centos7'</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
<div class="title">Required Channel References</div>
The <code class="path">/etc/rhn/spacewalk-common-channels.ini</code> must contain the channel references to be added.
If a channel is not listed, check the latest version here for updates: <a href="https://github.com/spacewalkproject/spacewalk/tree/master/utils" class="bare">https://github.com/spacewalkproject/spacewalk/tree/master/utils</a>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>From the WebUI select <span class="menuseq"><b class="menu">Main Menu</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Software</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Manage Software Channels</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Overview</b></span>. Select the base channel you want to synchronize, in this case <code>CentOS7 (x86_64)</code>. Select <span class="menuseq"><b class="menu">Repositories</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Sync</b></span>. Check the channels you want to synchronize and then click the <b class="button">Sync Now</b> button or, optionally, schedule a regular synchronization time.</p>
</li>
<li>
<p>Copy all relevant GPG keys to <code class="path">/srv/www/htdocs/pub</code>. Depending on what distribution you are interested in managing these could include an EPEL key, SUSE keys, Red Hat keys, and CentOS keys. After copying these you can reference them in a comma-delimited list within your bootstrap script (see <a href="#proc.bp.expanded-support.centos-repos.trad.bsscript">Procedure: Preparing the Bootstrap Script</a>).</p>
<div class="ulist">
<ul>
<li>
<p>CentOS7 key files: <a href="http://mirror.centos.org/centos/RPM-GPG-KEY-CentOS-7" class="bare">http://mirror.centos.org/centos/RPM-GPG-KEY-CentOS-7</a></p>
</li>
<li>
<p>EPEL key file: <a href="http://mirrors.kernel.org/fedora-epel/RPM-GPG-KEY-EPEL-7" class="bare">http://mirrors.kernel.org/fedora-epel/RPM-GPG-KEY-EPEL-7</a></p>
</li>
<li>
<p>Spacewalk key: <a href="http://spacewalk.redhat.com/yum/RPM-GPG-KEY-spacewalk-2015" class="bare">http://spacewalk.redhat.com/yum/RPM-GPG-KEY-spacewalk-2015</a></p>
</li>
<li>
<p>Red Hat keys: <a href="http://www.redhat.com/contact/security-response-team/gpg-keys.html" class="bare">http://www.redhat.com/contact/security-response-team/gpg-keys.html</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Install and setup a CentOS 7 client with the default installation packages.</p>
</li>
<li>
<p>Ensure the client machine can resolve itself and your  server via DNS. Validate that there is an entry in <code class="path">/etc/hosts</code> for the real IP address of the client.</p>
</li>
<li>
<p>Create an activation key (<code>centos7</code>) on the  server that points to the correct parent/child channels, including the CentOS base repo, updates, and Spacewalk client.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now prepare the bootstrap script.</p>
</div>
<div id="proc.bp.expanded-support.centos-repos.trad.bsscript" class="olist arabic">
<div class="title">Procedure: Preparing the Bootstrap Script</div>
<ol class="arabic">
<li>
<p>Create/edit your bootstrap script to correctly reflect the following:</p>
<div class="listingblock">
<div class="content">
<pre># can be edited, but probably correct (unless created during initial install):

# NOTE: ACTIVATION_KEYS *must* be used to bootstrap a client machine.

ACTIVATION_KEYS=1-centos7

ORG_GPG_KEY=res.key,RPM-GPG-KEY-CentOS-7,suse-307E3D54.key,suse-9C800ACA.key,RPM-GPG-KEY-spacewalk-2015

FULLY_UPDATE_THIS_BOX=0

yum clean all
# Install the prerequisites
yum -y install yum-rhn-plugin rhn-setup</pre>
</div>
</div>
</li>
<li>
<p>Add the following lines to the bottom of your script, (just before <code>echo &#8220;-bootstrap complete -&#8221;</code>):</p>
<div class="listingblock">
<div class="content">
<pre># This section is for commands to be executed after registration
mv /etc/yum.repos.d/Cent* /root/
yum clean all
chkconfig rhnsd on
chkconfig osad on
service rhnsd restart
service osad restart</pre>
</div>
</div>
</li>
<li>
<p>Continue by following normal bootstrap procedures to bootstrap the new client.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="bp.expanded-support.centos_salt"><a class="anchor" href="#bp.expanded-support.centos_salt"></a><a class="link" href="#bp.expanded-support.centos_salt">3.3. Registering CentOS Salt Minions with </a></h3>
<div class="paragraph">
<p>The following procedure will guide you through registering a CentOS Minion.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title=":warning:"></i>
</td>
<td class="content">
<div class="title">Support for CentOS Patches</div>
<div class="paragraph">
<p>CentOS uses patches originating from CentOS is not officially supported by SUSE
.
See the matrix of  clients on the main page of the  wiki, linked from the <em class="ref">Quick Links</em> section: <a href="https://wiki.microfocus.com/index.php?title=SUSE_Manager" class="bare">https://wiki.microfocus.com/index.php?title=SUSE_Manager</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure: Register a CentOS 7 Minion</div>
<ol class="arabic">
<li>
<p>Add the Open Build Service repo for Salt:</p>
<div class="listingblock">
<div class="content">
<pre>{prompt.root}yum-config-manager --add-repo http://download.opensuse.org/repositories/systemsmanagement:/saltstack:/products/RHEL_7/</pre>
</div>
</div>
</li>
<li>
<p>Import the repo key:</p>
<div class="listingblock">
<div class="content">
<pre>{prompt.root}rpm --import http://download.opensuse.org/repositories/systemsmanagement:/saltstack:/products/RHEL_7/repodata/repomd.xml.key</pre>
</div>
</div>
</li>
<li>
<p>Check if there is a different repository that contains Salt. If there is more than one repository listed disable the repository that contains Salt apart from the OBS one.</p>
<div class="listingblock">
<div class="content">
<pre>{prompt.root}yum list --showduplicates salt</pre>
</div>
</div>
</li>
<li>
<p>Install the Salt minion:</p>
<div class="listingblock">
<div class="content">
<pre>{prompt.root}yum install salt salt-minion</pre>
</div>
</div>
</li>
<li>
<p>Change the Salt configuration to point to the  server:</p>
<div class="listingblock">
<div class="content">
<pre>{prompt.root}mkdir -p /etc/salt/minion.d{prompt.root}echo "master:`server_fqdn`" &gt; /etc/salt/minion.d/susemanager.conf</pre>
</div>
</div>
</li>
<li>
<p>Restart the minion</p>
<div class="listingblock">
<div class="content">
<pre>{prompt.root}systemctl restart salt-minion</pre>
</div>
</div>
</li>
<li>
<p>Proceed to <span class="menuseq"><b class="menu">Main Menu</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Salt</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Keys</b></span> from the WebUI and accept the minion&#8217;s key.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="best.practice.salt.formulas.and.forms"><a class="anchor" href="#best.practice.salt.formulas.and.forms"></a><a class="link" href="#best.practice.salt.formulas.and.forms">4. Salt Formulas and </a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter provides an introduction for using Salt Formulas with .
Creation of custom formulas will also be introduced.</p>
</div>
<div class="sect2">
<h3 id="best.practice.salt.formulas.what"><a class="anchor" href="#best.practice.salt.formulas.what"></a><a class="link" href="#best.practice.salt.formulas.what">4.1. What are Salt Formulas?</a></h3>
<div class="paragraph">
<p>Formulas are collections of Salt States that have been pre-written by other Salt users and contain generic parameter fields.
Formulas allow for reliable reproduction of a specific configuration again and again.
Formulas can be installed from RPM packages or an external git repository.</p>
</div>
<div class="paragraph">
<p>The following list will help you in making the decision to use a state or a formula.</p>
</div>
<div class="ulist">
<div class="title">Formula Tips</div>
<ul>
<li>
<p>When writing states for trivial tasks, formulas are probably not worth the time investment.</p>
</li>
<li>
<p>For large, non-trivial configurations use formulas.</p>
</li>
<li>
<p>Formulas and States both act as a kind of configuration documentation.
Once written and stored you will have a snapshot of what your infrastructure should look like.</p>
</li>
<li>
<p>You can greatly decrease the amount of time required for writing a formula by grabbing one of the many pre-written formulas on github.
There are pre-written formulas for hundreds of configurations.
You can find these located at <a href="https://github.com/saltstack-formulas" class="bare">https://github.com/saltstack-formulas</a>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
<div class="title">Formula with Forms Improvements</div>
<div class="ulist">
<ul>
<li>
<p>Formula data can now be managed via the XMLRPC API</p>
</li>
<li>
<p>New types were added to help SUSE Manager handle almost any kind of upstream formula.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="best.practice.salt.formulas.install"><a class="anchor" href="#best.practice.salt.formulas.install"></a><a class="link" href="#best.practice.salt.formulas.install">4.2. Installing Salt Formulas via RPM</a></h3>
<div class="paragraph">
<p>SUSE releases formulas as RPM packages.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
<div class="title">Formula Channel Location</div>
<div class="paragraph">
<p>Available formulas can be located within the <code class="systemitem">SUSE-Manager-Server-3.2-Pool</code> channel.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure: Installing Salt Formulas from an RPM</div>
<ol class="arabic">
<li>
<p>To search for available formulas, execute the following command on your  server:</p>
<div class="listingblock">
<div class="content">
<pre>zypper se --type package formula</pre>
</div>
</div>
<div class="paragraph">
<p>You will see a list of available Salt formulas:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>S | Name              | Summary                                                    | Type
--+-------------------+------------------------------------------------------------+-----------
  | locale-formula    | Locale Salt Formula for SUSE Manager                       | package</pre>
</div>
</div>
</li>
<li>
<p>For more information about a formula, run the following command:</p>
<div class="listingblock">
<div class="content">
<pre>zypper info locale-formula</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>Information for package locale-formula:
-----------------------------------------
Repository: SUSE-Manager-Server-{productnumber}-Pool
Name:  locale-formula
Version:  0.2-1.1
Arch: noarch
Vendor:  SUSE LLC &lt;https://www.suse.com/&gt;
Support Level: Level 3
Status: not installed
Installed Size: 47.9 KiB
Installed: No
Source package : locale-formula-0.2-1.1.src
Summary        : Locale Salt Formula for SUSE Manager
Description    : Salt Formula for SUSE Manager. Sets up the locale.</pre>
</div>
</div>
</li>
<li>
<p>To install a formula run as root:</p>
<div class="listingblock">
<div class="content">
<pre>zypper in locale-formula</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="best.practice.salt.formulas.filedir"><a class="anchor" href="#best.practice.salt.formulas.filedir"></a><a class="link" href="#best.practice.salt.formulas.filedir">4.3. File Structure Overview</a></h3>
<div class="paragraph">
<p>RPM-based formulas must be placed in a specific directory structure to ensure proper functionality.
A formula always consists of two separate directories: The <code class="path">states</code> directory and the <code class="path">metadata</code> directory.
Folders in these directories need to have an exactly matching name, for example <code>locale</code>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">The Formula State Directory</dt>
<dd>
<p>The formula states directory contains anything necessary for a Salt state to work independently.
This includes <code class="path">.sls</code> files, a <code class="path">map.jinja</code> file and any other required files.
This directory should only be modified by RPMs and should not be edited manually.
For example, the <span class="package">locale-formula</span> states directory is located in:</p>
<div class="listingblock">
<div class="content">
<pre>/usr/share/susemanager/formulas/states/locale/</pre>
</div>
</div>
</dd>
<dt class="hdlist1">The Formula Metadata Directory</dt>
<dd>
<p>The metadata directory contains a <code class="path">form.yml</code>
file which defines the forms for 
and an optional <code class="path">metadata.yml</code>
file that can contain additional information about a formula.
For example, the <span class="package">locale-formula</span>
metadata directory is located in:</p>
<div class="listingblock">
<div class="content">
<pre>/usr/share/susemanager/formulas/metadata/locale/</pre>
</div>
</div>
</dd>
<dt class="hdlist1">Custom Formulas</dt>
<dd>
<p>Custom formula data or (non-RPM) formulas need to be placed into any state directory configured as a Salt file root:</p>
<div class="dlist">
<dl>
<dt class="hdlist1">State directory</dt>
<dd>
<p>Custom state formula data need to be placed in:</p>
<div class="listingblock">
<div class="content">
<pre>/srv/salt/custom/</pre>
</div>
</div>
</dd>
<dt class="hdlist1">Metadata Directory</dt>
<dd>
<p>Custom metadata (information) need to be placed in:</p>
<div class="listingblock">
<div class="content">
<pre>/srv/formula_metadata/custom/</pre>
</div>
</div>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>All custom folders located in the following directories needs to contain a <code class="path">form.yml</code> file.
These files are detected as form recipes and may be applied to groups and systems from the WebUI:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/srv/salt/formula_metadata/`custom-formula-name`/form.yml</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="best.practice.salt.formulas.pillar"><a class="anchor" href="#best.practice.salt.formulas.pillar"></a><a class="link" href="#best.practice.salt.formulas.pillar">4.4. Editing Pillar Data in </a></h3>
<div class="paragraph">
<p> requires a file called <code class="path">form.yml</code>, to describe how formula data should look within the WebUI.
<code class="path">form.yml</code> is used by  to generate the desired form, with values editable by a user.</p>
</div>
<div class="paragraph">
<p>For example, the <code class="path">form.yml</code> that is included with the <span class="package">locale-formula</span> is placed in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/usr/share/susemanager/formulas/metadata/locale/form.yml</pre>
</div>
</div>
<div class="paragraph">
<p>See part of the following <span class="package">locale-formula</span> example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># This file is part of locale-formula.
#
# Foobar is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# Foobar is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with Foobar.  If not, see &lt;http://www.gnu.org/licenses/&gt;.

timezone:
  $type: group

  name:
    $type: select
    $values: ["CET",
              "CST6CDT",
              "EET",
              "EST",
              "EST5EDT",
              "GMT",
              "GMT+0",
              "GMT-0",
              "GMT0",
              "Greenwich",
              "HST",
              "MET",
              "MST",
              "MST7MDT",
              "NZ",
              "NZ-CHAT",
              "Navajo",
              "PST8PDT",
              "UCT",
              "UTC",
              "Universal",
              "W-SU",
              "WET",
              "Zulu",
              "Etc/GMT+1",
              "Etc/GMT+2",
              "Etc/GMT+3",
              "Etc/GMT+4",
              "Etc/GMT+5",
              "Etc/GMT+6",
              "Etc/GMT+7",
              "Etc/GMT+8",
              "Etc/GMT+9",
              "Etc/GMT+10",
              "Etc/GMT+11",
              "Etc/GMT+12",
              "Etc/GMT-1",
              "Etc/GMT-2",
              "Etc/GMT-3",
              "Etc/GMT-4",
              "Etc/GMT-5",
              "Etc/GMT-6",
              "Etc/GMT-7",
              "Etc/GMT-8",
              "Etc/GMT-9",
              "Etc/GMT-10",
              "Etc/GMT-11",
              "Etc/GMT-12",
              "Etc/GMT-13",
              "Etc/GMT-14",
              "Etc/GMT",
              "Etc/GMT+0",
              "Etc/GMT-0",
              "Etc/GMT0",
              "Etc/Greenwich",
              "Etc/UCT",
              "Etc/UTC",
              "Etc/Universal",
              "Etc/Zulu"
              ]
    $default: CET

  hardware_clock_set_to_utc:
    $type: boolean
    $default: True
...</pre>
</div>
</div>
<div class="paragraph">
<p><code class="path">form.yml</code> contains additional information that describes how the form for a pillar should look for .
This information is contained in attributes that always start with a <code>$</code> sign.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
<div class="title">Ignored Values</div>
<div class="paragraph">
<p>All values that start with a <code>$</code> sign are annotations used to display the UI that users interact with.
These annotations are not part of pillar data itself and are handled as metadata.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following are valid attributes.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">$type</dt>
<dd>
<p>The most important attribute is the <code>$type</code> attribute.
It defines the type of the pillar value and the form-field that is generated.
The following represent the supported types:</p>
<div class="ulist">
<ul>
<li>
<p><code>text</code></p>
</li>
<li>
<p><code>password</code></p>
</li>
<li>
<p><code>number</code></p>
</li>
<li>
<p><code>url</code></p>
</li>
<li>
<p><code>email</code></p>
</li>
<li>
<p><code>date</code></p>
</li>
<li>
<p><code>time</code></p>
</li>
<li>
<p><code>datetime</code></p>
</li>
<li>
<p><code>boolean</code></p>
</li>
<li>
<p><code>color</code></p>
</li>
<li>
<p><code>select</code></p>
</li>
<li>
<p><code>group</code></p>
</li>
<li>
<p><code>edit-group</code></p>
</li>
<li>
<p><code>namespace</code></p>
</li>
<li>
<p><code>hidden-group</code> (obsolete, renamed to <code>namespace</code>)</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
<div class="title">Text Attribute</div>
<div class="paragraph">
<p>The text attribute is the default and does not need to be specified explicitly.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Many of these values are self-explanatory:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>text</code> type generates a simple text field</p>
</li>
<li>
<p>The <code>password</code> type generates a password field</p>
</li>
<li>
<p>The <code>color</code> type generates a color picker.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>group</code>, <code>edit-group</code>, and <code>namespace</code> (formerly <code>hidden-group</code>) types do not generate an editable field and are used to structure form and pillar data.
The difference between <code>group</code> and <code>namespace</code> is <code>group</code> generates a visible border with a heading, and <code>namespace</code> shows nothing visually (and is only used to structure pillar data).
The difference between <code>group</code> and <code>edit-group</code> is <code>edit-group</code> allows to structure and restrict editable fields in a more flexible way.
For example, <code>edit-group</code> supports the <code>$minItems</code> and <code>$maxItems</code> attributes, and thus it simplifies complex and repeatable input structures.
For an <code>edit-group</code> example, see <a href="#salt.formulas.ex.edit-group">Simple edit-group Example</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">$default</dt>
<dd>
<p><code>$default</code> allows you to specify a default value that is displayed and used, if no other value is entered.
In an <code>edit-group</code> it allows to create initial members of the group and populate them with specified data.</p>
</dd>
<dt class="hdlist1">$name</dt>
<dd>
<p><code>$name</code> allows you to specify the name of a value that is shown in the form.
If this value is not set, the pillar name is used and capitalized without underscores and dashes.
You reference it in the same section with <code>${name}</code>.</p>
</dd>
<dt class="hdlist1">$help and $placeholder</dt>
<dd>
<p>The <code>$help</code> and <code>$placeholder</code> attributes are used to give a user a better understanding of what the value should be.</p>
<div class="ulist">
<ul>
<li>
<p><code>$help</code> defines the message a user sees when hovering over a field</p>
</li>
<li>
<p><code>$placeholder</code> displays a gray placeholder text in the field.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>$placeholder</code> may only be used with text fields like text, password, email or date.
It does not make sense to add a placeholder if you also use <code>$default</code> as this will hide the placeholder.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">$minItems and $maxItems</dt>
<dd>
<p>In an <code>edit-group</code>, <code>$minItems</code> and <code>$maxItems</code> allow you to specify the lowest and highest number the group can occur.</p>
</dd>
<dt class="hdlist1">$itemName</dt>
<dd>
<p>In an <code>edit-group</code>, <code>$itemName</code> allows to define a template for the name to be used for the members of the group.</p>
</dd>
<dt class="hdlist1">$prototype</dt>
<dd>
<p>In an <code>edit-group</code>, <code>$prototype</code> allows to define default (or pre-filled) values for newly added members in the group.</p>
</dd>
<dt class="hdlist1">$scope</dt>
<dd>
<p><code>$scope</code> allows you to specify a hierarchy level at which a value may be edited.
Possible values are <code>system</code>, <code>group</code> and <code>readonly</code>.</p>
<div class="paragraph">
<p>The default <code>$scope: system</code> allows values to be edited at group and system levels.
A value can be entered for each system but if no value is entered the system will fall back to the group default.</p>
</div>
<div class="paragraph">
<p>If using <code>$scope: group</code>, a value may only be edited for a group.
On the system level you will be able to see the value, but not edit it.</p>
</div>
<div class="paragraph">
<p>The <code>$scope: readonly</code> option makes a field read-only.
It can be used to show a user data which should be known, but should not be editable.
This option only makes sense in combination with the $default attribute.</p>
</div>
</dd>
<dt class="hdlist1">$visibleIf</dt>
<dd>
<p><code>$visibleIf</code> allows you to show a field or group if a simple condition is met.
A condition always looks similar to the following example:</p>
<div class="listingblock">
<div class="content">
<pre>some_group#another_group#my_checkbox == true</pre>
</div>
</div>
<div class="paragraph">
<p>The left part of the above statement is the path to another value, and groups are separated by <code>$</code> signs.
The middle section of the command should be either <code>==</code> for a value to be equal or <code>!=</code> for values that should be not equal.
The last field in the statement can be any value which a field should have or not have.</p>
</div>
<div class="paragraph">
<p>The field with this attribute associated with it will now be shown only when the condition is met.
In this example the field will be shown only if <code>my_checkbox</code> is checked.
The ability to use conditional statements is not limited to check boxes.
It may also be used to check values of select-fields, text-fields, etc.</p>
</div>
<div class="paragraph">
<p>A check box should be structured like the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>some_group:
  $type: group

  another_group:
    $type: group

      my_checkbox:
        $type: boolean</pre>
</div>
</div>
<div class="paragraph">
<p>Relative paths can be specified using prefix dots. One dot means sibling, 2 dots mean parent, etc. This is mostly useful for <code>edit-group</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>some_group:
  $type: group

  another_group:
    $type: group

    my_checkbox:
      $type: boolean

    my_text:
      $visibleIf: .my_checkbox

  yet_another_group:
    $type: group

    my_text2:
      $visibleIf: ..another_group#my_checkbox</pre>
</div>
</div>
<div class="paragraph">
<p>By using multiple groups with the attribute, you can allow a user to select an option and show a completely different form, dependent upon the selected value.</p>
</div>
<div class="paragraph">
<p>Values from hidden fields may be merged into the pillar data and sent to the minion.
A formula must check the condition again and use the appropriate data.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>show_option:
  $type: checkbox
some_text:
  $visibleIf: show_option == true</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>{% if pillar.show_option %}
do_something:
  with: {{ pillar.some_text }}
{% endif %}</pre>
</div>
</div>
</dd>
<dt class="hdlist1">$values</dt>
<dd>
<p><code>$values</code> can only be used together with <code>$type</code>: select to specify the different options in the select-field.
<code>$values</code> must be a list of possible values to select.
For example:</p>
<div class="listingblock">
<div class="content">
<pre>select_something:
  $type: select
  $values: ["option1", "option2"]</pre>
</div>
</div>
<div class="paragraph">
<p>Or alternatively:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>select_something:
  $type: select
  $values:
    - option1
    - option2</pre>
</div>
</div>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="salt.formulas.ex.edit-group"><a class="anchor" href="#salt.formulas.ex.edit-group"></a><a class="link" href="#salt.formulas.ex.edit-group">4.4.1. Simple edit-group Example</a></h4>
<div class="paragraph">
<p>See the following <strong>edit-group</strong> example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>partitions:
  $name: "Hard Disk Partitions"
  $type: "edit-group"
  $minItems: 1
  $maxItems: 4
  $itemName: "Partition ${name}"
  $prototype:
    name:
      $default: "New partition"
    mountpoint:
      $default: "/var"
    size:
      $type: "number"
      $name: "Size in GB"
  $default:
    - name: "Boot"
      mountpoint: "/boot"
    - name: "Root"
      mountpoint: "/"
      size: 5000</pre>
</div>
</div>
<div class="paragraph">
<p>After clicking <b class="button">Add</b> for one time you will see <a href="#fig-formula-custom-harddisk-partitions"><code>edit-group</code> Example in the WebUI</a> filled with the default values.
The formula itself is called <code class="path">hd-partitions</code> and will appear as <code class="guimenu">Hd Partitions</code> in the WebUI.</p>
</div>
<div id="fig-formula-custom-harddisk-partitions" class="imageblock">
<div class="content">
<img src="_images/formula-custom-harddisk-partitions.png" alt="formula custom harddisk partitions">
</div>
<div class="title">Figure 1. <code>edit-group</code> Example in the WebUI</div>
</div>
<div class="paragraph">
<p>To remove definition of a partition click the minus symbol in the title line of an inner group.
When form fields are properly filled confirm with clicking <b class="button">Save Formula</b> in the upper right corner of the formula.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="best.practice.salt.formulas.writing"><a class="anchor" href="#best.practice.salt.formulas.writing"></a><a class="link" href="#best.practice.salt.formulas.writing">4.5. Writing Salt Formulas</a></h3>
<div class="paragraph">
<p>Salt formulas are pre-written Salt states, which may be configured with pillar data.
You can parametrize state files using Jinja.
Jinja allows you to access pillar data by using the following syntax.
(This syntax works best when your uncertain a pillar value exists as it will throw an error):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>pillar.some.value</pre>
</div>
</div>
<div class="paragraph">
<p>When you are sure a pillar exists may also use the following syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>salt['pillar.get']('some:value', 'default value')</pre>
</div>
</div>
<div class="paragraph">
<p>You may also replace the <code>pillar</code> value with <code>grains</code> (for example, <code>grains.some.value</code>) allowing access to grains.</p>
</div>
<div class="paragraph">
<p>Using data this way allows you to make a formula configurable.
The following code snippet will install a package specified in the pillar <code>package_name</code>.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>install_a_package:
  pkg.installed:
    - name: {{ pillar.package_name }}</pre>
</div>
</div>
<div class="paragraph">
<p>You may also use more complex constructs such as <code>if/else</code> and <code>for-loops</code> to provide greater functionality.
For Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{% if pillar.installSomething %}
something:
  pkg.installed
{% else %}
anotherPackage:
  pkg.installed
{% endif %}</pre>
</div>
</div>
<div class="paragraph">
<p>Another example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{% for service in pillar.services %}
start_{{ service }}:
  service.running:
    - name: {{ service }}
{% endfor %}</pre>
</div>
</div>
<div class="paragraph">
<p>Jinja also provides other helpful functions.
For example, you can iterate over a dictionary:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{% for key, value in some_dictionary.items() %}
do_something_with_{{ key }}: {{ value }}
{% endfor %}</pre>
</div>
</div>
<div class="paragraph">
<p>You may want to have Salt manage your files (for example, configuration files for a program), and you can change these with pillar data.
For example, the following snippet shows how you can manage a file using Salt:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/etc/my_program/my_program.conf:
  file.managed:
    - source: salt://my_state/files/my_program.conf
    - template: jinja</pre>
</div>
</div>
<div class="paragraph">
<p>Salt will copy the file <code class="path">salt-file_roots/my_state/files/my_program.conf</code> on the salt master to <code class="path">/etc/my_program/my_program.conf</code> on the minion and template it with Jinja.
This allows you to use Jinja in the file, exactly like shown above for states:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>some_config_option = {{ pillar.config_option_a }}</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="best.practice.salt.formulas.data"><a class="anchor" href="#best.practice.salt.formulas.data"></a><a class="link" href="#best.practice.salt.formulas.data">4.6. Separating Data</a></h3>
<div class="paragraph">
<p>It is often a good idea to separate data from a state to increase its flexibility and add re-usability value.
This is often done by writing values into a separate file named <code class="path">map.jinja</code>.
This file should be placed within the same directory as your state files.</p>
</div>
<div class="paragraph">
<p>The following example will set <code>data</code> to a dictionary with different values, depending on which system the state runs on.
It will also merge data with the pillar using the <code>some.pillar.data</code> value so you can access <code>some.pillar.data.value</code> by just using <code>data.value</code>.</p>
</div>
<div class="paragraph">
<p>You can also choose to override defined values from pillars (for example, by overriding <code>some.pillar.data.package</code> in the example).</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{% set data = salt['grains.filter_by']({
    'Suse': {
        'package': 'packageA',
        'service': 'serviceA'
    },
    'RedHat': {
        'package': 'package_a',
        'service': 'service_a'
    }
}, merge=salt['pillar.get']('some:pillar:data')) %}</pre>
</div>
</div>
<div class="paragraph">
<p>After creating a map file like the above example, you can easily maintain compatibility with multiple system types while accessing "deep" pillar data in a simpler way.
Now you can import and use <code>data</code> in any file.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{% from "some_folder/map.jinja" import data with context %}

install_package_a:
  pkg.installed:
    - name: {{ data.package }}</pre>
</div>
</div>
<div class="paragraph">
<p>You can also define multiple variables by copying the <code>{% set &#8230;&#8203;%}</code> statement with different values and then merge it with other pillars.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{% set server = salt['grains.filter_by']({
    'Suse': {
        'package': 'my-server-pkg'
    }
}, merge=salt['pillar.get']('myFormula:server')) %}
{% set client = salt['grains.filter_by']({
    'Suse': {
        'package': 'my-client-pkg'
    }
}, merge=salt['pillar.get']('myFormula:client')) %}</pre>
</div>
</div>
<div class="paragraph">
<p>To import multiple variables, separate them with a comma.
For Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{% from "map.jinja" import server, client with context %}</pre>
</div>
</div>
<div class="paragraph">
<p>Formulas utilized with  should follow formula conventions listed in the official documentation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.saltstack.com/en/latest/topics/development/conventions/formulas.html" class="bare">https://docs.saltstack.com/en/latest/topics/development/conventions/formulas.html</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="best.practice.salt.formulas.pillardata"><a class="anchor" href="#best.practice.salt.formulas.pillardata"></a><a class="link" href="#best.practice.salt.formulas.pillardata">4.7.  Generated Pillar Data</a></h3>
<div class="paragraph">
<p>When pillar data is generated (for example, after applying the highstate) the following external pillar script generates pillar data for packages, group ids, etc.
and includes all pillar data for a system:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/usr/share/susemanager/modules/pillar/suma_minion.py</pre>
</div>
</div>
<div class="paragraph">
<p>The process is executed as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <code>suma_minion.py</code> script starts and finds all formulas for a system (by checking the <code>group_formulas.json</code> and <code>server_formulas.json</code> files).</p>
</li>
<li>
<p><code>suma_minion.py</code> loads the values for each formula (groups and from the system) and merges them with the highstate (default: if no values are found, a group overrides a system if $scope: group etc.).</p>
</li>
<li>
<p><code>suma_minion.py</code> also includes a list of formulas applied to the system in a pillar named formulas.
This structure makes it possible to include states.
The top file (in this case specifically generated by the <code>mgr_master_tops.py</code> script) includes a state called formulas for each system.
This includes the <code>formulas.sls</code> file located in:</p>
<div class="listingblock">
<div class="content">
<pre>/usr/share/susemanager/formulas/states/</pre>
</div>
</div>
<div class="paragraph">
<p>The content looks similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>include: {{ pillar["formulas"] }}</pre>
</div>
</div>
<div class="paragraph">
<p>This pillar includes all formulas, that are specified in pillar data generated from the external pillar script.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="best.practice.salt.formulas.req"><a class="anchor" href="#best.practice.salt.formulas.req"></a><a class="link" href="#best.practice.salt.formulas.req">4.8. Formula Requirements</a></h3>
<div class="paragraph">
<p>Formulas should be designed/created directly after a  installation, but if you encounter any issues check the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The external pillar script (<code>suma_minion.py</code>) must include formula data.</p>
</li>
<li>
<p>Data is saved to <code class="path">/srv/susemanager/formula_data</code> and the <code class="path">pillar</code> and <code class="path">group_pillar</code> sub-directories.
These should be automatically generated by the server.</p>
</li>
<li>
<p>Formulas must be included for every minion listed in the top file.
Currently this process is initiated by the <code class="path">mgr_master_tops.py</code> script which includes the formulas.sls file located in:</p>
<div class="listingblock">
<div class="content">
<pre>/usr/share/susemanager/formulas/states/</pre>
</div>
</div>
<div class="paragraph">
<p>This directory must be a salt file root.
File roots are configured on the salt-master () located in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/etc/salt/master.d/susemanager.conf</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="best.practice.salt.formulas.using"><a class="anchor" href="#best.practice.salt.formulas.using"></a><a class="link" href="#best.practice.salt.formulas.using">4.9. Using Salt Formulas with </a></h3>
<div class="paragraph">
<p>The following procedure provides an overview on using Salt Formulas with .</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Official formulas may be installed as RPMs.
Place the custom states within <code class="path">/srv/salt/your-formula-name/</code> and the metadata (<code class="path">form.yml</code> and <code class="path">metadata.yml</code>) in <code class="path">/srv/formula_metadata/your-formula-name/</code>.
After installing your formulas they will appear in <span class="menuseq"><b class="menu">Salt</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Formula Catalog</b></span>.</p>
</li>
<li>
<p>To begin using a formula, apply it to a group or system.
Apply a formula to a group or system by selecting the <span class="menuseq"><b class="menu">System Details</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Formulas</b></span> tab of a <code class="guimenu">System Details</code> page or <code class="guimenu">System Group</code>. From the <span class="menuseq"><b class="menu">System Details</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Formulas</b></span> page you can select any formulas you wish to apply to a group or system.
Click the <b class="button">Save</b> button to save your changes to the database.</p>
</li>
<li>
<p>After applying one or more formulas to a group or system, additional tabs will become available from the top menu, one for each formula selected.
From these tabs you may configure your formulas.</p>
</li>
<li>
<p>When you have finished customizing your formula values you will need to apply the highstate for them to take effect.
Applying the highstate will execute the state associated with the formula and configure targeted systems.
You can use the <b class="button">Apply Highstate</b> button from any formulas page of a group.</p>
</li>
<li>
<p>When a change to any of your values is required or you need to re-apply the formula state because of a failure or bug, change values located on your formula pages and re-apply the highstate.
Salt will ensure that only modified values are adjusted and restart or reinstall services only when necessary.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This conclude your introduction to Salt Formulas.
For additional information, see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.saltstack.com/en/latest/topics/development/conventions/formulas.html" class="bare">https://docs.saltstack.com/en/latest/topics/development/conventions/formulas.html</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bp.chapt.config.management.with.salt"><a class="anchor" href="#bp.chapt.config.management.with.salt"></a><a class="link" href="#bp.chapt.config.management.with.salt">5. Configuration Management with Salt</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="bp.chapt.config.mgr.overview"><a class="anchor" href="#bp.chapt.config.mgr.overview"></a><a class="link" href="#bp.chapt.config.mgr.overview">5.1. Configuration Management Overview</a></h3>
<div class="paragraph">
<p>Salt is capable of applying states by matching minions with relevant state data.
This data comes from  in the form of package and custom states.</p>
</div>
</div>
<div class="sect2">
<h3 id="bp.chapt.config.mgr.level.hierarchy"><a class="anchor" href="#bp.chapt.config.mgr.level.hierarchy"></a><a class="link" href="#bp.chapt.config.mgr.level.hierarchy">5.2. State Data: Levels of Hierarchy</a></h3>
<div class="paragraph">
<p>State data comes from  in the form of package and custom states and targets minions at three specific levels of hierarchy.
The state hierarchy is defined by the following order or priority: individual minions have priority on packages and custom states over groups; next a group has priority over the organization.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Minion Level</p>
<div class="paragraph">
<p><span class="menuseq"><b class="menu">Systems</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Specific Minion</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">States</b></span></p>
</div>
</li>
<li>
<p>Group Level</p>
<div class="paragraph">
<p><span class="menuseq"><b class="menu">Systems</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">System Groups</b></span></p>
</div>
</li>
<li>
<p>Organization Level</p>
<div class="paragraph">
<p><span class="menuseq"><b class="menu">Systems</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Manage System Types:</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">My Organization</b></span></p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Org1 requires that vim version 1 is installed</p>
</li>
<li>
<p>Group1 requires that vim version 2 is installed</p>
</li>
<li>
<p>Group2 requires any version installed</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This would lead to the following order of hierarchy:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Minion1 part of [Org1, Group1] wants vim removed, vim is removed (Minion Level)</p>
</li>
<li>
<p>Minion2 part of [Org1, Group1] wants vim version 2 gets version 2 (Group Level)</p>
</li>
<li>
<p>Minion3 part of [Org1, Group1] wants any version, gets version 2 (Org Level)</p>
</li>
<li>
<p>Minion4 part of[Org1, Group2] wants any version, gets vim version 1 (Org Level)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="bp.chapt.config.mgr.salt.states.storage.locations"><a class="anchor" href="#bp.chapt.config.mgr.salt.states.storage.locations"></a><a class="link" href="#bp.chapt.config.mgr.salt.states.storage.locations">5.3. Salt States Storage Locations</a></h3>
<div class="paragraph">
<p>The  salt-master reads its state data from three file root locations.</p>
</div>
<div class="paragraph">
<p>The directory <code class="path">/usr/share/susemanager/salt</code>
 is used by  and comes from the susemanager-sls.
It is shipped and updated together with  and includes certificate setup and common state logic to be applied to packages and channels.</p>
</div>
<div class="paragraph">
<p>The directory <code class="path">/srv/susemanager/salt</code> is generated by  and based on assigned channels and packages for minions, groups and organizations.
This file will be overwritten and regenerated.
This could be thought of as the  database translated into salt directives.</p>
</div>
<div class="paragraph">
<p>The third directory <code class="path">/srv/salt</code> is for custom state data, modules etc.
 does not operate within or utilize this directory.
However the state data placed here affects the Highstate of minions and is merged with the total state result generated by .</p>
</div>
</div>
<div class="sect2">
<h3 id="bp.chapt.config.mgr.susemgr.states"><a class="anchor" href="#bp.chapt.config.mgr.susemgr.states"></a><a class="link" href="#bp.chapt.config.mgr.susemgr.states">5.4.  States</a></h3>
<div class="paragraph">
<p>All sls files created by users will be saved to disk on the salt-master server.
These files will be placed in <code class="path">/srv/susemanager/salt/</code>
 and each organization will be placed within its own directory.
Although these states are custom, these states are created using 
.
The following provides an overview of directory structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>├── manager_org_DEVEL
│   ├── files
│   │    ... files needed by states (uploaded by users)...
│   └── state.sls
         ... other sls files (created by users)...
E.g.:
├── manager_org_TESTING
│   ├── files
│   │   └── motd     # user created
│   │    ... other files needed by states ...
│   └── motd.sls     # user created
            ... other sls files ...</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bp.chapt.config.mgr.pillar.data"><a class="anchor" href="#bp.chapt.config.mgr.pillar.data"></a><a class="link" href="#bp.chapt.config.mgr.pillar.data">5.5. Pillar Data</a></h3>
<div class="paragraph">
<p>SUSE Manager exposes a small amount of internal data as Pillars which can be used with custom SUSE Linux Enterprise Server states.
Data that is exposed includes group membership, organization membership, and file roots.
These are managed either automatically by , or manually by the user.</p>
</div>
<div class="paragraph">
<p>To avoid hard-coding organization IDs within SUSE Linux Enterprise Server files, a pillar entry is added for each organization:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>org-files-dir: relative_path_to_files</pre>
</div>
</div>
<div class="paragraph">
<p>The specified file is available for all minions which belong to the organization.</p>
</div>
<div class="paragraph">
<p>This is an example of a Pillar located at <code class="path">/etc/motd</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>file.managed:
    - source: salt://{{ pillar['org-files-dir']}}/motd
    - user: root
    - group: root
    - mode: 644</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bp.sect.groupstates"><a class="anchor" href="#bp.sect.groupstates"></a><a class="link" href="#bp.sect.groupstates">5.6. Group States</a></h3>
<div class="paragraph">
<p>Pillar data can be used to perform bulk actions, like applying all assigned states to minions within the group.
This section contains some example of bulk actions that you can take using group states.</p>
</div>
<div class="paragraph">
<p>In order to perform these actions, you will need to determine the ID of the group that you want to manipulate.
You can determine the Group ID by using the <code class="command">spacecmd</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>spacecmd group_details</pre>
</div>
</div>
<div class="paragraph">
<p>In these examples we will use an example Group ID of <code class="systemitem">GID</code>.</p>
</div>
<div class="paragraph">
<p>To apply all states assigned to the group:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>salt -I 'group_ids:GID' state.apply custom.group_GID</pre>
</div>
</div>
<div class="paragraph">
<p>To apply any state (whether or not it is assigned to the group):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>salt -I 'group_ids:GID' state.apply ``state``</pre>
</div>
</div>
<div class="paragraph">
<p>To apply a custom state:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>salt -I 'group_ids:2130' state.apply manager_org_1.``customstate``</pre>
</div>
</div>
<div class="paragraph">
<p>Apply the highstate to all minions in the group:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>salt -I 'group_ids:GID' state.apply</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bp.chap.salt.minion.scaleability"><a class="anchor" href="#bp.chap.salt.minion.scaleability"></a><a class="link" href="#bp.chap.salt.minion.scaleability">6. Salt Minion Scalability</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_salt_minion_onboarding_rate"><a class="anchor" href="#_salt_minion_onboarding_rate"></a><a class="link" href="#_salt_minion_onboarding_rate">6.1. Salt Minion Onboarding Rate</a></h3>
<div class="paragraph">
<p>The rate at which SUSE Manager can on-board minions (accept Salt keys) is limited and depends on hardware resources.
On-boarding minions at a faster rate than SUSE Manager is configured for will build up a backlog of unprocessed keys slowing the process and potentially exhausting resources.
It is recommended to limit the acceptance key rate pro-grammatically.
A safe starting point would be to on-board a minion every 15 seconds, which can be implemented via the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>for k in $(salt-key -l un|grep -v Unaccepted); do salt-key -y -a $k; sleep 15; done</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bp.chap.salt.minion.scaleability.unaccepted"><a class="anchor" href="#bp.chap.salt.minion.scaleability.unaccepted"></a><a class="link" href="#bp.chap.salt.minion.scaleability.unaccepted">6.2. Minions Running with Unaccepted Salt Keys</a></h3>
<div class="paragraph">
<p>Minions which have not been on-boarded, (minions running with unaccepted Salt keys) consume resources, in particular inbound network bandwidth for ~2.5 Kb/s per minion.
1000 idle minions will consume around ~2.5 Mb/s, and this number will drop to almost 0 once on-boarding has been completed.
Limit non-onboarded systems for optimal performance.</p>
</div>
<div class="paragraph">
<p>Salt&#8217;s official documentation suggests the maximum number of opened files should be set to at least 2 × the minion count.
Current default is 16384, which is sufficient for ~8000 minions.
For larger installations, this number may be increased by editing the following line in <code class="path">/usr/lib/systemd/system/salt-master.service</code>
:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>LimitNOFILE=16384</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bp.chap.salt.minion.scaleability.timeouts"><a class="anchor" href="#bp.chap.salt.minion.scaleability.timeouts"></a><a class="link" href="#bp.chap.salt.minion.scaleability.timeouts">6.3. Salt Timeouts</a></h3>
<div class="sect3">
<h4 id="_background_information"><a class="anchor" href="#_background_information"></a><a class="link" href="#_background_information">6.3.1. Background Information</a></h4>
<div class="paragraph">
<p>Salt features two timeout parameters called <code>timeout</code> and <code>gather_job_timeout</code> that are relevant during the execution of Salt commands and jobs&#8212;&#8203;it does not matter whether they are triggered using the command line interface or API.
These two parameters are explained in the following article.</p>
</div>
<div class="paragraph">
<p>This is a normal workflow when all minions are well reachable:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A salt command or job is executed:</p>
<div class="listingblock">
<div class="content">
<pre>salt '*' test.ping</pre>
</div>
</div>
</li>
<li>
<p>Salt master publishes the job with the targeted minions into the Salt PUB channel.</p>
</li>
<li>
<p>Minions take that job and start working on it.</p>
</li>
<li>
<p>Salt master is looking at the Salt RET channel to gather responses from the minions.</p>
</li>
<li>
<p>If Salt master gets all responses from targeted minions, then everything is completed and Salt master will return a response containing all the minion responses.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If some of the minions are down during this process, the workflow continues as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If <code>timeout</code> is reached before getting all expected responses from the minions, then Salt master would trigger an aditional job (a Salt <code class="command">find_job</code> job) targeting only pending minions to check whether the job is already running on the minion.</p>
</li>
<li>
<p>Now <code>gather_job_timeout</code> is evaluated. A new counter is now triggered.</p>
</li>
<li>
<p>If this new <code class="command">find_job</code> job responses that the original job is actually running on the minion, then Salt master will wait for that minion&#8217;s response.</p>
</li>
<li>
<p>In case of reaching <code>gather_job_timeout</code> without having any response from the minion (neither for the initial <code class="command">test.ping</code> nor for the <code class="command">find_job</code> job), Salt master will return with only the gathered responses from the responding minions.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>By default,  globally sets <code>timeout</code> and <code>gather_job_timeout</code> to 120 seconds.
So, in the worst case, a Salt call targeting unreachable minions will end up <em>with 240 seconds of waiting</em> until getting a response.</p>
</div>
</div>
<div class="sect3">
<h4 id="bp.chap.salt.minion.scaleability.timeouts.presence"><a class="anchor" href="#bp.chap.salt.minion.scaleability.timeouts.presence"></a><a class="link" href="#bp.chap.salt.minion.scaleability.timeouts.presence">6.3.2. A Presence Ping Mechanism for Unreachable Salt Minions</a></h4>
<div class="paragraph">
<p>In order to prevent waiting until timeouts are reached when some minions are down, SUSE
introduced a so-called "presence mechanism" for Salt minions.</p>
</div>
<div class="paragraph">
<p>This presence mechanism checks for unreachable Salt minions when  is performing synchronous calls to these minions, and it excludes unreachable minions from that call.
Synchronous calls are going to be displaced in favor of asynchronous calls but currently still being used during some workflows.</p>
</div>
<div class="paragraph">
<p>The presence mechanism triggers a Salt <code class="command">test.ping</code> with a custom and fixed short Salt timeout values.
Default Salt values for the presence ping are: <code>timeout
     = 4</code> and <code>gather_job_timeout = 1</code>.
This way, we can quickly detect which targeted minions are unreachable, and then exclude them from the synchronous call.</p>
</div>
</div>
<div class="sect3">
<h4 id="_overriding_salt_presence_timeout_values"><a class="anchor" href="#_overriding_salt_presence_timeout_values"></a><a class="link" href="#_overriding_salt_presence_timeout_values">6.3.3. Overriding Salt Presence Timeout Values</a></h4>
<div class="paragraph">
<p> administrators can increase or decrease default presence ping timeout values by removing the comment markers (<code>\#</code>) and setting the desired values for <code>salt_presence_ping_timeout</code> and <code>salt_presence_ping_gather_job_timeout</code> options in <code class="path">/etc/rhn/rhn.conf</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># SUSE Manager presence timeouts for Salt minions
# salt_presence_ping_timeout = 4
# salt_presence_ping_gather_job_timeout = 1</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_salt_ssh_minions_ssh_push"><a class="anchor" href="#_salt_ssh_minions_ssh_push"></a><a class="link" href="#_salt_ssh_minions_ssh_push">6.3.4. Salt SSH Minions (SSH Push)</a></h4>
<div class="paragraph">
<p>Salt SSH minions are slightly different that regular minions (zeromq). Salt SSH minions do not use Salt PUB/RET channels but a wrapper Salt command inside of an SSH call.
Salt <code>timeout</code> and <code>gather_job_timeout</code> are not playing a role here.</p>
</div>
<div class="paragraph">
<p> defines a timeout for SSH connections in <code class="path">/etc/rhn/rhn.conf</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># salt_ssh_connect_timeout = 180</pre>
</div>
</div>
<div class="paragraph">
<p>The presence ping mechanism is also working with SSH minions.
In this case,  will use <code>salt_presence_ping_timeout</code> to override the default timeout value for SSH connections.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bp.key.managment"><a class="anchor" href="#bp.key.managment"></a><a class="link" href="#bp.key.managment">7. Activation Key Management</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_what_are_activation_keys"><a class="anchor" href="#_what_are_activation_keys"></a><a class="link" href="#_what_are_activation_keys">7.1. What are Activation Keys?</a></h3>
<div class="paragraph">
<p>An <code>activation key</code> in  is a group of configuration settings with a label.
You can apply all configuration settings associated with an activation key by adding its label as a parameter to a bootstrap script.
Under normal operating conditions best practices suggest using an activation key label in combination with a bootstrap script.</p>
</div>
<div class="paragraph">
<p>An activation key can specify:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Channel Assignment</p>
</li>
<li>
<p>System Types (Traditionally called Add-on Entitlements)</p>
</li>
<li>
<p>Contact Method</p>
</li>
<li>
<p>Configuration Files</p>
</li>
<li>
<p>Packages to be Installed</p>
</li>
<li>
<p>System Group Assignment</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Activation keys are just a collection of configuration settings which have been given a label name and then added to a bootstrap script.
When the bootstrap script is executed all configuration settings associated with the label are applied to the system the script is run on.</p>
</div>
</div>
<div class="sect2">
<h3 id="_provisioning_and_configuration"><a class="anchor" href="#_provisioning_and_configuration"></a><a class="link" href="#_provisioning_and_configuration">7.2. Provisioning and Configuration</a></h3>
<div class="imageblock">
<div class="content">
<img src="_images/provision-config-keys.png" alt="provision config keys">
</div>
<div class="title">Figure 2. Provisioning and Configuration Overview</div>
</div>
</div>
<div class="sect2">
<h3 id="_activation_keys_best_practices"><a class="anchor" href="#_activation_keys_best_practices"></a><a class="link" href="#_activation_keys_best_practices">7.3. Activation Keys Best Practices</a></h3>
<div class="paragraph">
<p>There are a few important concepts which should be kept in mind when creating activation keys.
The following sections provide insight when creating and naming your activation keys.</p>
</div>
<div class="sect3">
<h4 id="_key_label_naming"><a class="anchor" href="#_key_label_naming"></a><a class="link" href="#_key_label_naming">7.3.1. Key Label Naming</a></h4>
<div class="paragraph">
<p>One of the most important things to consider during activation key creation is label naming.
Creating names which are associated with your organization&#8217;s infrastructure will make it easier for you when performing more complex operations.
When naming key labels keep the following in mind:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>OS naming (mandatory): Keys should always refer to the OS they provide settings for</p>
</li>
<li>
<p>Architecture naming (recommended): Unless your company is running on one architecture only, for example x86_64, then providing labels with an architecture type is a good idea.</p>
</li>
<li>
<p>Server type naming: What is, or what will this server be used for?</p>
</li>
<li>
<p>Location naming: Where is the server located? Room, building, or department?</p>
</li>
<li>
<p>Date naming: Maintenance windows, quarter, etc.</p>
</li>
<li>
<p>Custom naming: What naming scheme suits your organizations needs?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example activation key label names:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sles12-sp2-web_server-room_129-x86_64</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>sles12-sp2-test_packages-blg_502-room_21-ppc64le</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_channels_which_will_be_included"><a class="anchor" href="#_channels_which_will_be_included"></a><a class="link" href="#_channels_which_will_be_included">7.3.2. Channels which will be Included</a></h4>
<div class="paragraph">
<p>When creating activation keys you also need to keep in mind which channels (software sources) will be associated with it.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
<div class="title">Default Base Channel</div>
<div class="paragraph">
<p>Keys should have a specific base channel assigned to it, for example <code>SLES12-SP2-Pool-x86_64</code>.
If this is not the case  cannot use specific stages.
Using the default base channel is not recommended and may cause problems.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Channels to be included:</p>
<div class="ulist">
<ul>
<li>
<p>suse-manager-tools</p>
</li>
</ul>
</div>
</li>
<li>
<p>Typical packages to be included:</p>
<div class="ulist">
<ul>
<li>
<p>osad (pushing tasks)</p>
<div class="ulist">
<ul>
<li>
<p>Installs <span class="package">python-jabberpy</span> and <span class="package">pyxml</span> as dependencies</p>
</li>
</ul>
</div>
</li>
<li>
<p><span class="package">rhncfg-actions</span> (Remote Command, Configuration Managment)</p>
<div class="ulist">
<ul>
<li>
<p>Installs <span class="package">rhncfg</span> and <span class="package">rhncfg-client</span> as dependencies</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_combining_activation_keys"><a class="anchor" href="#_combining_activation_keys"></a><a class="link" href="#_combining_activation_keys">7.4. Combining Activation Keys</a></h3>
<div class="paragraph">
<p>You can combine activation keys when executing the bootstrap script on your clients.
Combining keys allows for more control on what is installed on your systems and reduces duplication of keys for large complex environments.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/combine-keys.png" alt="combine keys">
</div>
<div class="title">Figure 3. Combining Activation Keys</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/combine-keys2.png" alt="combine keys2">
</div>
<div class="title">Figure 4. Combining Activation Keys 2</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_activation_keys_and_bootstrap_with_traditional_clients_non_salt"><a class="anchor" href="#_using_activation_keys_and_bootstrap_with_traditional_clients_non_salt"></a><a class="link" href="#_using_activation_keys_and_bootstrap_with_traditional_clients_non_salt">7.5. Using Activation Keys and Bootstrap with Traditional Clients (Non-Salt)</a></h3>
<div class="paragraph">
<p>Create the initial bootstrap script template from the command line on the 
server with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># mgr-bootstrap</pre>
</div>
</div>
<div class="paragraph">
<p>This command will generate the bootstrap script and place them in <code class="path">/srv/www/htdocs/pub/bootstrap</code>
.</p>
</div>
<div class="paragraph">
<p>Alternatively you may use the WebUI
to create your bootstrap script template.
For more information, see <a href="#s3-sattools-config-bootstrap">[s3-sattools-config-bootstrap]</a>.</p>
</div>
<div class="paragraph">
<p>Use the WebUI
to create your keys.
From the WebUI
proceed to <span class="menuseq"><b class="menu">Overview</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Tasks</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Manage
   Activation Keys</b></span>
.</p>
</div>
</div>
<div class="sect2">
<h3 id="bp.chapt.act.keys.with.salt.minions"><a class="anchor" href="#bp.chapt.act.keys.with.salt.minions"></a><a class="link" href="#bp.chapt.act.keys.with.salt.minions">7.6. Using Activation Keys when Registering Salt Minions</a></h3>
<div class="paragraph">
<p>With the addition of Salt to 
 3 states should now be considered best practice over the more traditional way of combining activation keys.
Although states allow for more configuration options you need to place the new system within the correct group so the desired states will be applied to the system.
Using an activation key on your minions will place the system within the correct group automatically.</p>
</div>
<div class="paragraph">
<p>You should be aware of a few facts when working with Salt over traditional activation keys:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Currently we do not support specifying an activation key on the minion on-boarding page.</p>
</li>
<li>
<p>Activation keys used with Salt minions are the same as those used with traditional systems and may be shared.</p>
</li>
<li>
<p>The equivalent of specifying a key using the traditional bootstrap method is to place the desired key in the grain of a minion. For more information on grains, see <a href="https://docs.saltstack.com/en/latest/topics/targeting/grains.html" class="bare">https://docs.saltstack.com/en/latest/topics/targeting/grains.html</a></p>
</li>
<li>
<p>Once a minion has been accepted either from the <span class="menuseq"><b class="menu">Salt</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Keys</b></span> page located in the WebUI or from the command line, all configurations specified by the activation key placed within a salt grain will be applied.</p>
</li>
<li>
<p>Currently you may only use one activation key when working with salt. You cannot combine them, despite this, salt states allow for even more control.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_using_an_activation_key_and_custom_grains_file"><a class="anchor" href="#_using_an_activation_key_and_custom_grains_file"></a><a class="link" href="#_using_an_activation_key_and_custom_grains_file">7.6.1. Using an Activation Key and Custom Grains File</a></h4>
<div class="paragraph">
<p>Create a custom grains file and place it on the minion here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># /etc/salt/grains</pre>
</div>
</div>
<div class="paragraph">
<p>Then add the following lines to the grains file replacing 1-sles12-sp2 with your activation key label:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>susemanager:
  activation_key: 1-sles12-sp2</pre>
</div>
</div>
<div class="paragraph">
<p>Now restart the minion with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># systemctl restart salt-minion</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_an_activation_key_in_the_minion_configuration_file"><a class="anchor" href="#_using_an_activation_key_in_the_minion_configuration_file"></a><a class="link" href="#_using_an_activation_key_in_the_minion_configuration_file">7.6.2. Using an Activation Key in the Minion Configuration File</a></h4>
<div class="paragraph">
<p>You may also place the activation key grain within the minion configuration file located in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># /etc/salt/minion</pre>
</div>
</div>
<div class="paragraph">
<p>Now add the following lines to the minion configuration file replacing 1-sles12-sp2 with your activation key label:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>grains:
  susemanager:
    activation_key: 1-sles12-sp2</pre>
</div>
</div>
<div class="paragraph">
<p>Reboot the minion with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># systemctl restart salt-minion</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bp.systems.management"><a class="anchor" href="#bp.systems.management"></a><a class="link" href="#bp.systems.management">8. Contact Methods</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_selecting_a_contact_method"><a class="anchor" href="#_selecting_a_contact_method"></a><a class="link" href="#_selecting_a_contact_method">8.1. Selecting a Contact Method</a></h3>
<div class="paragraph">
<p> provides several methods for communication between client and server.
All commands your  server sends its clients to do will be routed through one of them.
Which one you select will depend on your network infrastructure.
The following sections provide a starting point for selecting a method which best suits your network environment.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
<div class="title">Contact Methods and Salt</div>
<div class="paragraph">
<p>This chapter is only relevant for traditional clients as Salt clients (minions) utilize a Salt specific contact method.
For general information about Salt clients, see <a href="#salt.gs.guide.intro">[salt.gs.guide.intro]</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="bp.contact.methods.rhnsd"><a class="anchor" href="#bp.contact.methods.rhnsd"></a><a class="link" href="#bp.contact.methods.rhnsd">8.2. Default (the  Daemon rhnsd)</a></h3>
<div class="paragraph">
<p>The  daemon (<code class="command">rhnsd</code>) runs on client systems and periodically connects with  to check for new updates and notifications.
The daemon, which runs in the background, is started by <code class="systemitem">rhnsd.service</code>
.
By default, it will check every 4 hours for new actions, therefore it may take some time for your clients to begin updating after actions have been scheduled for them.</p>
</div>
<div class="paragraph">
<p>To check for updates, <code class="systemitem">rhnsd</code>
 runs the external <code class="systemitem">mgr_check</code>
 program located in <code class="path">/usr/sbin/</code>
.
This is a small application that establishes the network connection to .
The SUSE Manager daemon does not listen on any network ports or talk to the network directly.
All network activity is done via the <code class="systemitem">mgr_check</code>
 utility.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title=":warning:"></i>
</td>
<td class="content">
<div class="title">Auto accepting (EULAs)</div>
<div class="paragraph">
<p>When new packages or updates are installed on the client using , any end user licence agreements (EULAs) are automatically accepted.
To review a package EULA, open the package detail page in the WebUI.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This figure provides an overview of the default <code class="systemitem">rhnsd</code>
 process path.
All items left of the <code class="systemitem">Python XMLRPC server</code>
 block represent processes running on a  client.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/rhnsd-taigon.png" alt="rhnsd taigon">
</div>
<div class="title">Figure 5. rhnsd Contact Method</div>
</div>
<div class="sect3">
<h4 id="_configuring_rhnsd_daemon"><a class="anchor" href="#_configuring_rhnsd_daemon"></a><a class="link" href="#_configuring_rhnsd_daemon">8.2.1. Configuring  rhnsd Daemon</a></h4>
<div class="paragraph">
<p>The  daemon can be configured by editing the file on the client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/etc/sysconfig/rhn/rhnsd</pre>
</div>
</div>
<div class="paragraph">
<p>This is the configuration file the rhnsd initialization script uses.
An important parameter for the daemon is its check-in frequency.
The default interval time is four hours (240 minutes). If you modify the configuration file, you must as {rootuser}
restart the daemon with <code class="command">systemctl rhnsd restart</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
<div class="title">Minimum Allowed Check-in Parameter</div>
<div class="paragraph">
<p>The minimum allowed time interval is one hour (60 minutes). If you set the interval below one hour, it will change back to the default of 4 hours (240 minutes).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_viewing_rhnsd_daemon_status"><a class="anchor" href="#_viewing_rhnsd_daemon_status"></a><a class="link" href="#_viewing_rhnsd_daemon_status">8.2.2. Viewing rhnsd Daemon Status</a></h4>
<div class="paragraph">
<p>You can view the status of rhnsd by typing the command <code class="command">systemctl status
     rhnsd</code> as {rootuser}
.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bp.contact.methods.ssh.push"><a class="anchor" href="#bp.contact.methods.ssh.push"></a><a class="link" href="#bp.contact.methods.ssh.push">8.3. Push via SSH</a></h3>
<div class="paragraph">
<p>Push via SSH is intended to be used in environments where your clients cannot reach the  server directly to regularly check in and, for example, fetch package updates.</p>
</div>
<div class="paragraph">
<p>In detail, this feature enables a  located within an internal network to manage clients located on a &#8220;Demilitarized Zone&#8221; (DMZ) outside of the firewall protected network.
Due to security reasons, no system on a DMZ is authorized to open a connection to the internal network and therefore your  server.
The solution is to configure Push via SSH which utilizes an encrypted tunnel from your  server on the internal network to the clients located on the DMZ.
After all actions/events are executed, the tunnel is closed.
The server will contact the clients in regular intervals (using SSH) to check in and perform all actions and events.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
<div class="title">Push via SSH Unsupported Actions</div>
<div class="paragraph">
<p>Certain actions are currently not supported on scheduled clients which are managed via Push via SSH.
This includes re-installation of systems using the provisioning module.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following figure provides an overview of the Push via SSH process path.
All items left of the <code class="systemitem">Taskomatic</code>
 block represent processes running on a  client.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sshpush-taigon.png" alt="sshpush taigon">
</div>
<div class="title">Figure 6. Push via SSH Contact Method</div>
</div>
<div class="sect3">
<h4 id="bp.contact.methods.ssh.push.requirements"><a class="anchor" href="#bp.contact.methods.ssh.push.requirements"></a><a class="link" href="#bp.contact.methods.ssh.push.requirements">8.3.1. Configuring the Server for Push via SSH</a></h4>
<div class="paragraph">
<p>For tunneling connections via SSH, two available port numbers are required, one for tunneling HTTP and the second for tunneling via HTTPS (HTTP is only necessary during the registration process). The port numbers used by default are <code>1232</code> and <code>1233</code>.
To overwrite these, add two custom port numbers greater than 1024 to <code class="path">/etc/rhn/rhn.conf</code>
 like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ssh_push_port_http = high port 1
ssh_push_port_https = high port 2</pre>
</div>
</div>
<div class="paragraph">
<p>If you would like your clients to be contacted via their hostnames instead of an IP address, set the following option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ssh_push_use_hostname = true</pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to adjust the number of threads to use for opening client connections in parallel.
By default two parallel threads are used.
Set <code class="systemitem">taskomatic.ssh_push_workers</code>
 in <code class="path">/etc/rhn/rhn.conf</code>
 like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>taskomatic.ssh_push_workers = number</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bp.contact.methods.ssh.push.sudo"><a class="anchor" href="#bp.contact.methods.ssh.push.sudo"></a><a class="link" href="#bp.contact.methods.ssh.push.sudo">8.3.2. Using sudo with Push via SSH</a></h4>
<div class="paragraph">
<p>For security reasons you may desire to use sudo and SSH into a system as a user other than {rootuser}
.
The following procedure will guide you through configuring sudo for use with Push via SSH.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
<div class="title">sudo Requirements</div>
<div class="paragraph">
<p>The packages <code class="path">spacewalk-taskomatic &gt;= 2.1.165.19</code>
 and <code class="path">spacewalk-certs-tools &#8658; 2.1.6.7</code>
 are required for using sudo with Push via SSH.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="pro.bp.contact.methods.ssh.push.sudo.user" class="olist arabic">
<div class="title">Procedure: Configuring sudo</div>
<ol class="arabic">
<li>
<p>Set the following parameter on the server located in <code class="path">/etc/rhn/rhn.conf</code> .</p>
<div class="listingblock">
<div class="content">
<pre>ssh_push_sudo_user =`user`</pre>
</div>
</div>
<div class="paragraph">
<p>The server will use sudo to ssh as the configured <code class="replaceable">user</code>.</p>
</div>
</li>
<li>
<p>You must create the user specified in <a href="#pro.bp.contact.methods.ssh.push.sudo.user">Procedure: Configuring sudo</a> on each of your clients and the following parameters should be commented out within each client&#8217;s <code class="path">/etc/sudoers</code> file:</p>
<div class="listingblock">
<div class="content">
<pre>#Defaults targetpw   # ask for the password of the target user i.e. root
#ALL    ALL=(ALL) ALL   # WARNING! Only use this together with 'Defaults targetpw'!</pre>
</div>
</div>
</li>
<li>
<p>Add the following lines beneath the <code>\## User privilege specification</code> section of each client&#8217;s <code class="path">/etc/sudoers</code> file:</p>
<div class="listingblock">
<div class="content">
<pre>&lt;user&gt; ALL=(ALL) NOPASSWD:/usr/sbin/mgr_check
&lt;user&gt; ALL=(ALL) NOPASSWD:/home/&lt;user&gt;/enable.sh
&lt;user&gt; ALL=(ALL) NOPASSWD:/home/&lt;user&gt;/bootstrap.sh</pre>
</div>
</div>
</li>
<li>
<p>On each client add the following two lines to the <code class="path">/home/user/.bashrc</code> file:</p>
<div class="listingblock">
<div class="content">
<pre>PATH=$PATH:/usr/sbin
export PATH</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_client_registration"><a class="anchor" href="#_client_registration"></a><a class="link" href="#_client_registration">8.3.3. Client Registration</a></h4>
<div class="paragraph">
<p>As your clients cannot reach the server, you will need to register your clients from the server.
A tool for performing registration of clients from the server is included with  and is called <code class="command">mgr-ssh-push-init</code>.
This tool expects a client&#8217;s hostname or IP address and the path to a valid bootstrap script located in the server&#8217;s filesystem for registration as parameters.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
<div class="title">Specifying Ports for Tunneling before Registering Clients</div>
<div class="paragraph">
<p>The ports for tunneling need to be specified before the first client is registered.
Clients already registered before changing the port numbers must be registered again, otherwise the server will not be able to contact them anymore.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
<div class="title"><code class="command">mgr-ssh-push-init</code> Disables rhnsd</div>
<div class="paragraph">
<p>The <code class="command">mgr-ssh-push-init</code> command disables the <code class="systemitem">rhnsd</code>
 daemon which normally checks for updates every 4 hours.
Because your clients cannot reach the server without using the Push via SSH contact method, the <code class="systemitem">rhnsd</code>
 daemon is disabled.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For registration of systems which should be managed via the Push via SSH tunnel contact method, it is required to use an activation key that is configured to use this method.
Normal <code class="systemitem">Push via SSH</code>
 is unable to reach the server.
For managing activation keys, see <a href="#bp.key.managment">Activation Key Management</a>.</p>
</div>
<div class="paragraph">
<p>Run the following command as {rootuser}
on the server to register a client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># mgr-ssh-push-init --client client --register \
/srv/www/htdocs/pub/bootstrap/bootstrap_script --tunnel</pre>
</div>
</div>
<div class="paragraph">
<p>To enable a client to be managed using Push via SSH (without tunneling), the same script may be used.
Registration is optional since it can also be done from within the client in this case. <code class="command">mgr-ssh-push-init</code> will also automatically generate the necessary SSH key pair if it does not yet exist on the server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># mgr-ssh-push-init --client`client`--register bootstrap_script</pre>
</div>
</div>
<div class="paragraph">
<p>When using the Push via SSH tunnel contact method, the client is configured to connect  via the high ports mentioned above (see <code class="path">/etc/sysconfig/rhn/up2date</code>
). Tools like <code class="command">rhn_check</code> and <code class="command">zypper</code> will need an active SSH session with the proper port forwarding options in order to access the  API.
To verify the Push via SSH tunnel connection manually, run the following command on the  server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># ssh -i /root/.ssh/id_susemanager -R high port: susemanager :443`client`zypper ref</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bp.contact.methods.ssh.push.api.support"><a class="anchor" href="#bp.contact.methods.ssh.push.api.support"></a><a class="link" href="#bp.contact.methods.ssh.push.api.support">8.3.4. API Support for Push via SSH</a></h4>
<div class="paragraph">
<p>The contact method to be used for managing a server can also be modified via the API.
The following example code (python) shows how to set a system&#8217;s contact method to <code>ssh-push</code>.
Valid values are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>default</code> (pull)</p>
</li>
<li>
<p><code>ssh-push</code></p>
</li>
<li>
<p><code>ssh-push-tunnel</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>client = xmlrpclib.Server(SUMA_HOST + "/rpc/api", verbose=0)
key = client.auth.login(SUMA_LOGIN, SUMA_PASSWORD)
client.system.setDetails(key, 1000012345, {'contact_method' : 'ssh-push'})</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
<div class="title">Migration and Management via Push via SSH</div>
<div class="paragraph">
<p>When a system should be migrated and managed using Push via SSH, it requires setup using the <code class="systemitem">mgr-ssh-push-init</code>
 script before the server can connect via SSH.
This separate command requires human interaction to install the server&#8217;s SSH key onto the managed client ({rootuser}
 password). The following procedure illustrates how to migrate an already registered system:</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure: Migrating Registered Systems</div>
<ol class="arabic">
<li>
<p>Setup the client using the <code class="systemitem">mgr-ssh-push-init</code> script (without <code class="option">--register</code>).</p>
</li>
<li>
<p>Change the client&#8217;s contact method to <code>ssh-push</code> or <code>ssh-push-tunnel</code> respectively (via API or Web UI).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Existing activation keys can also be edited via API to use the Push via SSH contact method for clients registered with these keys:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>client.activationkey.setDetails(key, '1-mykey', {'contact_method' : 'ssh-push'})</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bp.contact.methods.ssh.push.proxy.support"><a class="anchor" href="#bp.contact.methods.ssh.push.proxy.support"></a><a class="link" href="#bp.contact.methods.ssh.push.proxy.support">8.3.5. Proxy Support with Push via SSH</a></h4>
<div class="paragraph">
<p>It is possible to use Push via SSH to manage systems that are connected to the  server via a proxy.
To register a system, run <code class="systemitem">mgr-ssh-push-init</code>
 on the proxy system for each client you wish to register.
Update your proxy with the latest packages to ensure the registration tool is available.
It is necessary to copy the ssh key to your proxy.
This can be achieved by executing the following command from the server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{prompt.root}mgr-ssh-push-init --client`proxy`</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bp.contact.methods.saltssh.push"><a class="anchor" href="#bp.contact.methods.saltssh.push"></a><a class="link" href="#bp.contact.methods.saltssh.push">8.4. Push via Salt SSH</a></h3>
<div class="paragraph">
<p>Push via Salt SSH is intended to be used in environments where your Salt clients cannot reach the  server directly to regularly checking in and, for example, fetch package updates.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
<div class="title">Push via SSH</div>
<div class="paragraph">
<p>This feature is not related to Push via SSH for the traditional clients.
For Push via SSH, see <a href="#bp.contact.methods.ssh.push">Push via SSH</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_overview"><a class="anchor" href="#_overview"></a><a class="link" href="#_overview">8.4.1. Overview</a></h4>
<div class="imageblock">
<div class="content">
<img src="_images/salt-ssh-contact-taigon.png" alt="salt ssh contact taigon">
</div>
<div class="title">Figure 7. Push via Salt SSH Contact Method</div>
</div>
<div class="paragraph">
<p>Salt provides &#8220;Salt SSH&#8221;
 (<code class="command">salt-ssh</code>), a feature to manage clients from a server.
It works without installing Salt related software on clients.
Using Salt SSH there is no need to have minions connected to the Salt master.
Using this as a  connect method, this feature provides similar functionality for Salt clients as the traditional Push via SSH feature for traditional clients.</p>
</div>
<div class="paragraph">
<p>This feature allows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Managing Salt entitled systems with the Push via SSH contact method using Salt SSH.</p>
</li>
<li>
<p>Bootstrapping such systems.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_requirements"><a class="anchor" href="#_requirements"></a><a class="link" href="#_requirements">8.4.2. Requirements</a></h4>
<div class="ulist">
<ul>
<li>
<p>SSH daemon must be running on the remote system and reachable by the <code class="systemitem">salt-api</code> daemon (typically running on the  server).</p>
</li>
<li>
<p>Python must be available on the remote system (Python must be supported by the installed Salt). Currently: python 2.6.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
<div class="title">Unsupported Systems</div>
<div class="paragraph">
<p>Red Hat Enterprise Linux
and CentOS versions &#8656; 5 are not supported because they do not have Python 2.6 by default.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_bootstrapping"><a class="anchor" href="#_bootstrapping"></a><a class="link" href="#_bootstrapping">8.4.3. Bootstrapping</a></h4>
<div class="paragraph">
<p>To bootstrap a Salt SSH system, proceed as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the <span class="menuseq"><b class="menu">Bootstrap Minions</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">] dialog in the Web UI (menu:Systems[Bootstrapping</b></span> ).</p>
</li>
<li>
<p>Fill out the required fields. Select an <span class="menuseq"><b class="menu">Activation Key</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">] with the menu:Push via SSH[</b></span> contact method configured. For more information about activation keys, see <a href="#ref.webui.systems.activ-keys">[ref.webui.systems.activ-keys]</a>.</p>
</li>
<li>
<p>Check the <b class="menuref">Manage system completely via SSH</b> option.</p>
</li>
<li>
<p>Confirm with clicking the <b class="menuref">Bootstrap</b> button.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now the system will be bootstrapped and registered in .
If done successfully, it will appear in the <b class="menuref">Systems</b> list.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuration"><a class="anchor" href="#_configuration"></a><a class="link" href="#_configuration">8.4.4. Configuration</a></h4>
<div class="paragraph">
<p>There are two kinds of parameters for Push via Salt SSH:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Bootstrap-time parameters {mdash} configured in the <b class="menuref">Bootstrapping</b> page:</p>
<div class="ulist">
<ul>
<li>
<p>Host</p>
</li>
<li>
<p>Activation key</p>
</li>
<li>
<p>Password {mdash} used only for bootstrapping, not saved anywhere; all future SSH sessions are authorized via a key/certificate pair</p>
</li>
</ul>
</div>
</li>
<li>
<p>Persistent parameters {mdash} configured -wide:</p>
<div class="ulist">
<ul>
<li>
<p>sudo user {mdash} same as in <a href="#bp.contact.methods.ssh.push.sudo">Using sudo with Push via SSH</a>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_action_execution"><a class="anchor" href="#_action_execution"></a><a class="link" href="#_action_execution">8.4.5. Action Execution</a></h4>
<div class="paragraph">
<p>The Push via Salt SSH feature uses a taskomatic job to execute scheduled actions using <code class="command">salt-ssh</code>.
The taskomatic job periodically checks for scheduled actions and executes them.
While on traditional clients with SSH push configured only <code class="command">rhn_check</code> is executed via SSH, the Salt SSH push job executes a complete <code class="command">salt-ssh</code> call based on the scheduled action.</p>
</div>
</div>
<div class="sect3">
<h4 id="_known_limitation"><a class="anchor" href="#_known_limitation"></a><a class="link" href="#_known_limitation">8.4.6. Known Limitation</a></h4>
<div class="ulist">
<ul>
<li>
<p>OpenSCAP auditing is not available on Salt SSH minions.</p>
</li>
<li>
<p>Beacons do not work with Salt SSH.</p>
<div class="ulist">
<ul>
<li>
<p>Installing a package on a system using <code class="command">zypper</code> will not invoke the package refresh.</p>
</li>
<li>
<p>Virtual Host functions (for example, a host to guests) will not work if the virtual host system is Salt SSH-based.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_for_more_information"><a class="anchor" href="#_for_more_information"></a><a class="link" href="#_for_more_information">8.4.7. For More Information</a></h4>
<div class="paragraph">
<p>For more information, see</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://wiki.microfocus.com/index.php/SUSE_Manager/SaltSSHServerPush" class="bare">https://wiki.microfocus.com/index.php/SUSE_Manager/SaltSSHServerPush</a></p>
</li>
<li>
<p><a href="https://docs.saltstack.com/en/latest/topics/ssh/" class="bare">https://docs.saltstack.com/en/latest/topics/ssh/</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bp.contact.methods.osad"><a class="anchor" href="#bp.contact.methods.osad"></a><a class="link" href="#bp.contact.methods.osad">8.5. OSAD</a></h3>
<div class="paragraph">
<p>OSAD is an alternative contact method between  and its clients.
By default,  uses <code class="systemitem">rhnsd</code>, which contacts the server every four hours to execute scheduled actions.
OSAD allows registered client systems to execute scheduled actions immediately.</p>
</div>
<div class="paragraph">
<p>OSAD has several distinct components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code class="systemitem">osa-dispatcher</code> service runs on the server, and uses database checks  to determine if clients need to be pinged, or if actions need to be executed.</p>
</li>
<li>
<p>The <code class="systemitem">osad</code> service runs on the client. It responds to pings from <code class="systemitem">osa-dispatcher</code> and runs <code class="command">mgr_check</code> to execute actions when directed to do so.</p>
</li>
<li>
<p>The <code class="systemitem">jabberd</code> service is a daemon that uses the <code class="systemitem">XMPP</code> protocol for communication between the client and the server.
The <code class="systemitem">jabberd</code> service also handles authentication.</p>
</li>
<li>
<p>The <code class="command">mgr_check</code> tool runs on the client to execute actions.
It is triggered by communication from the <code class="systemitem">osa-dispatcher</code> service.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code class="systemitem">osa-dispatcher</code> periodically runs a query to check when clients last showed network activity.
If it finds a client that has not shown activity recently, it will use <code class="systemitem">jabberd</code> to ping all <code class="systemitem">osad</code> instances running on all clients registered with your  server.
The <code class="systemitem">osad</code> instances respond to the ping using <code class="systemitem">jabberd</code>, which is running in the background on the server.
When the <code class="systemitem">osa-dispatcher</code> receives the response, it marks the client as online.
If the <code class="systemitem">osa-dispatcher</code> fails to receive a response within a certain period of time, it marks the client as offline.</p>
</div>
<div class="paragraph">
<p>When you schedule actions on an OSAD-enabled system, the task will be carried out  immediately.
The <code class="systemitem">osa-dispatcher</code> periodically checks clients for actions that need to be executed.
If an outstanding action is found, it uses <code class="systemitem">jabberd</code> to execute <code class="command">mgr_check</code> on the client, which will then execute the action.</p>
</div>
<div class="sect3">
<h4 id="_enabling_and_configuring_osad"><a class="anchor" href="#_enabling_and_configuring_osad"></a><a class="link" href="#_enabling_and_configuring_osad">8.5.1. Enabling and Configuring OSAD</a></h4>
<div class="paragraph">
<p>This section covers enabling the <code class="systemitem">osa-dispatcher</code> and <code class="systemitem">osad</code> services, and performing initial setup.</p>
</div>
<div class="paragraph">
<p>OSAD clients use the fully qualified domain name (FQDN) of the server to communicate with the <code class="systemitem">osa-dispatcher</code> service.</p>
</div>
<div class="paragraph">
<p>SSL is required for <code class="systemitem">osad</code> communication.
If SSL certificates are not available, the daemon on your client systems will fail to connect.
Make sure your firewall rules are set to allow the required ports.
For more information, see <a href="#tab.install.ports.server">Required Server Ports</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: Enabling OSAD</div>
<ol class="arabic">
<li>
<p>On your  server, as the root user, start the <code class="systemitem">osa-dispatcher</code> service:</p>
<div class="listingblock">
<div class="content">
<pre>systemctl start osa-dispatcher</pre>
</div>
</div>
</li>
<li>
<p>On each client machine, install the <code class="systemitem">osad</code> package from the <code class="systemitem">Tools</code> child channel.
The <code class="systemitem">osad</code> package should be installed on clients only.
If you install the <code class="systemitem">osad</code> package on your  Server, it will conflict with the <code class="systemitem">osa-dispatcher</code> package.</p>
</li>
<li>
<p>On the client systems, as the root user, start the <code class="systemitem">osad</code> service:</p>
<div class="listingblock">
<div class="content">
<pre>systemctl start osad</pre>
</div>
</div>
<div class="paragraph">
<p>Because <code class="systemitem">osad</code> and <code class="systemitem">osa-dispatcher</code> are run as services, you can use standard commands to manage them, including <code class="command">stop</code>, <code class="command">restart</code>, and <code class="command">status</code>.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Configuration and Log Files</div>
<p>Each OSAD component is configured by local configuration files.
We recommend you keep the default configuration parameters for all OSAD components.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Location</th>
<th class="tableblock halign-left valign-top">Path to Configuration File</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code class="systemitem">osa-dispatcher</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code class="path">/etc/rhn/rhn.conf</code> Section: <code class="systemitem">OSA configuration</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code class="systemitem">osad</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code class="path">/etc/sysconfig/rhn/osad.conf</code> <code class="path">/etc/syseconfig/rhn/up2date</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code class="systemitem">osad</code>  log file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code class="path">/var/log/osad</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code class="systemitem">jabberd</code> log file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Both</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code class="path">/var/log/messages</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">Troubleshooting OSAD</div>
<p>If your OSAD clients cannot connect to the server, or if the <code class="systemitem">jabberd</code> service takes a lot of time responding to port 5552, it could be because you have exceeded the open file count.</p>
</div>
<div class="paragraph">
<p>Every client needs one always-open TCP connection to the server, which consumes a single file handler.
If the number of file handlers currently open exceeds the maximum number of files that <code class="systemitem">jabberd</code> is allowed to use, <code class="systemitem">jabberd</code> will queue the requests, and refuse connections.</p>
</div>
<div class="paragraph">
<p>To resolve this issue, you can increase the file limits for <code class="systemitem">jabberd</code> by editing the <code class="path">/etc/security/limits.conf</code> configuration file and adding these lines:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>jabbersoftnofile5100
jabberhardnofile6000</pre>
</div>
</div>
<div class="paragraph">
<p>Calculate the limits required for your environment by adding 100 to the number of clients for the soft limit, and 1000 to the current number of clients for the soft limit.
In the example above, we have assumed 500 current clients, so the soft limit is 5100, and the hard limit is 6000.</p>
</div>
<div class="paragraph">
<p>You will also need to update the <code class="systemitem">max_fds</code> parameter in the <code class="path">/etc/jabberd/c2s.xml</code> file with your chosen hard limit:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;max_fds&gt;6000&lt;/max_fds&gt;</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bp.susecom.lifecycle.management"><a class="anchor" href="#bp.susecom.lifecycle.management"></a><a class="link" href="#bp.susecom.lifecycle.management">9. Advanced Patch Lifecycle Management</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Keeping systems patched and secure remains one of the greatest ongoing challenges that you will face as an administrator.
Both proprietary and open-source companies are constantly working to provide updates which fix flaws discovered within their software products.</p>
</div>
<div class="paragraph">
<p>For the official <em class="ref">Best Practice Guide</em>
 on &#8220;Advanced Patch Lifecycle Management&#8221;
, see <a href="https://www.suse.com/documentation/suse-best-practices/susemanager/data/susemanager.html" class="bare">https://www.suse.com/documentation/suse-best-practices/susemanager/data/susemanager.html</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bp.live.patching"><a class="anchor" href="#bp.live.patching"></a><a class="link" href="#bp.live.patching">10. Live Patching with SUSE Manager</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="live.patching.intro"><a class="anchor" href="#live.patching.intro"></a><a class="link" href="#live.patching.intro">10.1. Introduction</a></h3>
<div class="paragraph">
<p>Under normal circumstances a system needs to be rebooted after a kernel update.
SLE Live Patching allows you skipping the reboot by applying a subset of Linux kernel releases injected via kGraft live patching technology.</p>
</div>
<div class="paragraph">
<p>In the following sections you will learn how to use SLE Live Patching to avoid the typical reboot requirement after updating a system kernel.</p>
</div>
<div class="paragraph">
<p>For in depth information covering kGraft use, see <a href="https://www.suse.com/documentation/sles-12/singlehtml/book_sle_admin/book_sle_admin.html#cha.kgraft" class="bare">https://www.suse.com/documentation/sles-12/singlehtml/book_sle_admin/book_sle_admin.html#cha.kgraft</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="live.patching.req"><a class="anchor" href="#live.patching.req"></a><a class="link" href="#live.patching.req">10.2. Initial Setup Requirements</a></h3>
<div class="paragraph">
<p>To work with SLE Live Patching the following expectations are assumed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p> fully updated.</p>
</li>
<li>
<p>At least 1 Salt Minion running SLES 12 SP1 or later and registered with  .</p>
</li>
<li>
<p>The matching SLES 12 SPx channels including the SLE Live Patching child channel fully synced.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="live.patching.setup"><a class="anchor" href="#live.patching.setup"></a><a class="link" href="#live.patching.setup">10.3. Live Patching Setup</a></h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Subscribe all systems to be managed via live patching to your fully synced live patching child channels within your systems base channel by browsing to <span class="menuseq"><b class="menu">Software</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Software Channels</b></span> . Select both live patching channels and change subscription.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
When subscribing to a channel that contains a product, the product package will automatically be installed on traditionaly registered systems and added to the package state on Salt managed systems.
For Salt managed systems please apply the highstate to push these changes to your systems.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/enable_live_patching_channels.png" alt="enable live patching channels">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the search field listed under <span class="menuseq"><b class="menu">Software</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Packages</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Install</b></span> to install the latest <code class="path">kgraft</code> package to all systems to be managed via live patching.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/enable_live_patching_kgraft_install.png" alt="enable live patching kgraft install">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Apply the highstate to enable live patching:</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/enable_live_patching_apply_highstate.png" alt="enable live patching apply highstate">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Once the highstate has been applied on Salt systems or the package has been installed on traditional systems browse to the systems details page for confirmation that live patching has been enabled. You can check the live patching state listed under the <span class="menuseq"><b class="menu">System Info</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Kernel</b></span> table field:</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/enable_live_patching_successful.png" alt="enable live patching successful">
</div>
</div>
</div>
<div class="sect2">
<h3 id="live.patching.clones"><a class="anchor" href="#live.patching.clones"></a><a class="link" href="#live.patching.clones">10.4. Cloning Channels</a></h3>
<div class="paragraph">
<p>It is considered best practice to clone a vendor channel that will be modified into a new channel with one of the following prefix names: <code>dev</code>, <code>testing</code>, and <code>prod</code>.
In the following procedure you will clone the default vendor channel into a new channel named <code class="systemitem">dev-sles12-sp3-pool-x86_64</code>
 using the command line.</p>
</div>
<div id="proc.live.patching.clones" class="olist arabic">
<ol class="arabic">
<li>
<p>Open a terminal and as root enter:</p>
<div class="listingblock">
<div class="content">
<pre># spacewalk-manage-channel-lifecycle --list-channels
Spacewalk Username: admin
Spacewalk Password:
Channel tree:

 1. sles{sles-version}-sp{sp-ver}-pool-x86_64
      \__ sle-live-patching{sles-version}-pool-x86_64-sp{sp-ver}\__ sle-live-patching{sles-version}-updates-x86_64-sp{sp-ver}\__ sle-manager-tools{sles-version}-pool-x86_64-sp{sp-ver}\__ sle-manager-tools{sles-version}-updates-x86_64-sp{sp-ver}\__ sles{sles-version}-sp{sp-ver}-updates-x86_64</pre>
</div>
</div>
</li>
<li>
<p>Now use the <em>--init</em> argument to automatically create a new development clone of the original vendor channel:</p>
<div class="listingblock">
<div class="content">
<pre>spacewalk-manage-channel-lifecycle --init -c sles{sles-version}-sp{sp-ver}-pool-x86_64</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="live.patching.kernel"><a class="anchor" href="#live.patching.kernel"></a><a class="link" href="#live.patching.kernel">10.5. Removing Non-live Kernel Patches from the Cloned Channels</a></h3>
<div class="paragraph">
<p>In the following procedure you will remove all kernel patch updates located in the dev-sles12
-sp{sp-ver}
-updates-x86_64 channel that require a reboot.
You created dev-sles12
-sp{sp-ver}
-updates-x86_64 during <a href="#proc.live.patching.clones">[proc.live.patching.clones]</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Check the current kernel version in use on your client:</p>
<div class="listingblock">
<div class="content">
<pre># uname -r
3.12.62-60.64.8-default</pre>
</div>
</div>
</li>
<li>
<p>From the  WebUI select <span class="menuseq"><b class="menu">Software</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Manage Software Channels</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Overview</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">dev-sles12-sp3-updates-x86_64</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Patches</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">List/Remove</b></span> . Type <code>kernel</code> in the search field. Find the kernel version that matches the kernel in use on your minion.</p>
</li>
<li>
<p>Remove all kernel update versions that are later than the current kernel.</p>
</li>
<li>
<p>Your channel is now ready to promote for testing SLE Live Patching.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="live.patching.channel-promo"><a class="anchor" href="#live.patching.channel-promo"></a><a class="link" href="#live.patching.channel-promo">10.6. Promoting Channels</a></h3>
<div class="paragraph">
<p>The following procedure will guide you through promoting and cloning a development channel to a testing channel.
You will change the subscription from the dev repositories on your client to the new testing channel repositories.
You will also add the SLE Live Patching child channels to your client.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Promote and clone the <code>dev-sles12 -sp{sp-ver} -pool-x86_64</code> to a new testing channel:</p>
<div class="listingblock">
<div class="content">
<pre>{prompt.root}spacewalk-manage-channel-lifecycle -promote -c dev-sles{sles-version}-sp{sp-ver}-pool-x86_64</pre>
</div>
</div>
</li>
<li>
<p>From the  WebUI under the <span class="menuseq"><b class="menu">Systems</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">] tab select your client system to view the menu:System Details[</b></span> page. Select <span class="menuseq"><b class="menu">Software</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Software Channels</b></span> . From the Software Channels page you can edit which channels a system is subscribed to. Select the new base software channel, in this case it should be <code class="systemitem">test-sles12-sp3-pool-x86_64</code> . Click the <span class="menuseq"><b class="menu">Confirm</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">] button to switch the Base Software Channel and finalize it by clicking the menu:Modify Base Software Channel[</b></span> button.</p>
</li>
<li>
<p>From the <span class="menuseq"><b class="menu">Software Channels</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">] page select and add both SLE Live Patching child channels by clicking the menu:Change Subscriptions[</b></span> button.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="live.patching.applying"><a class="anchor" href="#live.patching.applying"></a><a class="link" href="#live.patching.applying">10.7. Applying Live Patches to a Kernel</a></h3>
<div class="paragraph">
<p>The following procedure will guide you through selecting and viewing available CVE Patches (Common Vulnerabilities and Exposures) then applying these kernel updates using the new SLE Live Patching feature.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select your SLES 12 SP{sp-ver} minion from the <span class="menuseq"><b class="menu">Systems</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">] page to view its menu:System Details[</b></span> . Once you have added the SLES 12 SP{sp-ver} Updates child channel to your client, you should see several <code>Critical</code> software updates available. Click on <code>Critical</code> to see a list of available patches. Select any of these patches listed with the following synopsis: <em>Important: Security update for the Linux kernel</em>. All fixed security bugs will be listed along with their number. For example:(CVE-2016-8666)</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
<div class="title">Reboot Icon</div>
Normal or non-live kernel patches always require a reboot.
In  these are represented by a <code>Reboot Required</code> icon located next to the <code>Security</code> shield icon.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>You can search for individual CVE&#8217;s by selecting the <b class="menuref">Audit</b> tab from the navigation menu. Try searching for <code>CVE-2016-8666</code>. You will see that the patch is available in the vendor update channel and the systems it applies to will be listed.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
<div class="title">CVE Availability</div>
<div class="paragraph">
<p>Not all security issues can be fixed by applying a live patch.
Some security issues can only be fixed by applying a full kernel update and will required a reboot.
The assigned CVE numbers for these issues are not included in live patches.
A CVE audit will display this requirement.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bp.sp.migration"><a class="anchor" href="#bp.sp.migration"></a><a class="link" href="#bp.sp.migration">11.  Server Migration</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="bp.sp.migration.sp.intro"><a class="anchor" href="#bp.sp.migration.sp.intro"></a><a class="link" href="#bp.sp.migration.sp.intro">11.1. Service Pack Migration Introduction</a></h3>
<div class="paragraph">
<p>You can upgrade the underlying operating system and also migrate  server from one patch level to the other (SP migration) or from one version to the next.
This works for migrating  server 3.0 to version 3.1, or version 3.1 to version 3.2.
For migrating version 3.0 to version 3.1, see the product documentation for  3.1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>https://www.suse.com/documentation/suse-manager-3/</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bp.sp.migration.sp"><a class="anchor" href="#bp.sp.migration.sp"></a><a class="link" href="#bp.sp.migration.sp">11.2. Service Pack Migration</a></h3>
<div class="paragraph">
<p>SUSE Manager uses SUSE Linux Enterprise Server 12 as its underlying operating system.
Therefore Service Pack migration (for example, from version 12 SP1 to 12 SP3) may be performed in the same way as a typical SLES migration.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title=":warning:"></i>
</td>
<td class="content">
<div class="title">Upgrading PostgreSQL to Version 9.6 Before Migrating to SLES12 SP3</div>
<div class="paragraph">
<p>Before migrating the underlying system to SUSE Linux Enterprise 12 SP3 you must upgrade PostgreSQL to version 9.6.</p>
</div>
<div class="paragraph">
<p>The migration needs PostgreSQL 9.4 and 9.6 installed in parallel and PostgreSQL 9.4 is only available in SUSE Linux Enterprise 12 SP2.
For more information, see <a href="#sp.migration.postgresql">Upgrading PostgreSQL to Version 9.6</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>SUSE offers a graphical and command line tool for upgrading to a new service pack.
Comprehensive documentation for executing service pack migration scenarios is located in the SUSE Linux Enterprise Server documentation chapter <a href="https://www.suse.com/documentation/sles-12/book_sle_deployment/data/cha_update_sle.html" class="bare">https://www.suse.com/documentation/sles-12/book_sle_deployment/data/cha_update_sle.html</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="sp.migration.postgresql"><a class="anchor" href="#sp.migration.postgresql"></a><a class="link" href="#sp.migration.postgresql">11.3. Upgrading PostgreSQL to Version 9.6</a></h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title=":warning:"></i>
</td>
<td class="content">
<div class="title">Migrating to SLES 12 SP3</div>
<div class="paragraph">
<p> Server 3.1 must <em>not</em> be migrated to SLES 12 SP3 before upgrading PostgreSQL to version 9.6.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The upgrade needs PostgreSQL 9.4 and 9.6 installed in parallel.
PostgreSQL 9.4 is only available in SLES 12 SP2.</p>
</div>
<div class="paragraph">
<p>Before starting the update, prepare an up-to-date backup of your database.</p>
</div>
<div class="paragraph">
<p>On existing installations of  Server 3.1 you must migrate from PostgreSQL 9.4 to version 9.6.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/usr/lib/susemanager/bin/pg-migrate.sh</pre>
</div>
</div>
<div class="paragraph">
<p>During the upgrade your  Server will not be accessible.</p>
</div>
<div class="paragraph">
<p>The upgrade will create a copy of the database under <code class="path">/var/lib/pgsql</code> and thus needs sufficient disk space to hold two copies (versions 9.4 and 9.6) of the database.
Because it does a full copy of the database, it also needs considerable time depending on the size of the database and the I/O speed of the storage system.</p>
</div>
<div class="paragraph">
<p>If your system is short on disk space you can do a fast, in-place upgrade by running</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/usr/lib/susemanager/bin/pg-migrate.sh fast</pre>
</div>
</div>
<div class="paragraph">
<p>The fast upgrade usually only takes a few minutes and uses no additional disk space.
However, if the upgrade fails, you will need to restore the database from a backup.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://wiki.microfocus.com/index.php?title=SUSE_Manager/postgresql96" class="bare">https://wiki.microfocus.com/index.php?title=SUSE_Manager/postgresql96</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="update.suse.manager"><a class="anchor" href="#update.suse.manager"></a><a class="link" href="#update.suse.manager">11.4. Updating </a></h3>
<div class="paragraph">
<p>This section provides information on performing regular updates and running a <code class="command">spacewalk-schema-upgrade</code> on your PostgreSQL database.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: Updating </div>
<ol class="arabic">
<li>
<p>As the root user, stop Spacewalk services:</p>
<div class="listingblock">
<div class="content">
<pre>spacewalk-service stop</pre>
</div>
</div>
</li>
<li>
<p>Apply the latest patches:</p>
<div class="listingblock">
<div class="content">
<pre>zypper patch</pre>
</div>
</div>
</li>
<li>
<p>You will be informed if a new database schema was included in the latest patch. Ensure the database service is running:</p>
<div class="listingblock">
<div class="content">
<pre>rcpostgresql start</pre>
</div>
</div>
</li>
<li>
<p>Perform the upgrade:</p>
<div class="listingblock">
<div class="content">
<pre>spacewalk-schema-upgrade</pre>
</div>
</div>
</li>
<li>
<p>Restart Spacewalk services:</p>
<div class="listingblock">
<div class="content">
<pre>spacewalk-service start</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
<div class="title">Restart of Services and Applications</div>
<div class="paragraph">
<p>Services affected by a package update are not automatically restarted after an update.
You need to restart these services manually to avoid potential failures.</p>
</div>
<div class="paragraph">
<p>You may use <code class="command">zypper ps</code> to check for any applications which may be using old code.
Restart these applications.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="bp.sp.migration.version"><a class="anchor" href="#bp.sp.migration.version"></a><a class="link" href="#bp.sp.migration.version">11.5. Migrating  version 3.1 to 3.2</a></h3>
<div class="paragraph">
<p>The migration can either be done with the Online Migration tool (YaST) or with the Zypper command line tool.</p>
</div>
<div class="paragraph">
<div class="title">Requirements</div>
<p> 3.2 requires SLES 12 SP3, with PostgreSQL version 9.6.
Check the release notes for more information about these requirements.
If you want to upgrade from an earlier version of , check the relevant product documentation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
<div class="title">Reduce Installation Size</div>
<div class="paragraph">
<p>When performing the migration, YaST will install all recommended packages.
Especially in the case of custom minimal installations, this may increase the installation size of the system significantly.</p>
</div>
<div class="paragraph">
<p>To change this default behavior and allow only required packages, adjust <code class="path">/etc/zypp/zypp.conf</code> and set the following variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>solver.onlyRequires = true
installRecommends=false # or commented</pre>
</div>
</div>
<div class="paragraph">
<p>This changes the behavior of all package operations, such as the installation of patches or new packages.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="bp.sp.migration.version.yast"><a class="anchor" href="#bp.sp.migration.version.yast"></a><a class="link" href="#bp.sp.migration.version.yast">11.5.1. Using YaST</a></h4>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title=":warning:"></i>
</td>
<td class="content">
<div class="title">Checking PostgreSQL Version</div>
<div class="paragraph">
<p>Before migrating to SLES 12 SP3, check whether PostgreSQL is already updated to version 9.6.
For more information, see <a href="#sp.migration.postgresql">Upgrading PostgreSQL to Version 9.6</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To perform the migration with YaST, use the <b class="menuref">Online Migration</b> tool:</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: Migrating using YaST</div>
<ol class="arabic">
<li>
<p>If you are logged into a GNOME session running on the machine you are going to update, switch to a text console.
Running the update from within a GNOME session is not recommended.
This does not apply when being logged in from a remote machine (unless you are running a VNC session with GNOME).</p>
</li>
<li>
<p>Start in YaST<span class="menuseq"><b class="menu">System</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Online Migration</b></span> (<code class="command">yast2 migration</code>).
YaST will show possible migration targets with detailed summaries.</p>
<div class="paragraph">
<p>In case of trouble, resolve the following issues first:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the <b class="menuref">Online Migration</b> is not available, install the <span class="package">yast2-migration</span> package and its dependencies.
Restart YaST , otherwise the newly installed module will not be shown in the control center.</p>
</li>
<li>
<p>If there are &#8220;old&#8221; online updates available for installation, the migration tool will warn and ask to install them now before starting the actual migration.
It is recommended to install all updates before proceeding.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="bp.sp.migration.version.zypper"><a class="anchor" href="#bp.sp.migration.version.zypper"></a><a class="link" href="#bp.sp.migration.version.zypper">11.5.2. Using zypper</a></h4>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title=":warning:"></i>
</td>
<td class="content">
<div class="title">Checking PostgreSQL Version</div>
<div class="paragraph">
<p>Before migrating to SLES 12 SP3, check whether PostgreSQL is already updated to version 9.6.
For more information, see <a href="#sp.migration.postgresql">Upgrading PostgreSQL to Version 9.6</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To perform the migration with Zypper on the command-line, use the <code class="command">zypper migration</code> subcommand tool:</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: Migrating using <code class="command">zypper migration</code></div>
<ol class="arabic">
<li>
<p>If you are logged into a GNOME session running on the machine you are going to update, switch to a text console.
Running the update from within a GNOME session is not recommended.
This does not apply when being logged in from a remote machine (unless you are running a VNC session with GNOME).</p>
</li>
<li>
<p>The <code class="command">zypper migration</code> subcommand show possible migration targets and a summary.</p>
<div class="paragraph">
<p>In case of trouble, resolve the following issues first:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the <code class="command">migration</code> subcommand is not available install the <span class="package">zypper-migration-plugin</span> package and its dependencies.</p>
</li>
<li>
<p>If there are &#8220;old&#8221; online updates available for installation, the migration tool will warn and ask to install them now before starting the actual migration.
It is recommended to install all updates before proceeding.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If more than one migration target is available for your system, select one from the list (specify the number).</p>
</li>
<li>
<p>Read the notification and update the  database schema as described (<code class="command">spacewalk-schema-upgrade</code>).</p>
</li>
<li>
<p>Make sure  is up and running (<code class="command">spacewalk-service start</code>).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>After finishing the migration procedure  3.2 on SLES 12 SP3 is available to be used.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bp.chap.mgr.migration"><a class="anchor" href="#bp.chap.mgr.migration"></a><a class="link" href="#bp.chap.mgr.migration">12.  Migration from Version 2.1 to Version 3</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The migration from  2.1 to  3 works in the same way as a migration from Red Hat Satellite to .
The migration happens from the original machine to a new one.
There is no in-place migration.
While this has the drawback that you temporarily need two machines, it also has the advantage that the original machine will remain fully functional in case something goes wrong.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
<div class="title">Migration Process</div>
<div class="paragraph">
<p>The whole process may be tricky, so it is strongly advised that the migration is done by an experienced consultant.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Given the complexity of the product, the migration is an &#8220;all-or-nothing&#8221;
 procedure{mdash}
if something goes wrong you will need to start all over.
Error handling is very limited.
Nevertheless it should work more or less out of the box if all the steps are carefully executed as documented.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
<div class="title">Time-Consuming Operation</div>
<div class="paragraph">
<p>The migration involves dumping the whole database on the source machine and restoring it on the target machine.
Also all of the channels and packages need to be copied to the new machine, so expect the whole migration to take several hours,</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="bp.sec.mgr.migration.prereq"><a class="anchor" href="#bp.sec.mgr.migration.prereq"></a><a class="link" href="#bp.sec.mgr.migration.prereq">12.1. Prerequisites</a></h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title=":warning:"></i>
</td>
<td class="content">
<div class="title">Latest Updates</div>
<div class="paragraph">
<p>The source machine needs to run  2.1 with all the latest updates applied.
Before starting the migration process, make sure that the machine is up to date and all updates have been installed sucessfully.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Only machines running with the embedded PostgreSQL database may be migrated in one go.
For the migration of an Oracle based installation, a two-step migration is required: First the installation needs to get migrated from Oracle to PostgreSQL (by means of a separate tool) and afterwards the migration to  3 can be performed as documented here.</p>
</div>
<div class="paragraph">
<p> 3 no longer supports Novell Customer Center but only SCC (SUSE Customer Center).
Therefore, you can migrate a machine only after it has been switched to SCC.
The migration script will check if the installation has already been switched to SCC and will terminate if this is not the case.
Switch to SCC on the source machine and repeat the migration.
During migration the database from the source machine needs to get dumped and this dump needs to be temporarily stored on the target system.
The dump gets compressed with <code class="command">gzip</code> using the default compression options (maximum compression only yields about 10% of space savings but costs a lot of runtime); so check the disk usage of the database with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{prompt.root}du -sch /var/lib/pgsql/data</pre>
</div>
</div>
<div class="paragraph">
<p>This will ensure that you have at least 30 % of this value available in <code class="path">/var/spacewalk/tmp</code>
.</p>
</div>
<div class="paragraph">
<p>These values from a test migration should aid in illustrating space requirements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>suma21:/var/lib/pgsql# du -sch data
1,8G    data
1,8G    total
suma21:/var/spacewalk/tmp# ls -lh susemanager.dmp.gz
-rw-r--r-- 1 root root 506M Jan 12 14:58 susemanager.dmp.gz</pre>
</div>
</div>
<div class="paragraph">
<p>This is a small test installation; for bigger installations the ratio might be better (space required for the database dump might be less than 30%). The dump will be written to the directory <code class="path">/var/spacewalk/tmp</code>
, the directory will be created if it does not exist yet.
If you want the dump to be stored somewhere else, change the definition of the variable <code class="var">$TMPDIR</code> on the beginning of the script to suit your needs.</p>
</div>
</div>
<div class="sect2">
<h3 id="bp.sec.mgr.migration.setup.target"><a class="anchor" href="#bp.sec.mgr.migration.setup.target"></a><a class="link" href="#bp.sec.mgr.migration.setup.target">12.2. Setup the Target Machine</a></h3>
<div class="paragraph">
<p>To prepare the target machine (with the example host name <code>suma30</code>) proceed as follows:</p>
</div>
<div id="proc.mgr.migration.setup.target" class="olist arabic">
<div class="title">Procedure: Setup Target Machine</div>
<ol class="arabic">
<li>
<p>On the target machine install SUSE Linux Enterprise Server 12 SP2 including the extension product &#8220;&#8221; .</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
<div class="title">Background Information on Required Target Machine</div>
It is actually required to install version 12 SP2 on the target machine.
On that version you will upgrade the PostgreSQL database from version_9.4 to 9.6.
For more information about the PostgreSQL upgrade, see <a href="#sp.migration.postgresql">Upgrading PostgreSQL to Version 9.6</a>.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Initiate <code class="command">yast2 susemanagersetup</code> as you would normally do for an installation of .</p>
<div class="paragraph">
<p>For more information about installing , see <a href="#sles.installation.within.kvm.jeos">[sles.installation.within.kvm.jeos]</a>.</p>
</div>
</li>
<li>
<p>On the first  setup screen, ensure that <span class="menuseq"><b class="menu">Migrate a SUSE Manager compatible server</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">] is marked instead of menu:Set up SUSE Manager from scratch[</b></span> .</p>
</li>
<li>
<p>On the second screen, enter the name of the source system as <b class="menuref">Hostname of source SUSE Manager Server</b> as well as the domain name. Also enter the database credentials of the source system.</p>
</li>
<li>
<p>On the next screen, you will need to specify the IP address of the  3 target system. Normally this value should be pre-set to the correct value and you only should need to press <kbd>Enter</kbd> . Only in the case of multiple IP addresses you might need to specify the one that should be used during migration.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
<div class="title">Faking the Host Name</div>
During the migration process, the target system will fake its host name to be the same as the source system, this is necessary as the host name of a  installation is vital and should not be changed once set.
Therefore do not be confused when logging in to your systems during migration; they both will present you with the same host name.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Continue by following the normal installation steps.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
<div class="title">Database Parameters</div>
Specify the database parameters using the same database parameters as the source system is recommended.
At least, using the the same database credentials as when creating the source or original  database is mandatory.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Enter your SCC credentials.
After all the data has been gathered, YaST
will terminate.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The actual migration will not start automatically but needs to be triggered manually as outlined in <a href="#bp.sec.mgr.migration.performing">Performing the Migration</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="bp.sec.mgr.migration.performing"><a class="anchor" href="#bp.sec.mgr.migration.performing"></a><a class="link" href="#bp.sec.mgr.migration.performing">12.3. Performing the Migration</a></h3>
<div class="paragraph">
<p>A migration is performed by excecuting the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/usr/lib/susemanager/bin/mgr-setup -m</pre>
</div>
</div>
<div class="paragraph">
<p>This command reads the data gathered during <a href="#proc.mgr.migration.setup.target">Procedure: Setup Target Machine</a>, sets up  onto a new target machine and transfers all of the data from the source machine.
As several operations need to be performed on the source machine via SSH, you will be prompted once for the root password of the source machine.
A temporary SSH key named <code>migration-key</code> is created and installed on the source machine, so you need to give the {rootuser}
 password only once.
The temporary SSH key will be deleted after successful migration.
Ideally, this is all you will need to do.</p>
</div>
<div class="paragraph">
<p>Depending on the size of the installation, the actual migration will take up to several hours.
Once finished, you will be prompted to shutdown the source machine, re-configure the network of the target machine to use the same IP address and host name as the original machine and restart it.
It should now be a fully functional replacement for your previous  2.1 installation.
The following numbers illustrate the runtime for dumping and importing a small database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>14:53:37   Dumping remote database to /var/spacewalk/tmp/susemanager.dmp.gz on target system. Please wait...
14:58:14   Database successfully dumped. Size is: 506M
14:58:29   Importing database dump. Please wait...
15:05:11   Database dump successfully imported.</pre>
</div>
</div>
<div class="paragraph">
<p>For this example dumping the database takes around five minutes to complete.
Importing the dump onto the target system will take an additional seven minutes.
For big installations this can take up to several hours.
You should also account for the time it takes to copy all the package data to the new machine.
Depending on your network infrastructure and hardware, this can also take a significant amount of time.</p>
</div>
</div>
<div class="sect2">
<h3 id="bp.sec.mgr.migration.speedup"><a class="anchor" href="#bp.sec.mgr.migration.speedup"></a><a class="link" href="#bp.sec.mgr.migration.speedup">12.4. Speeding up the Migration</a></h3>
<div class="paragraph">
<p>A complete migration can consume a lot of time.
This is caused by the amount of data that must be copied.
Total migration time can be greatly decreased by eliminating the need to copy data prior to performing the migration (for example, channels, packages, auto-install images, and any additional data). You can gather all data via YaST
by running the command <code class="command">mgr-setup -r</code>.</p>
</div>
<div class="paragraph">
<p>Executing <code class="command">mgr-setup -r</code> will copy the data from the old server to the new one.
This command may be run at any time and your current server will remain fully functional.
Once the migration has been initiated only data changed since running <code class="command">mgr-setup -r</code> will need to be transferred which will significantly reduces downtime.</p>
</div>
<div class="paragraph">
<p>On large installations transfering the database (which involves dumping the database onto the source machine and then importing the dump onto the target system) will still take some time.
During the database transfer no write operations should occur therefore the migration script will shut down any  database services running on the source machine.</p>
</div>
</div>
<div class="sect2">
<h3 id="bp.sec.mgr.migration.pkg.extern"><a class="anchor" href="#bp.sec.mgr.migration.pkg.extern"></a><a class="link" href="#bp.sec.mgr.migration.pkg.extern">12.5. Packages on External Storage</a></h3>
<div class="paragraph">
<p>Some installations may store the package data on external storage (for example, NFS mount on <code class="path">/var/spacewalk/packages</code>
). You do not need to copy this data to the new machine.
Edit the script located in <code class="path">/usr/lib/susemanager/bin/mgr-setup</code>
 and remove the respective <code class="command">rsync</code> command (located around line 345).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
<div class="title">Mounting External Storage</div>
<div class="paragraph">
<p>Make sure your external storage is mounted on the new machine before starting the system for the first time.
Analogue handling for <code class="path">/srv/www/htdocs/pub</code>
 if appropriate.</p>
</div>
<div class="paragraph">
<p>In general, all needed files and directories, not copied by the migration tool, should be copied to the new server manually.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="bp.sec.mgr.migration.trouble"><a class="anchor" href="#bp.sec.mgr.migration.trouble"></a><a class="link" href="#bp.sec.mgr.migration.trouble">12.6. Troubleshooting a Broken WebUI after Migration</a></h3>
<div class="paragraph">
<p>It is possible that the WebUI
may break during migration.
This behavior is not a bug, but a browser caching issue.
The new machine has the same host name and IP address as the old machine.
This duplication can confuse some Web browsers.
If you experience this issue reload the page.
For example, in Firefox pressing the key combination <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>F5</kbd></span>
 should resume normal functionality.</p>
</div>
</div>
<div class="sect2">
<h3 id="bp.sec.mgr.migration.example"><a class="anchor" href="#bp.sec.mgr.migration.example"></a><a class="link" href="#bp.sec.mgr.migration.example">12.7. Example Session</a></h3>
<div class="paragraph">
<p>This is the output of a typical migration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>suma30# /usr/lib/susemanager/bin/mgr-setup -m
  Filesystem type for /var/spacewalk is ext4 - ok.
  Open needed firewall ports...
  Migration needs to execute several commands on the remote machine.
  Please enter the root password of the remote machine.
Password:
  Remote machine is SUSE Manager
  Remote system is already migrated to SCC. Good.
  Shutting down remote spacewalk services...
  Shutting down spacewalk services...
  Stopping Taskomatic...
  Stopped Taskomatic.
  Stopping cobbler daemon: ..done

  Stopping rhn-search...
  Stopped rhn-search.
  Stopping MonitoringScout ...
  [ OK ]
  Stopping Monitoring ...
  [ OK ]
  Shutting down osa-dispatcher: ..done
  Shutting down httpd2 (waiting for all children to terminate) ..done
  Shutting down Tomcat (/usr/share/tomcat6)
  ..done
  Terminating jabberd processes...
        Stopping router ..done
        Stopping sm ..done
        Stopping c2s ..done
        Stopping s2s ..done
  Done.
  CREATE ROLE
  * Loading answer file: /root/spacewalk-answers.
  ** Database: Setting up database connection for PostgreSQL backend.
  ** Database: Populating database.
  ** Database: Skipping database population.
  * Configuring tomcat.
  * Setting up users and groups.
  ** GPG: Initializing GPG and importing key.
  * Performing initial configuration.
  * Configuring apache SSL virtual host.
  ** /etc/apache2/vhosts.d/vhost-ssl.conf has been backed up to vhost-ssl.conf-swsave
  * Configuring jabberd.
  * Creating SSL certificates.
  ** Skipping SSL certificate generation.
  * Deploying configuration files.
  * Setting up Cobbler..
  * Setting up Salt Master.
  11:26:47   Dumping remote database. Please wait...
  11:26:50   Database successfully dumped.
  Copy remote database dump to local machine...
  Delete remote database dump...
  11:26:50   Importing database dump. Please wait...
  11:28:55   Database dump successfully imported.
  Schema upgrade: [susemanager-schema-2.1.50.14-3.2.devel21] -&gt; [susemanager-schema-3.0.5-5.1.develHead]
  Searching for upgrade path to: [susemanager-schema-3.0.5-5.1]
  Searching for upgrade path to: [susemanager-schema-3.0.5]
  Searching for upgrade path to: [susemanager-schema-3.0]
  Searching for start path:  [susemanager-schema-2.1.50.14-3.2]
  Searching for start path:  [susemanager-schema-2.1.50.14]
  The path: [susemanager-schema-2.1.50.14] -&gt; [susemanager-schema-2.1.50.15] -&gt; [susemanager-schema-2.1.51] -&gt; [susemanager-schema-3.0]
  Planning to run schema upgrade with dir '/var/log/spacewalk/schema-upgrade/schema-from-20160112-112856'
  Executing spacewalk-sql, the log is in [/var/log/spacewalk/schema-upgrade/schema-from-20160112-112856-to-susemanager-schema-3.0.log].
(248/248) apply upgrade [schema-from-20160112-112856/99_9999-upgrade-end.sql]        e-suse-channels-to-public-channel-family.sql.postgresql]
  The database schema was upgraded to version [susemanager-schema-3.0.5-5.1.develHead].
  Copy files from old SUSE Manager...
  receiving incremental file list
  ./
  packages/

  sent 18 bytes  received 66 bytes  168.00 bytes/sec
  total size is 0  speedup is 0.00
  receiving incremental file list
  ./
  RHN-ORG-TRUSTED-SSL-CERT
  res.key
  rhn-org-trusted-ssl-cert-1.0-1.noarch.rpm
  suse-307E3D54.key
  suse-39DB7C82.key
  suse-9C800ACA.key
  bootstrap/
  bootstrap/bootstrap.sh
  bootstrap/client-config-overrides.txt
  bootstrap/sm-client-tools.rpm

  sent 189 bytes  received 66,701 bytes  44,593.33 bytes/sec
  total size is 72,427  speedup is 1.08
  receiving incremental file list
  ./
  .mtime
  lock
  web.ss
  config/
  config/distros.d/
  config/images.d/
  config/profiles.d/
  config/repos.d/
  config/systems.d/
  kickstarts/
  kickstarts/autoyast_sample.xml
  loaders/
  snippets/
  triggers/
  triggers/add/
  triggers/add/distro/
  triggers/add/distro/post/
  triggers/add/distro/pre/
  triggers/add/profile/
  triggers/add/profile/post/
  triggers/add/profile/pre/
  triggers/add/repo/
  triggers/add/repo/post/
  triggers/add/repo/pre/
  triggers/add/system/
  triggers/add/system/post/
  triggers/add/system/pre/
  triggers/change/
  triggers/delete/
  triggers/delete/distro/
  triggers/delete/distro/post/
  triggers/delete/distro/pre/
  triggers/delete/profile/
  triggers/delete/profile/post/
  triggers/delete/profile/pre/
  triggers/delete/repo/
  triggers/delete/repo/post/
  triggers/delete/repo/pre/
  triggers/delete/system/
  triggers/delete/system/post/
  triggers/delete/system/pre/
  triggers/install/
  triggers/install/post/
  triggers/install/pre/
  triggers/sync/
  triggers/sync/post/
  triggers/sync/pre/

  sent 262 bytes  received 3,446 bytes  7,416.00 bytes/sec
  total size is 70,742  speedup is 19.08
  receiving incremental file list
  kickstarts/
  kickstarts/snippets/
  kickstarts/snippets/default_motd
  kickstarts/snippets/keep_system_id
  kickstarts/snippets/post_delete_system
  kickstarts/snippets/post_reactivation_key
  kickstarts/snippets/redhat_register
  kickstarts/snippets/sles_no_signature_checks
  kickstarts/snippets/sles_register
  kickstarts/snippets/sles_register_script
  kickstarts/snippets/wait_for_networkmanager_script
  kickstarts/upload/
  kickstarts/wizard/

  sent 324 bytes  received 1,063 bytes  2,774.00 bytes/sec
  total size is 12,133  speedup is 8.75
  receiving incremental file list
  ssl-build/
  ssl-build/RHN-ORG-PRIVATE-SSL-KEY
  ssl-build/RHN-ORG-TRUSTED-SSL-CERT
  ssl-build/index.txt
  ssl-build/index.txt.attr
  ssl-build/latest.txt
  ssl-build/rhn-ca-openssl.cnf
  ssl-build/rhn-ca-openssl.cnf.1
  ssl-build/rhn-org-trusted-ssl-cert-1.0-1.noarch.rpm
  ssl-build/rhn-org-trusted-ssl-cert-1.0-1.src.rpm
  ssl-build/serial
  ssl-build/d248/
  ssl-build/d248/latest.txt
  ssl-build/d248/rhn-org-httpd-ssl-archive-d248-1.0-1.tar
  ssl-build/d248/rhn-org-httpd-ssl-key-pair-d248-1.0-1.noarch.rpm
  ssl-build/d248/rhn-org-httpd-ssl-key-pair-d248-1.0-1.src.rpm
  ssl-build/d248/rhn-server-openssl.cnf
  ssl-build/d248/server.crt
  ssl-build/d248/server.csr
  ssl-build/d248/server.key
  ssl-build/d248/server.pem

  sent 380 bytes  received 50,377 bytes  101,514.00 bytes/sec
  total size is 90,001  speedup is 1.77
  SUSE Manager Database Control. Version 1.5.2
  Copyright (c) 2012 by SUSE Linux Products GmbH

  INFO: Database configuration has been changed.
  INFO: Wrote new general configuration. Backup as /var/lib/pgsql/data/postgresql.2016-01-12-11-29-42.conf
  INFO: Wrote new client auth configuration. Backup as /var/lib/pgsql/data/pg_hba.2016-01-12-11-29-42.conf
  INFO: New configuration has been applied.
  Database is online
  System check finished

  ============================================================================
  Migration complete.
  Please shut down the old SUSE Manager server now.
  Reboot the new server and make sure it uses the same IP address and hostname
  as the old SUSE Manager server!

  IMPORTANT: Make sure, if applicable, that your external storage is mounted
  in the new server as well as the ISO images needed for distributions before
  rebooting the new server!
  ============================================================================</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bp.client.migration"><a class="anchor" href="#bp.client.migration"></a><a class="link" href="#bp.client.migration">13. Client Migration</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Upgrading from SLE&#160;12 with the latest service pack (SP) to SLE&#160;15 can be automated, but requires some preparation steps.</p>
</div>
<div class="paragraph">
<p>To upgrade the SP version on SLE&#160;12 (for example, upgrading from SLE&#160;12, or SLE&#160;12&#160;SP1 or SP2, to SLE&#160;12&#160;SP3 or later) can be fully automated and requires no additional preparation.</p>
</div>
<div class="sect2">
<h3 id="bp.client.migration.sle"><a class="anchor" href="#bp.client.migration.sle"></a><a class="link" href="#bp.client.migration.sle">13.1. Upgrading SLE&#160;12&#160;SPx to version 15</a></h3>
<div class="paragraph">
<p>SLE&#160;12&#160;SPx clients can be auto-upgraded to SLE&#160;15 with YaST auto-installation.
This also applies for other supported products based on SLE&#160;12.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
<div class="title">Supported Upgrade Paths</div>
<div class="paragraph">
<p>For generally supported SUSE Linux Enterprise upgrade paths, see  <a href="https://www.suse.com/documentation/sles-15/book_sle_upgrade/data/sec_upgrade-paths_supported.html" class="bare">https://www.suse.com/documentation/sles-15/book_sle_upgrade/data/sec_upgrade-paths_supported.html</a> ({slea} Upgrade Guide, Chapter &#8220;Supported Upgrade Paths to SLE 15&#8221;).
It is important that you migrate the client to the latest available SP first.
In the case of SLE&#160;12, this is currently SP3 (August 2018).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This procedure will work for traditionally  managed systems (system type <code class="systemitem">management</code>).
It is not currently available for systems using Salt (system type <code class="systemitem">salt</code>).</p>
</div>
<div class="paragraph">
<p>During the procedure, the machine reboots and performs the system upgrade.
The process is controlled by YaST and AutoYaST, not by <code class="command">zypper</code> commands.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Only perform this migration procedure on client systems managed by  servers.
For upgrading the  server itself, see <a href="#bp.sp.migration"> Server Migration</a>.
This is a viable method for major version upgrades such as an upgrade from SUSE Linux Enterprise 12 to 15.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="bp.proc.client.migration.sle.prep"><a class="anchor" href="#bp.proc.client.migration.sle.prep"></a><a class="link" href="#bp.proc.client.migration.sle.prep">13.1.1. System Upgrade Preparation</a></h4>
<div class="paragraph">
<p>Make sure your  and all the clients you want to upgrade have installed all available updates, including the  tools.
This is absolutely necessary, otherwise the system upgrade will fail.</p>
</div>
<div class="paragraph">
<p>The preparation process contains several steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download and save installation media</p>
</li>
<li>
<p>Create an auto-installation distribution</p>
</li>
<li>
<p>Create an activation key</p>
</li>
<li>
<p>Upload an AutoYaST profile</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Procedure: Download and Save Installation Media</div>
<ol class="arabic">
<li>
<p>On the  server, create a local directory for the SLE&#160;15 installation media.</p>
</li>
<li>
<p>Download an ISO image with the installation sources, and mount the ISO image on your server:</p>
<div class="listingblock">
<div class="content">
<pre>mkdir /mnt/sle15
mount -o loop DVD1.iso /mnt/sle15</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Procedure: Create an Auto-Installation Distribution</div>
<p>For all distributions you want to upgrade, create a SLE&#160;15 distribution in .</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the  Web UI, click <span class="menuseq"><b class="menu">Main Menu</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Systems</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Autoinstallation</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Distributions</b></span>.</p>
</li>
<li>
<p>Enter a <code class="guimenu">Distribution Label</code> for your distribution (for example, <code>autumn2018</code>)</p>
</li>
<li>
<p>Specify the <code class="guimenu">Tree Path</code>, which is the root directory of the SLE&#160;15 installation sources (for example, <code class="path">/mnt/sle15</code>).</p>
</li>
<li>
<p>For <code class="guimenu">Base Channel</code>, use the update target distribution <code class="systemitem">SLE-Product-SLES15-Pool for x86_64</code>.</p>
</li>
<li>
<p>Confirm with <code class="guimenu">Create Autoinstallable Distribution</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For more information about Autoinstallation, see <a href="#ref.webui.systems.autoinst">[ref.webui.systems.autoinst]</a>.</p>
</div>
<div class="paragraph">
<div class="title">Procedure: Create an Activation Key</div>
<p>In order to switch from the old SLE&#160;12&#160;SP3 base channel to the new SLE&#160;15 channel, you need an activation key.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to <span class="menuseq"><b class="menu">Main Menu</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Systems</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Activation Keys</b></span> and click <code class="guimenu">Create Key</code>.</p>
</li>
<li>
<p>Enter a description for your key.</p>
</li>
<li>
<p>Enter a key or leave it blank to generate an automatic key.</p>
</li>
<li>
<p>If you want to limit the usage, enter your value in the <code class="guimenu">Usage</code> text field.</p>
</li>
<li>
<p>Select the <code class="systemitem">SLE-Product-SLES15-Pool for x86_64</code> base channel.</p>
</li>
<li>
<p>Decide about <code class="guimenu">Add-On System Types</code>.
If in doubt, see <a href="https://www.suse.com/documentation/sles-15/book_quickstarts/data/art_modules.html" class="bare">https://www.suse.com/documentation/sles-15/book_quickstarts/data/art_modules.html</a> ({slea} Modules &amp; Extensions Quick Start).</p>
</li>
<li>
<p>Click <b class="button">Create Activation Key</b>.</p>
</li>
<li>
<p>Click the <code class="guimenu">Child Channels</code> tab and select the required channels. Finish with <b class="button">Update Key</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Procedure: Upload an AutoYaST Profile</div>
<p>Create an AutoYaST XML file according to <a href="#ap-sample-autoinst-system-upgrade">Sample Autoinstallation Script for System Upgrade (SLES 11 SP4 to SLES 12 SP3)</a>.
For more information about AutoYaST, see <a href="#ref.webui.systems.autoinst.ay_intro">[ref.webui.systems.autoinst.ay_intro]</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to <span class="menuseq"><b class="menu">Main Menu</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Systems</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Autoinstallation</b></span> and click <code class="guimenu">Upload Kickstart/Autoyast File</code>.</p>
</li>
<li>
<p>Paste the XML content in the text area or select the file to upload and click <b class="button">Create</b>.</p>
</li>
<li>
<p>Add <code>autoupgrade=1</code> in the <code class="guimenu">Kernel Options</code> of the <code class="guimenu">Details</code> tab and click <b class="button">Update</b>.</p>
</li>
<li>
<p>Switch to the <code class="guimenu">Variable</code> tab.</p>
</li>
<li>
<p>In the text field <code>registration_key=</code> enter the key from the preparation above.</p>
</li>
<li>
<p>Click <b class="button">Update Variables</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>After you have successfully finished this process, you are ready to perform the upgrade.
For upgrade instruction, see <a href="#bp.proc.client.migration.sle.upgrade">Synchronizing Target Channels</a>.</p>
</div>
<div id="bp.proc.client.migration.sle.upgrade" class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title=":warning:"></i>
</td>
<td class="content">
<div class="title">Synchronizing Target Channels</div>
Before successfully initializing the product migration, make sure that the migration target channels are completely mirrored.
For the upgrade to SUSE Linux Enterprise 15, at least the <code class="systemitem">SLE-Product-SLES15-Pool</code> base channel with the <code class="systemitem">SLE-Manager-Tools15-Pool</code> child channel for your architecture is required.
The matching update channels such as <code class="systemitem">SLE-Manager-Tools15-Updates</code> and <code class="systemitem">SLE-Product-SLES15-Updates</code> are recommended.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>+
Watch the mirroring progress in <code class="path">/var/log/rhn/reposync/sles15-pool-x86_64.log</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to the system via <span class="menuseq"><b class="menu">Main Menu</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Systems</b></span> and click the name of the system. Then click <span class="menuseq"><b class="menu">System Details</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Provisioning</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Autoinstallation</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Schedule</b></span>, and choose the AutoYaST XML profile you have uploaded above.</p>
</li>
<li>
<p>Click <b class="button">Schedule Autoinstallation and Finish</b>.</p>
<div class="paragraph">
<p>Next time the machine asks the  server for jobs, it will receive a reinstallation job which fetches kernel and initrd and writes a new <code class="path">/boot/grub/menu.lst</code> (containing pointers to the new kernel and initrd).</p>
</div>
<div class="paragraph">
<p>When the machine boots, it will use the Grub configuration and boots the new kernel with its initrd.
No PXE boot is required for this process.
A shutdown of the machine is initiated as well, effectively 3 minutes after the job was fetched.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ap-sample-autoinst-system-upgrade"><a class="anchor" href="#ap-sample-autoinst-system-upgrade"></a><a class="link" href="#ap-sample-autoinst-system-upgrade">14. Sample Autoinstallation Script for System Upgrade (SLES 11 SP4 to SLES 12 SP3)</a></h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE profile&gt;
&lt;profile xmlns="http://www.suse.com/1.0/yast2ns"
         xmlns:config="http://www.suse.com/1.0/configns"&gt;
  &lt;general&gt;
  $SNIPPET('spacewalk/sles_no_signature_checks')
    &lt;mode&gt;
      &lt;confirm config:type="boolean"&gt;false&lt;/confirm&gt;
    &lt;/mode&gt;
  &lt;/general&gt;
  &lt;add-on&gt;
    &lt;add_on_products config:type="list"&gt;
      &lt;listentry&gt;
        &lt;ask_on_error config:type="boolean"&gt;true&lt;/ask_on_error&gt;
        &lt;media_url&gt;http://$redhat_management_server/ks/dist/child/sle15-updates-x86_64/autumn2018&lt;/media_url&gt;
        &lt;name&gt;SLE15 Updates&lt;/name&gt;
        &lt;product&gt;SLE15&lt;/product&gt;
        &lt;product_dir&gt;/&lt;/product_dir&gt;
      &lt;/listentry&gt;
      &lt;listentry&gt;
        &lt;ask_on_error config:type="boolean"&gt;true&lt;/ask_on_error&gt;
        &lt;media_url&gt;http://$redhat_management_server/ks/dist/child/sle-manager-tools15-pool-x86_64-sp3/summer2017&lt;/media_url&gt;
        &lt;name&gt;SLE15 Manager Tools Pool&lt;/name&gt;
        &lt;product&gt;SLE15&lt;/product&gt;
        &lt;product_dir&gt;/&lt;/product_dir&gt;
      &lt;/listentry&gt;
      &lt;listentry&gt;
        &lt;ask_on_error config:type="boolean"&gt;true&lt;/ask_on_error&gt;
        &lt;media_url&gt;http://$redhat_management_server/ks/dist/child/sle-manager-tools15-updates-x86_64-sp3/summer2017&lt;/media_url&gt;
        &lt;name&gt;SLE15 Manager Tools Updates&lt;/name&gt;
        &lt;product&gt;SLE15&lt;/product&gt;
        &lt;product_dir&gt;/&lt;/product_dir&gt;
      &lt;/listentry&gt;
    &lt;/add_on_products&gt;
  &lt;/add-on&gt;
  &lt;upgrade&gt;
    &lt;only_installed_packages config:type="boolean"&gt;false&lt;/only_installed_packages&gt;
    &lt;stop_on_solver_conflict config:type="boolean"&gt;true&lt;/stop_on_solver_conflict&gt;
  &lt;/upgrade&gt;
  &lt;backup&gt;
    &lt;sysconfig config:type="boolean"&gt;true&lt;/sysconfig&gt;
    &lt;modified config:type="boolean"&gt;true&lt;/modified&gt;
    &lt;remove_old config:type="boolean"&gt;false&lt;/remove_old&gt;
  &lt;/backup&gt;
  &lt;networking&gt;
    &lt;keep_install_network config:type="boolean"&gt;true&lt;/keep_install_network&gt;
    &lt;start_immediately config:type="boolean"&gt;true&lt;/start_immediately&gt;
  &lt;/networking&gt;
   &lt;scripts&gt;
    &lt;init-scripts config:type="list"&gt;
      $SNIPPET('spacewalk/sles_register_script')
    &lt;/init-scripts&gt;
  &lt;/scripts&gt;
&lt;/profile&gt;</pre>
</div>
</div>
<div class="sect2">
<h3 id="bp.client.migration.sle12"><a class="anchor" href="#bp.client.migration.sle12"></a><a class="link" href="#bp.client.migration.sle12">14.1. Migrating SLE&#160;12 or later to version 12&#160;SP3</a></h3>
<div class="paragraph">
<p>Existing SLE&#160;12 clients (SLE) may be upgraded to SP3 with the <b class="menuref">SP Migration</b> procedure provided by the Web UI.
The same applies for other supported products based on SUSE Linux Enterprise 12.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title=":warning:"></i>
</td>
<td class="content">
<div class="title">Synchronizing Target Channels</div>
<div class="paragraph">
<p>Before successfully initializing the product migration, you first must make sure that the migration target channels are completely mirrored.
For the upgrade to SLE&#160;12&#160;SP3, at least the <code class="systemitem">SLES12-SP3-Pool</code>
 base channel with the <code class="systemitem">SLE-Manager-Tools12-Pool</code>
 child channel for your architecture is required.
The matching update channels such as <code class="systemitem">SLE-Manager-Tools12-Updates</code>
 and <code class="systemitem">SLES12-SP3-Updates</code>
 are recommended.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure: Migrating SLE&#160;12 Client to SP3</div>
<ol class="arabic">
<li>
<p>Direct your browser to the  Web UI where your client is registered, and login.</p>
</li>
<li>
<p>On the <span class="menuseq"><b class="menu">Systems</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">All</b></span> page select your client system from the table.</p>
<div class="imageblock">
<div class="content">
<img src="_images/sles_old_details_page.png" alt="sles old details page">
</div>
</div>
<div class="paragraph">
<p>If there are <span class="menuseq"><b class="menu">Software Updates Available</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">] in the menu:System Status[</b></span> notification install these updates first to avoid trouble during the migration process.</p>
</div>
</li>
<li>
<p>On the system&#8217;s detail page select the <span class="menuseq"><b class="menu">Software</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">] tab</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">then the menu:SP Migration[</b></span> tab.</p>
<div class="imageblock">
<div class="content">
<img src="_images/sles_old_details_spmigration.png" alt="sles old details spmigration">
</div>
</div>
</li>
<li>
<p>From this tab you will see the installed products listed on your client. Select the wanted <b class="menuref">Target Products</b> (if there is more than one), which is <code class="systemitem">SUSE Linux Enterprise Server 12&#160;SP3</code> .</p>
<div class="imageblock">
<div class="content">
<img src="_images/sles_migration_target.png" alt="sles migration target">
</div>
</div>
<div class="paragraph">
<p>Then confirm with <b class="menuref">Select Channels</b>
.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sles_migration_channels.png" alt="sles migration channels">
</div>
</div>
</li>
<li>
<p>Select <span class="menuseq"><b class="menu">Schedule Migration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">]</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">and then menu:Confirm[</b></span> .</p>
<div class="imageblock">
<div class="content">
<img src="_images/sles_migration_schedule.png" alt="sles migration schedule">
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Check the <b class="menuref">System Status</b> on the system&#8217;s details when the migration is done.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sles_migrated.png" alt="sles migrated">
</div>
</div>
<div class="paragraph">
<p>If the <span class="menuseq"><b class="menu">System Status</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">]
 notification does not report a successful migration but lists menu:Software Updates Available[</b></span>
, install the update now and then check again.</p>
</div>
<div class="paragraph">
<p>Finally, consider to schedule a reboot.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bp.postgresql.database.migration"><a class="anchor" href="#bp.postgresql.database.migration"></a><a class="link" href="#bp.postgresql.database.migration">15. Postgresql Database Migration</a></h2>
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p> 3 uses postgresql database version 9.4.
Postgresql version 9.6 has been officially released for SUSE Linux Enterprise Server 12 SP3.
In the near future postgresql 9.6 will become the base version provided by .
Currently version 9.4 is hardcoded into SUSE Manager, therefore when installing  it will explicitly use this version.
This chapter provides guidance on migrating an existing 9.4 database to 9.6 on your  Server.</p>
</div>
</blockquote>
</div>
<div class="sect2">
<h3 id="bp.postgresql.database.migration.new.installations"><a class="anchor" href="#bp.postgresql.database.migration.new.installations"></a><a class="link" href="#bp.postgresql.database.migration.new.installations">15.1. New  Installations</a></h3>
<div class="paragraph">
<p>Once support for postgresql version 9.6 has been officially released for SUSE Manager, no action will be required for new installations.
The  extension will pick up the latest version during installation on SLES 12 SP3.
This will be fully transparent to the user.
Check the active postgresql version with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>suse-manager-example-srv:~ # psql --version
psql (PostgreSQL) 9.6.3</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bp.postgresql.database.migrating.existing.installations"><a class="anchor" href="#bp.postgresql.database.migrating.existing.installations"></a><a class="link" href="#bp.postgresql.database.migrating.existing.installations">15.2. Migrating an Existing Installation</a></h3>
<div class="paragraph">
<p>Before migrating to the new database version, ensure SUSE Manager is fully patched to the latest version.
You can check if the system is ready to use postgresql 9.6 by issuing the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>suma-test-srv:~ # rpm -q smdba
smdba-1.5.8-0.2.3.1.x86_64</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Postgresql 9.6 requires smdba version 1.5.8 or higher</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title=":warning:"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Always create a database backup before performing a migration</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>.
The database migration begins by executing the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$&gt; /usr/lib/susemanager/bin/pg-migrate.sh</pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="path">pg-migrate.sh</code>
 script will automatically perform the following operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Stop spacewalk services</p>
</li>
<li>
<p>Shut down the running database</p>
</li>
<li>
<p>Check if postgresql 9.6 is installed and install it if not already present</p>
</li>
<li>
<p>Switch from postgresql 9.4 to postgresql 9.6 as the new default</p>
</li>
<li>
<p>Initiates the database migration</p>
</li>
<li>
<p>Creates a postgresql configuration file tuned for use by SUSE Manager (The reason for the latest version of smdba)</p>
</li>
<li>
<p>Start both the database and spacewalk services</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Please note that during the migration the data directory of the database is copied for use by the postgresql 9.6.
This results in temporarily doubling the amount of required disk space.
In case of a failure, the migration script will attempt a restore to the original state.
After a successful migration, you may safely delete the old database directory (renamed to /var/lib/pgsql/data-pg94) to reclaim lost disk space.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_performing_a_fast_migration"><a class="anchor" href="#_performing_a_fast_migration"></a><a class="link" href="#_performing_a_fast_migration">15.3. Performing a Fast Migration</a></h3>
<div class="paragraph">
<p>There are two negative aspects to performing a regular migration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You temporarily need double the disk space under <code class="path">/var/lib/pgsql</code></p>
</li>
<li>
<p>Depending on the size of the database the migration can take up some time because the whole data directory needs to be copied.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is possible however to perform a <code>fast migration</code>.
In this case you do not need the additional disk space as the database files will not be copied but hard linked.
This also has the natural effect of greatly increasing the speed of the migration process The entire migration could be completed in less than one minute.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title=":warning:"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Keep in mind if a fast migration fails, database restoration will only be possible with a database backup.
Only perform a fast migration if you have an availabel database backup.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Perform a fast migration with the following command (Ensure you have a database backup):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$&gt; /usr/lib/susemanager/bin/pg-migrate.sh fast</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_typical_migration_sample_session"><a class="anchor" href="#_typical_migration_sample_session"></a><a class="link" href="#_typical_migration_sample_session">15.4. Typical Migration Sample Session</a></h3>
<div class="paragraph">
<p>A slow migration should provide you with the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>d235:~ # /usr/lib/susemanager/bin/pg-migrate.sh
15:58:00   Shut down spacewalk services...
Shutting down spacewalk services...
Done.
15:58:03   Checking postgresql version...
15:58:03   Installing postgresql 9.6...
Dienst 'SUSE_Linux_Enterprise_Server_12_SP2_x86_64' wird aktualisiert.
Dienst 'SUSE_Manager_Server_3.1_x86_64' wird aktualisiert.
Repository-Daten werden geladen...
Installierte Pakete werden gelesen...
Paketabhängigkeiten werden aufgelöst...

Die folgenden 3 NEUEN Pakete werden installiert:
  postgresql96 postgresql96-contrib postgresql96-server

3 neue Pakete zu installieren.
Gesamtgröße des Downloads: 5,7 MiB. Bereits im Cache gespeichert: 0 B. Nach der Operation werden zusätzlich 25,3 MiB belegt.
Fortfahren? [j/n/...? zeigt alle Optionen] (j): j
Paket postgresql96-9.6.3-2.4.x86_64 abrufen (1/3),   1,3 MiB (  5,1 MiB entpackt)
Abrufen: postgresql96-9.6.3-2.4.x86_64.rpm [fertig]
Paket postgresql96-server-9.6.3-2.4.x86_64 abrufen (2/3),   3,7 MiB ( 17,9 MiB entpackt)
Abrufen: postgresql96-server-9.6.3-2.4.x86_64.rpm [.fertig]
Paket postgresql96-contrib-9.6.3-2.4.x86_64 abrufen (3/3), 648,9 KiB (  2,2 MiB entpackt)
Abrufen: postgresql96-contrib-9.6.3-2.4.x86_64.rpm [fertig]
Überprüfung auf Dateikonflikte läuft: [......fertig]
(1/3) Installieren: postgresql96-9.6.3-2.4.x86_64 [............fertig]
(2/3) Installieren: postgresql96-server-9.6.3-2.4.x86_64 [............fertig]
(3/3) Installieren: postgresql96-contrib-9.6.3-2.4.x86_64 [............fertig]
15:58:08   Ensure postgresql 9.6 is being used as default...
15:58:09   Successfully switched to new postgresql version 9.6.
15:58:09   Create new database directory...
15:58:09   Initialize new postgresql 9.6 database...
The files belonging to this database system will be owned by user "postgres".
This user must also own the server process.

The database cluster will be initialized with locale "en_US.UTF-8".
The default database encoding has accordingly been set to "UTF8".
The default text search configuration will be set to "english".

Data page checksums are disabled.

fixing permissions on existing directory /var/lib/pgsql/data ... ok
creating subdirectories ... ok
selecting default max_connections ... 100
selecting default shared_buffers ... 128MB
selecting dynamic shared memory implementation ... posix
creating configuration files ... ok
running bootstrap script ... ok
performing post-bootstrap initialization ... ok
syncing data to disk ... ok

WARNING: enabling "trust" authentication for local connections
You can change this by editing pg_hba.conf or using the option -A, or
--auth-local and --auth-host, the next time you run initdb.

Success. You can now start the database server using:

    pg_ctl -D /var/lib/pgsql/data -l logfile start

15:58:12   Successfully initialized new postgresql 9.6 database.
15:58:12   Upgrade database to new version postgresql 9.6...
Performing Consistency Checks
-----------------------------
Checking cluster versions                                   ok
Checking database user is the install user                  ok
Checking database connection settings                       ok
Checking for prepared transactions                          ok
Checking for reg* system OID user data types                ok
Checking for contrib/isn with bigint-passing mismatch       ok
Checking for roles starting with 'pg_'                      ok
Creating dump of global objects                             ok
Creating dump of database schemas
  postgres
  susemanager
  template1
                                                            ok
Checking for presence of required libraries                 ok
Checking database user is the install user                  ok
Checking for prepared transactions                          ok

If pg_upgrade fails after this point, you must re-initdb the
new cluster before continuing.

Performing Upgrade
------------------
Analyzing all rows in the new cluster                       ok
Freezing all rows on the new cluster                        ok
Deleting files from new pg_clog                             ok
Copying old pg_clog to new server                           ok
Setting next transaction ID and epoch for new cluster       ok
Deleting files from new pg_multixact/offsets                ok
Copying old pg_multixact/offsets to new server              ok
Deleting files from new pg_multixact/members                ok
Copying old pg_multixact/members to new server              ok
Setting next multixact ID and offset for new cluster        ok
Resetting WAL archives                                      ok
Setting frozenxid and minmxid counters in new cluster       ok
Restoring global objects in the new cluster                 ok
Restoring database schemas in the new cluster
  postgres
  susemanager
  template1
                                                            ok
Copying user relation files
  /var/lib/pgsql/data-pg94/base/12753/12710

[...]

  /var/lib/pgsql/data-pg94/base/1/12574
                                                            ok
Setting next OID for new cluster                            ok
Sync data directory to disk                                 ok
Creating script to analyze new cluster                      ok
Creating script to delete old cluster                       ok

Upgrade Complete
----------------
Optimizer statistics are not transferred by pg_upgrade so,
once you start the new server, consider running:
    ./analyze_new_cluster.sh

Running this script will delete the old cluster's data files:
    ./delete_old_cluster.sh
15:58:51   Successfully upgraded database to postgresql 9.6.
15:58:51   Tune new postgresql configuration...
INFO: Database configuration has been changed.
INFO: Wrote new general configuration. Backup as /var/lib/pgsql/data/postgresql.2017-07-26-15-58-51.conf
INFO: Wrote new client auth configuration. Backup as /var/lib/pgsql/data/pg_hba.2017-07-26-15-58-51.conf
INFO: Configuration has been changed, but your database is right now offline.
Database is offline
System check finished
15:58:51   Successfully tuned new postgresql configuration.
15:58:51   Starting spacewalk services...
Starting spacewalk services...
Done.</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bp.chap.suma.backup"><a class="anchor" href="#bp.chap.suma.backup"></a><a class="link" href="#bp.chap.suma.backup">16. Backup and Restore</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Back up your  installation regularly, in order to prevent data loss.
Because  relies on a database as well as the installed program and configurations, it is important to back up all components of your installation.
This chapter contains information on the files you need to back up, and introduces the <code class="command">smdba</code> tool to manage database backups.
It also contains information about restoring from your backups in the case of a system failure.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
<div class="title">Backup Space Requirements</div>
<div class="paragraph">
<p>Regardless of the backup method you use, you must have available at least three times the amount of space your current installation uses.
Running out of space can result in backups failing, so check this often.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_backing_up"><a class="anchor" href="#_backing_up"></a><a class="link" href="#_backing_up">16.1. Backing up </a></h3>
<div class="paragraph">
<p>The most comprehensive method for backing up your  installation is to back up the relevant files and directories.
This can save you time in administering your backup, and can be faster to reinstall and re-synchronize in the case of failure.
However, this method requires significant disk space and could take a long time to perform the backup.</p>
</div>
<div class="paragraph">
<p>If you want to only back up the required files and directories, use this list:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To make this process simpler, and more comprehensive, we recommend backing up the entire <code class="path">/etc</code> and <code class="path">/root</code> directories, not just the ones specified here.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p><code class="path">/etc/cobbler/</code></p>
</li>
<li>
<p><code class="path">/etc/dhcp.conf</code></p>
</li>
<li>
<p><code class="path">/etc/fstab</code> and any ISO mountpoints you require.</p>
</li>
<li>
<p><code class="path">/etc/rhn/</code></p>
</li>
<li>
<p><code class="path">/etc/salt</code></p>
</li>
<li>
<p><code class="path">/etc/sudoers</code></p>
</li>
<li>
<p><code class="path">/etc/sysconfig/rhn/</code></p>
</li>
<li>
<p><code class="path">/root/.gnupg/</code></p>
</li>
<li>
<p><code class="path">/root/.ssh</code></p>
<div class="ulist">
<ul>
<li>
<p>This file exists if you are using an SSH tunnel or SSH <code class="command">push</code>. You will also need to have saved a copy of the <code>id-susemanager</code> key.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code class="path">/root/ssl-build/</code></p>
</li>
<li>
<p><code class="path">/srv/pillar</code></p>
</li>
<li>
<p><code class="path">/srv/salt</code></p>
</li>
<li>
<p><code class="path">/srv/tftpboot/</code></p>
</li>
<li>
<p><code class="path">/srv/www/cobbler</code></p>
</li>
<li>
<p><code class="path">/srv/www/htdocs/pub/</code></p>
</li>
<li>
<p><code class="path">/var/lib/cobbler/</code></p>
</li>
<li>
<p><code class="path">/var/lib/rhn/kickstarts/</code></p>
</li>
<li>
<p><code class="path">/var/spacewalk/</code></p>
</li>
<li>
<p>Any directories containing custom data (such as scripts, Kickstart profiles, AutoYaST, and custom RPMs).</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You will also need to back up your database, which you can do by copying <code class="path">/var/spacewalk/db-backup</code> or by using the <code class="command">smdba</code> tool, which is explained later in this chapter.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure: Restore from a Manual Backup</div>
<ol class="arabic">
<li>
<p>Re-install </p>
</li>
<li>
<p>Re-synchronize your installation with the <code class="command">mgr-sync</code> tool.</p>
</li>
<li>
<p>You can choose to re-register your product, or skip the registration and SSL certificate generation sections.</p>
</li>
<li>
<p>Re-install the <code class="path">/root/ssl-build/rhn-org-httpd-ssl-key-pair-MACHINE_NAME-VER-REL.noarch.rpm</code> package.</p>
</li>
<li>
<p>Schedule the re-creation of search indexes next time the <code class="command">rhn-search</code> service is started:</p>
<div class="listingblock">
<div class="content">
<pre>rcrhn-search cleanindex</pre>
</div>
</div>
</li>
<li>
<p>If you did not have <code class="path">/var/spacewalk/packages/</code> in your backup, but the source repository still exists, you can restore it by performing a complete channel synchronization.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="bp.sect.backup.smdba.admin"><a class="anchor" href="#bp.sect.backup.smdba.admin"></a><a class="link" href="#bp.sect.backup.smdba.admin">16.2. Administering the Database with smdba</a></h3>
<div class="paragraph">
<p>The <code class="command">smdba</code> tool is used for managing a local PostgreSQL database.
It allows you to back up and restore your database, and manage backups.
It can also be used to check the status of your database, and perform administration tasks, such as restarting.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code class="command">smdba</code> tool works with local PostgreSQL databases only, it will not work with remotely accessed databases, or Oracle databases.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code class="command">smdba</code> tool requires <code class="command">sudo</code> access, in order to execute system changes.
Ensure you have enabled <code class="command">sudo</code> access for the <code class="username">admin</code> user before you begin, by checking the <code class="path">/etc/sudoers</code> file for this line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>admin   ALL=(postgres) /usr/bin/smdba</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Check the runtime status of your database with the <code class="command">smdba db-status</code> command.
This command will return either <code>online</code> or <code>offline</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>smdba db-status
Checking database core...       online</pre>
</div>
</div>
<div class="paragraph">
<p>To check the full connection to the database, use the <code class="command">smdba db-check</code> command.
Depending on your environment, this command will report on the status of listeners, in addition to connectivity status.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>smdba db-check</pre>
</div>
</div>
<div class="paragraph">
<p>Starting and stopping the database can be performed with <code class="command">smdba db-start</code> and <code class="command">smdba db-stop</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre>smdba db-start
Starting core...       done</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>smdba db-stop
Stopping the SUSE Manager database...
Stopping core:         done</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bp.sect.backup.smdba.performbackup"><a class="anchor" href="#bp.sect.backup.smdba.performbackup"></a><a class="link" href="#bp.sect.backup.smdba.performbackup">16.3. Database Backup with smdba</a></h3>
<div class="paragraph">
<p>The <code class="command">smdba</code> tool performs a continuous archiving backup.
This backup method combines a log of every change made to the database during the current session, with a series of more traditional backup files.
When a crash occurs, the database state is first restored from the most recent backup file on disk, then the log of the current session is replayed exactly, to bring the database back to a current state.
A continuous archiving backup with <code class="command">smdba</code> is performed with the database running, so there is no need for downtime.</p>
</div>
<div class="paragraph">
<p>This method of backing up is stable and generally creates consistent snapshots, however it can take up a lot of storage space.
Ensure you have at least three times the current database size of space available for backups.
You can check your current database size by navigating to <code class="path">/var/lib/pgsql/</code> and running <code class="command">df -h</code>.</p>
</div>
<div class="paragraph">
<p>The <code class="command">smdba</code> tool also manages your archives, keeping only the most recent backup, and the current archive of logs.
The log files can only be a maximum file size of 16&#160;MB, so a new log file will be created once the files reach this size.
Every time you create a new backup, previous backups will be purged to release disk space.
We recommend you use <code class="command">cron</code> to schedule your <code class="command">smdba</code> backups to ensure that your storage is managed effectively, and you always have a backup ready in case of failure.</p>
</div>
<div class="sect3">
<h4 id="_performing_a_manual_database_backup"><a class="anchor" href="#_performing_a_manual_database_backup"></a><a class="link" href="#_performing_a_manual_database_backup">16.3.1. Performing a Manual Database Backup</a></h4>
<div class="paragraph">
<p>The <code class="command">smdba</code> tool can be run directly from the command line.
We recommend you run a manual database backup immediately after installation, or if you have made any significant changes to your configuration.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When <code class="command">smdba</code> is run for the first time, or if you have changed the location of the backup, it will need to restart your database before performing the archive.
This will result in a small amount of downtime.
Note that regular database backups will not require any downtime.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure: Performing a Manual Database Backup</div>
<ol class="arabic">
<li>
<p>Allocate permanent storage space for your backup. In this procedure, we will be using an NFS share located at <code class="path">/var/spacewalk/</code>.
This will become a permanent target for your backup, so ensure it will remain accessible by your server at all times.</p>
</li>
<li>
<p>In your backup location, create a directory for the backup:</p>
<div class="listingblock">
<div class="content">
<pre>sudo -u postgres mkdir /var/spacewalk/db-backup</pre>
</div>
</div>
<div class="paragraph">
<p>Or, as root:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>install -d -o postgres /var/spacewalk/db-backup</pre>
</div>
</div>
</li>
<li>
<p>Ensure you have the correct permissions set on the backup location:</p>
<div class="listingblock">
<div class="content">
<pre>chown postgres:postgres /var/spacewalk/db-backup</pre>
</div>
</div>
</li>
<li>
<p>To run a backup for the first time, run the <code class="command">smdba backup-hot</code> command with the <code class="command">enable</code> option set.
This will create the backup in the specified directory, and, if necessary, restart the database:</p>
<div class="listingblock">
<div class="content">
<pre>smdba backup-hot --enable=on --backup-dir=/var/spacewalk/db-backup</pre>
</div>
</div>
</li>
<li>
<p>Check that the backup files exist in the <code class="path">/mnt/backup/database</code> directory, to ensure that your backup has been successful.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="smdba.automatic.backup.with.cron"><a class="anchor" href="#smdba.automatic.backup.with.cron"></a><a class="link" href="#smdba.automatic.backup.with.cron">16.3.2. Scheduling Automatic Backups</a></h4>
<div class="paragraph">
<p>You do not need to shut down your system in order to perform a database backup with <code class="command">smdba</code>.
However, because it is a large operation, database performance can slow down while the backup is running.
We recommend you schedule regular database backups for a low-traffic period, to minimize disruption.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Ensure you have at least three times the current database size of space available for backups.
You can check your current database size by navigating to <code class="path">/var/lib/pgsql/</code> and running <code class="command">df -h</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure: Scheduling Automatic Backups</div>
<ol class="arabic">
<li>
<p>Create a directory for the backup, and set the appropriate permissions:</p>
<div class="listingblock">
<div class="content">
<pre># mkdir /var/spacewalk/db-backup
# chown -R postgres:postgres /var/spacewalk/db-backup
# chmod 700 /var/spacewalk/db-backup</pre>
</div>
</div>
</li>
<li>
<p>Open <code class="path">/etc/cron.d/db-backup-mgr</code>, or create it if it doesn&#8217;t exist, and add the following line to create the cron job:</p>
<div class="listingblock">
<div class="content">
<pre>0 2 * * * root /usr/bin/smdba backup-hot --enable=on --backup-dir=/var/spacewalk/db-backup</pre>
</div>
</div>
</li>
<li>
<p>Check the backup directory regularly to ensure the backups are working as expected.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bp.sect.backup.smdba.restore"><a class="anchor" href="#bp.sect.backup.smdba.restore"></a><a class="link" href="#bp.sect.backup.smdba.restore">16.4. Restoring from Backup</a></h3>
<div class="paragraph">
<p>The <code class="command">smdba</code> tool can be used to restore from backup in the case of failure.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: Restoring from Backup</div>
<ol class="arabic">
<li>
<p>Shutdown the database:</p>
<div class="listingblock">
<div class="content">
<pre>smdba db-stop</pre>
</div>
</div>
</li>
<li>
<p>Start the restore process and wait for it to complete:</p>
<div class="listingblock">
<div class="content">
<pre>smdba backup-restore start</pre>
</div>
</div>
</li>
<li>
<p>Restart the database:</p>
<div class="listingblock">
<div class="content">
<pre>smdba db-start</pre>
</div>
</div>
</li>
<li>
<p>Check if there are differences between the RPMs and the database.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>spacewalk-data-fsck</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="config-smdb.archivelog"><a class="anchor" href="#config-smdb.archivelog"></a><a class="link" href="#config-smdb.archivelog">16.5. Archive Log Settings</a></h3>
<div class="paragraph">
<p>In SUSE Manager
with an embedded database, archive logging is enabled by default.
This feature allows the database management tool <code class="command">smdba</code> to perform hot backups.</p>
</div>
<div class="paragraph">
<p>With archive log enabled, even more data is stored on the hard disk:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Postgresql maintains a limited number of archive logs. Using the default configuration, approx. 64 files with a size of 16 MiB are stored.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Creating a user and syncing the channels:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SLES12-SP2-Pool-x86_64</p>
</li>
<li>
<p>SLES12-SP2-Updates-x86_64</p>
</li>
<li>
<p>SLE-Manager-Tools12-Pool-x86_64-SP2</p>
</li>
<li>
<p>SLE-Manager-Tools12-Updates-x86_64-SP2</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Postgresql will generate an additional ~1 GB of data.
So it is important to think about a backup strategy and create a backups in a regular way.</p>
</div>
<div class="paragraph">
<p>Archive logs are stored at:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code class="path">/var/lib/pgsql/data/pg_xlog/</code> (postgresql)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="config-smdb.spaces"><a class="anchor" href="#config-smdb.spaces"></a><a class="link" href="#config-smdb.spaces">16.6. Retrieving an Overview of Occupied Database Space</a></h3>
<div class="paragraph">
<p>Database administrators may use the subcommand <code class="command">space-overview</code> to get a report about occupied table spaces, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>smdba space-overview
SUSE Manager Database Control. Version 1.5.2
Copyright (c) 2012 by SUSE Linux Products GmbH


Tablespace  | Size (Mb) | Avail (Mb) | Use %
------------+-----------+------------+------
postgres    | 7         | 49168      | 0.013
susemanager | 776       | 48399      | 1.602</pre>
</div>
</div>
<div class="paragraph">
<p>The following command is available for Postgresql.
For a more detailed report, use the <code class="command">space-tables</code> subcommand.
It lists the table and its size, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>smdba space-tables
SUSE Manager Database Control. Version 1.5.2
Copyright (c) 2012 by SUSE Linux Products GmbH


Table                                 | Size
--------------------------------------+-----------
public.all_primary_keys               | 0 bytes
public.all_tab_columns                | 0 bytes
public.allserverkeywordsincereboot    | 0 bytes
public.dblink_pkey_results            | 0 bytes
public.dual                           | 8192 bytes
public.evr_t                          | 0 bytes
public.log                            | 32 kB
...</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_moving_the_database"><a class="anchor" href="#_moving_the_database"></a><a class="link" href="#_moving_the_database">16.7. Moving the Database</a></h3>
<div class="paragraph">
<p>It is possible to move the database to another location.
For example if your database storage space is running low.
The following procedure will guide you through moving the database to a new location for use by SUSE Manager.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: Moving the Database</div>
<ol class="arabic">
<li>
<p>The default storage location for SUSE Manager is: <code class="path">/var/lib/pgsql/</code> . You would like to move it, for example to: <code class="path">/storage/postgres/</code> . To begin, stop the running database with:</p>
<div class="listingblock">
<div class="content">
<pre># rcpostgresql stop</pre>
</div>
</div>
<div class="paragraph">
<p>Shutdown running spacewalk services with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># spacewalk-service stop</pre>
</div>
</div>
</li>
<li>
<p>Copy the current working directory structure with the following syntax:</p>
<div class="listingblock">
<div class="content">
<pre>cp [OPTION]... SOURCE... DIRECTORY</pre>
</div>
</div>
<div class="paragraph">
<p>using the <code class="option">-a, --archive</code> option.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># cp -ar /var/lib/pgsql/ /storage/postgres/</pre>
</div>
</div>
<div class="paragraph">
<p>This command will copy the contents of <code class="path">/var/lib/pgsql/</code>
to <code class="path">/storage/postgres/pgsql/</code>
.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
The contents of the /var/lib/pgsql needs to remain the same or the SUSE Manager database may malfunction.
You also should ensure there is enough available disk space.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Mount the new database directory with:</p>
<div class="listingblock">
<div class="content">
<pre># mount /storage/postgres/pgsql</pre>
</div>
</div>
</li>
<li>
<p>Make sure ownership is <code>postgres:postgres</code> and not <code>root:root</code> by changing to the new directory and running the following command:</p>
<div class="listingblock">
<div class="content">
<pre>/var/lib/pgsql/ # cd /storage/postgres/pgsql/
/storage/postgres/pgsql/ # l
total 8
drwxr-x---  4 postgres postgres   47 Jun  2 14:35 ./</pre>
</div>
</div>
</li>
<li>
<p>Add the new database mount location to your servers fstab by editing  <code class="path">etc/fstab</code> .</p>
</li>
<li>
<p>Start the database with:</p>
<div class="listingblock">
<div class="content">
<pre># rcpostgresql start</pre>
</div>
</div>
<div class="paragraph">
<p>Start spacewalk-services with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># spacewalk-service start</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_recovering_from_a_crashed_root_partition"><a class="anchor" href="#_recovering_from_a_crashed_root_partition"></a><a class="link" href="#_recovering_from_a_crashed_root_partition">16.8. Recovering from a Crashed Root Partition</a></h3>
<div class="paragraph">
<p>This section provides guidance on restoring your server after its root partition has crashed.
This section assumes you have setup your server similar to the procedure explained in Getting Started guide with separate partitions for the database and for channels mounted at <code class="path">/var/lib/pgsql</code>
 and <code class="path">/var/spacewalk/</code>
.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: Recovering from a Crashed Root Partition</div>
<ol class="arabic">
<li>
<p>Start by installing SLES12 SP2 and the SUSE Manager Extension. Do not mount the <code class="path">/var/spacewalk</code> and <code class="path">/var/lib/pgsql</code> partitions.</p>
</li>
<li>
<p>Once installation of SUSE Manager has completed shutdown services with <code class="command">spacewalk-service shutdown</code> and the database with <code class="command">rcpostgresql stop</code>.</p>
</li>
<li>
<p>Mount your <code class="path">/var/spacewalk</code> and <code class="path">/var/lib/pgsql</code> partitions and restore the directories listed in section one.</p>
</li>
<li>
<p>Start SUSE Manager services and the database with <code class="command">spacewalk-services start</code> and <code class="command">rcpostgresql start</code></p>
</li>
<li>
<p>SUSE Manager should now operate normally without loss of your database or synced channels.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_database_connection_information"><a class="anchor" href="#_database_connection_information"></a><a class="link" href="#_database_connection_information">16.9. Database Connection Information</a></h3>
<div class="paragraph">
<p>The information for connecting to the SUSE Manager database is located in <code class="path">/etc/rhn/rhn.conf</code>
:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>db_backend = postgresql
db_user = susemanager
db_password = susemanager
db_name = susemanager
db_host = localhost
db_port = 5432
db_ssl_enabled =</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bp.authentication.with.pam.and.ad"><a class="anchor" href="#bp.authentication.with.pam.and.ad"></a><a class="link" href="#bp.authentication.with.pam.and.ad">17. Authentication Methods</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_authentication_via_pam"><a class="anchor" href="#_authentication_via_pam"></a><a class="link" href="#_authentication_via_pam">17.1. Authentication Via PAM</a></h3>
<div class="paragraph">
<p>As security measures become increasingly complex, SUSE Manager supports network-based authentication systems via Pluggable Authentication Modules (PAM). PAM is a suite of libraries that allows to integrate SUSE Manager with a centralized authentication mechanism, thus eliminating the need to remember multiple passwords.
SUSE Manager supports LDAP, Kerberos, and other network-based authentication systems via PAM.
To enable SUSE Manager to use PAM in your organization&#8217;s authentication infrastructure, follow the steps below.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set up a PAM service file (default location: <code class="path">/etc/pam.d/susemanager</code> ) then enforce its use by adding the following line to <code class="path">/etc/rhn/rhn.conf</code> :</p>
<div class="listingblock">
<div class="content">
<pre>pam_auth_service = susemanager</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
This assumes the PAM service file is named susemanager.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>To enable a new or existing user to authenticate with PAM, proceed to the <b class="menuref">Create User</b> page and select the checkbox labeled Pluggable Authentication Modules (PAM) positioned below the password and password confirmation fields.</p>
</li>
<li>
<p>To authenticate a SLES system against Kerberos add the following lines to <code class="path">/etc/pam.d/susemanager</code> :</p>
<div class="listingblock">
<div class="content">
<pre>#%PAM-1.0
 auth     include        common-auth
 account  include        common-account
 password include        common-password
 session  include        common-session</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
To register a Red Hat Enterprise Linux System against Kerberos add the following lines to <code class="path">/etc/pam.d/susemanager</code>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>#%PAM-1.0
 auth        required      pam_env.so
 auth        sufficient    pam_krb5.so no_user_check
 auth        required      pam_deny.so
 account     required      pam_krb5.so no_user_check</pre>
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>YaST can now be used to configure PAM, when packages such as yast2-ldap-client and yast2-kerberos-client are installed; for detailed information on configuring PAM, see the SUSE Linux Enterprise Server Security Guide <a href="https://www.suse.com/documentation/sles-12/book_security/data/part_auth.html" class="bare">https://www.suse.com/documentation/sles-12/book_security/data/part_auth.html</a>. This example is not limited to Kerberos; it is generic and uses the current server configuration. Note that only network based authentication services are supported.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
<div class="title">Changing Passwords</div>
Changing the password on the SUSE Manager Web interface changes only the local password on the SUSE Manager server.
But this password may not be used at all if PAM is enabled for that user.
In the above example, for instance, the Kerberos password will not be changed.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_authentication_via_edirectory_and_pam"><a class="anchor" href="#_authentication_via_edirectory_and_pam"></a><a class="link" href="#_authentication_via_edirectory_and_pam">17.2. Authentication Via eDirectory and PAM</a></h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>First check to ensure eDirectory authentication is working with your current OS for example:</p>
<div class="listingblock">
<div class="content">
<pre>#getent passwd</pre>
</div>
</div>
</li>
<li>
<p>If users are returned from eDirectory then create the following file:</p>
<div class="listingblock">
<div class="content">
<pre># cat /etc/pam.d/susemanager</pre>
</div>
</div>
</li>
<li>
<p>And add the following content:</p>
<div class="listingblock">
<div class="content">
<pre>#%PAM-1.0
 auth     include        common-auth
 account  include        common-account
 password include        common-password
 session  include        common-session
 #</pre>
</div>
</div>
</li>
<li>
<p>Finally add the following lines to the  conf file:</p>
<div class="listingblock">
<div class="content">
<pre># grep -i pam /etc/rhn/rhn.conf
 pam_auth_service = susemanager</pre>
</div>
</div>
</li>
<li>
<p>You may now create users with the same id that appears on eDirectory and mark the Use PAM check-box from the SUSE Manager WebUI.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_example_quest_vas_active_directory_authentication_template"><a class="anchor" href="#_example_quest_vas_active_directory_authentication_template"></a><a class="link" href="#_example_quest_vas_active_directory_authentication_template">17.3. Example Quest VAS Active Directory Authentication Template</a></h3>
<div class="paragraph">
<p>If you are using Quest VAS for active directory authentication, you can use the following <code class="path">/etc/pam.d/susemanager</code>
 file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>#%PAM-1.0
auth       required       pam_env.so
auth       sufficient     pam_vas3.so no_user_check
auth       requisite      pam_vas3.so echo_return
auth       required       pam_deny.so
account    required       pam_vas3.so no_user_check</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bp.chap.bring.your.own.cert"><a class="anchor" href="#bp.chap.bring.your.own.cert"></a><a class="link" href="#bp.chap.bring.your.own.cert">18. Using a Custom SSL Certificate</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following section will guide you through using a custom certificate with  3.2
and SUSE Manager Proxy 3.2
.</p>
</div>
<div class="sect2">
<h3 id="bp.cert.custom.req"><a class="anchor" href="#bp.cert.custom.req"></a><a class="link" href="#bp.cert.custom.req">18.1. Prerequisites</a></h3>
<div class="paragraph">
<p>The following list provides requirements for using a custom certificate.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A Certificate Authority (CA) SSL public certificate file</p>
</li>
<li>
<p>A Web server SSL private key file</p>
</li>
<li>
<p>A Web server SSL public certificate file</p>
</li>
<li>
<p>Key and Certificate files must be in PEM format</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
<div class="title">Hostname and SSL Keys</div>
<div class="paragraph">
<p>The hostname of the web server&#8217;s SSL keys and relevant certificate files must match the hostname of the machine which they will be deployed on.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title=":bulb:"></i>
</td>
<td class="content">
<div class="title">Intermediate Certificates</div>
<div class="paragraph">
<p>In case you want to use CAs with intermediate certificates, merge the intermediate and root CA certificates into one file.
It is important that the intermediate certificate comes first within the combined file.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="bp.cert.custom.setup"><a class="anchor" href="#bp.cert.custom.setup"></a><a class="link" href="#bp.cert.custom.setup">18.2. Setup</a></h3>
<div class="paragraph">
<p>After completing YaST
firstboot procedures, export your current environment variables and point them to the correct SSL files to be imported.
Running these commands will make the default certificate obsolete after executing the <code class="command">yast2 susemanagersetup</code> command.
For more information on YaST
 firstboot, see <a href="https://www.suse.com/documentation/suse-manager-3/singlehtml/suse_manager21/book_susemanager_install/book_susemanager_install.html#sec.manager.inst.setup" class="bare">https://www.suse.com/documentation/suse-manager-3/singlehtml/suse_manager21/book_susemanager_install/book_susemanager_install.html#sec.manager.inst.setup</a>.</p>
</div>
<div id="bp.cert.custom.setup.proc.export" class="olist arabic">
<ol class="arabic">
<li>
<p>Export the environment variables and point to the SSL files to be imported:</p>
<div class="listingblock">
<div class="content">
<pre>export CA_CERT=`path_to_CA_certificate_file`export SERVER_KEY=`path_to_web_server_key`export SERVER_CERT=`path_to_web_server_certificate`</pre>
</div>
</div>
</li>
<li>
<p>Execute  setup with</p>
<div class="listingblock">
<div class="content">
<pre>yast2 susemanagersetup</pre>
</div>
</div>
<div class="paragraph">
<p>Proceed with the default setup.
Upon reaching the Certificate Setup window during YaST
installation, fill in random values, as these will be overridden with the values specified in <a href="#bp.cert.custom.setup.proc.export">[bp.cert.custom.setup.proc.export]</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
<div class="title">Shell Requirements</div>
Make sure that you execute <code class="command">yast2
      susemanagersetup</code> from within the same shell the environment variables were exported from.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="bp.cert.custom.proxy"><a class="anchor" href="#bp.cert.custom.proxy"></a><a class="link" href="#bp.cert.custom.proxy">18.3. Using a Custom Certificate with SUSE Manager Proxy</a></h3>
<div class="paragraph">
<p>After completing the installation with yast found in <a href="#advanced.topics.proxy.quickstart">[advanced.topics.proxy.quickstart]</a> continue with a modified <a href="#at.manager.proxy.run.confproxy">[at.manager.proxy.run.confproxy]</a> procedure:</p>
</div>
<div id="bp.cert.custom.proxy.proc" class="olist arabic">
<ol class="arabic">
<li>
<p>Execute <code class="command">configure-proxy.sh</code>.</p>
</li>
<li>
<p>When prompted with:</p>
<div class="listingblock">
<div class="content">
<pre>Do you want to import existing certificates?</pre>
</div>
</div>
<div class="paragraph">
<p>Answer with <kbd>y</kbd>
.</p>
</div>
</li>
<li>
<p>Continue by following the script prompts.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bp.chapt.suma3.troubleshooting"><a class="anchor" href="#bp.chapt.suma3.troubleshooting"></a><a class="link" href="#bp.chapt.suma3.troubleshooting">19. Troubleshooting</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter provides guidance on registering cloned systems with SUSE Manager.
This includes both Salt and Traditional clients.
For more information, see <a href="https://www.novell.com/support/kb/doc.php?id=7012170" class="bare">https://www.novell.com/support/kb/doc.php?id=7012170</a>.</p>
</div>
<div class="sect2">
<h3 id="bp.chapt.suma3.troubleshooting.registering.cloned.salt.systems"><a class="anchor" href="#bp.chapt.suma3.troubleshooting.registering.cloned.salt.systems"></a><a class="link" href="#bp.chapt.suma3.troubleshooting.registering.cloned.salt.systems">19.1. Registering Cloned Salt Minions</a></h3>
<div class="olist arabic">
<div class="title">Procedure: Registering a Cloned Salt Minion with SUSE Manager</div>
<ol class="arabic">
<li>
<p>Clone your system (for example using the existing cloning mechanism of your favorite Hypervisor)</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
<div class="title">Quick Tips</div>
Each step in this section is performed on the cloned system, this procedure does not manipulate the original system, which will still be registered to SUSE Manager.
The cloned virtual machine should have a different UUID from the original (this UUID is generated by your hypervisor) or SUSE Manager will overwrite the original system data with the new one.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Make sure your machines have different hostnames and IP addresses, also check that /etc/hosts contains the changes you made and the correct host entries.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The next step you take will depend on the Operating System of the clone.</p>
</div>
<div class="paragraph">
<p>The following scenario can occur after on-boarding cloned Salt minions.
If after accepting all cloned minion keys from the onboarding page and you see only one minion on the System Overview page, this is likely due to these machines being clones of the original and using a duplicate machine-id.
Perform the following steps to resolve this conflict based on OS.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: SLES 12 Registering Salt Clones</div>
<ol class="arabic">
<li>
<p>SLES 12: If your machines have the same machine ids then delete the file on each minion and recreate it:</p>
<div class="listingblock">
<div class="content">
<pre># rm /etc/machine-id
# rm /var/lib/dbus/machine-id
# dbus-uuidgen --ensure
# systemd-machine-id-setup</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Procedure: SLES 11 Registering Salt Clones</div>
<ol class="arabic">
<li>
<p>SLES 11: As there is no systemd machine id, generate one from dbus:</p>
<div class="listingblock">
<div class="content">
<pre># rm /var/lib/dbus/machine-id
# dbus-uuidgen --ensure</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>If your machines still have the same minion id then delete the minion_id file on each minion (FQDN will be used when it is regenerated on minion restart):</p>
</div>
<div class="listingblock">
<div class="content">
<pre># rm /etc/salt/minion_id</pre>
</div>
</div>
<div class="paragraph">
<p>Finally delete accepted keys from Onboarding page and system profile from SUSE Manager, and restart the minion with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># systemctl restart salt-minion</pre>
</div>
</div>
<div class="paragraph">
<p>You should be able to re-register them again, but each minion will use a different '/etc/machine-id' and should now be correctly displayed on the System Overview page.</p>
</div>
</div>
<div class="sect2">
<h3 id="bp.chapt.suma3.troubleshooting.registering.cloned.traditional.systems"><a class="anchor" href="#bp.chapt.suma3.troubleshooting.registering.cloned.traditional.systems"></a><a class="link" href="#bp.chapt.suma3.troubleshooting.registering.cloned.traditional.systems">19.2. Registering Cloned Traditional Systems</a></h3>
<div class="paragraph">
<p>This section provides guidance on troubleshooting cloned traditional systems registered via bootstrap.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: Registering a Cloned System with SUSE Manager (Traditional Systems)</div>
<ol class="arabic">
<li>
<p>Clone your system (using your favorite hypervisor.)</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
<div class="title">Quick Tips</div>
Each step in this section is performed on the cloned system, this procedure does not manipulate the original system, which will still be registered to SUSE Manager.
The cloned virtual machine should have a different UUID from the original (this UUID is generated by your hypervisor) or SUSE Manager will overwrite the original system data with the new one.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Change the Hostname and IP addresses, also make sure /etc/hosts contains the changes you made and the correct host entries.</p>
</li>
<li>
<p>Stop rhnsd daemon with:</p>
<div class="listingblock">
<div class="content">
<pre># /etc/init.d/rhnsd stop</pre>
</div>
</div>
<div class="paragraph">
<p>or alternativly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># rcrhnsd stop</pre>
</div>
</div>
</li>
<li>
<p>Stop osad with:</p>
<div class="listingblock">
<div class="content">
<pre># /etc/init.d/osad stop</pre>
</div>
</div>
<div class="paragraph">
<p>or alternativly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># rcosad stop</pre>
</div>
</div>
</li>
<li>
<p>Remove the osad authentifcation configuration file and the systemid with:</p>
<div class="listingblock">
<div class="content">
<pre># rm -f /etc/sysconfig/rhn/{osad-auth.conf,systemid}</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The next step you take will depend on the Operating System of the clone.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: SLES 12 Registering A Cloned Traditional System</div>
<ol class="arabic">
<li>
<p></p>
<div class="paragraph">
<p>If your machines have the same machine ids then delete the file on each client and recreate it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># rm /etc/machine-id
# rm /var/lib/dbus/machine-id
# dbus-uuidgen --ensure
# systemd-machine-id-setup</pre>
</div>
</div>
</li>
<li>
<p>Remove the following credential files:</p>
<div class="listingblock">
<div class="content">
<pre># rm  -f /etc/zypp/credentials.d/{SCCcredentials,NCCcredentials}</pre>
</div>
</div>
</li>
<li>
<p>Re-run the bootstrap script. You should now see the cloned system in SUSE Manager without overwriting the system it was cloned from.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Procedure: SLES 11 Registering A Cloned Traditional System</div>
<ol class="arabic">
<li>
<p>Continued from section 1 step 5:</p>
<div class="listingblock">
<div class="content">
<pre># suse_register -E</pre>
</div>
</div>
<div class="paragraph">
<p>(--erase-local-regdata, Erase all local files created from a previous executed registration.
This option make the system look like never registered)</p>
</div>
</li>
<li>
<p>Re-run the bootstrap script. You should now see the cloned system in SUSE Manager without overwriting the system it was cloned from.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Procedure: SLES 10 Registering A Cloned Traditional System</div>
<ol class="arabic">
<li>
<p>Continued from section 1 step 5:</p>
<div class="listingblock">
<div class="content">
<pre># rm -rf /etc/{zmd,zypp}</pre>
</div>
</div>
</li>
<li>
<p></p>
<div class="listingblock">
<div class="content">
<pre># ¡¡¡¡¡ everthing in /var/lib/zypp/ except /var/lib/zypp/db/products/ !!!!!
# check whether this command works for you
# rm -rf /var/lib/zypp/!(db)</pre>
</div>
</div>
</li>
<li>
<p></p>
<div class="listingblock">
<div class="content">
<pre># rm -rf /var/lib/zmd/</pre>
</div>
</div>
</li>
<li>
<p>Re-run the bootstrap script. You should now see the cloned system in SUSE Manager without overwriting the system it was cloned from.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Procedure: RHEL 5,6 and 7</div>
<ol class="arabic">
<li>
<p>Continued from section 1 step 5:</p>
<div class="listingblock">
<div class="content">
<pre># rm  -f /etc/NCCcredentials</pre>
</div>
</div>
</li>
<li>
<p>Re-run the bootstrap script. You should now see the cloned system in SUSE Manager without overwriting the system it was cloned from.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="bp.chapt.suma3.troubleshooting.osad.jabberd"><a class="anchor" href="#bp.chapt.suma3.troubleshooting.osad.jabberd"></a><a class="link" href="#bp.chapt.suma3.troubleshooting.osad.jabberd">19.3. Typical OSAD/jabberd Challenges</a></h3>
<div class="paragraph">
<p>This section provides answers for typical issues regarding OSAD and jabberd.</p>
</div>
<div class="sect3">
<h4 id="_open_file_count_exceeded"><a class="anchor" href="#_open_file_count_exceeded"></a><a class="link" href="#_open_file_count_exceeded">19.3.1. Open File Count Exceeded</a></h4>
<div class="paragraph">
<p><code>SYMPTOMS</code>: OSAD clients cannot contact the SUSE Manager Server, and jabberd requires long periods of time to respond on port 5222.</p>
</div>
<div class="paragraph">
<p><code>CAUSE</code>: The number of maximum files that a jabber user can open is lower than the number of connected clients.
Each client requires one permanently open TCP connection and each connection requires one file handler.
The result is jabberd begins to queue and refuse connections.</p>
</div>
<div class="paragraph">
<p><code>CURE</code>: Edit the <code class="path">/etc/security/limits.conf</code>
 to something similar to the following: <code>jabbersoftnofile&lt;#clients + 100&gt;
    jabberhardnofile&lt;#clients + 1000&gt;</code></p>
</div>
<div class="paragraph">
<p>This will vary according to your setup.
For example in the case of 5000 clients: <code>jabbersoftnofile5100 jabberhardnofile6000</code></p>
</div>
<div class="paragraph">
<p>Ensure you update the <code class="path">/etc/jabberd/c2s.xml</code>
 max_fds parameter as well.
For example: <code>&lt;max_fds&gt;6000&lt;/max_fds&gt;</code></p>
</div>
<div class="paragraph">
<p><code>EXPLANATION</code>: The soft file limit is the limit of the maximum number of open files for a single process.
In SUSE Manager the highest consuming process is c2s, which opens a connection per client.
100 additional files are added, here, to accommodate for any non-connection file that c2s requires to work correctly.
The hard limit applies to all processes belonging to the jabber user, and accounts for open files from the router, s2s and sm processes additionally.</p>
</div>
</div>
<div class="sect3">
<h4 id="_jabberd_database_corruption"><a class="anchor" href="#_jabberd_database_corruption"></a><a class="link" href="#_jabberd_database_corruption">19.3.2. jabberd Database Corruption</a></h4>
<div class="paragraph">
<p><code>SYMPTOMS</code>: After a disk is full error or a disk crash event, the jabberd database may have become corrupted.
jabberd may then fail to start during spacewalk-service start:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Starting spacewalk services...
   Initializing jabberd processes...
       Starting router                                                                   done
       Starting sm startproc:  exit status of parent of /usr/bin/sm: 2                   failed
   Terminating jabberd processes...</pre>
</div>
</div>
<div class="paragraph">
<p>/var/log/messages shows more details:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>jabberd/sm[31445]: starting up
jabberd/sm[31445]: process id is 31445, written to /var/lib/jabberd/pid/sm.pid
jabberd/sm[31445]: loading 'db' storage module
jabberd/sm[31445]: db: corruption detected! close all jabberd processes and run db_recover
jabberd/router[31437]: shutting down</pre>
</div>
</div>
<div class="paragraph">
<p><code>CURE</code>: Remove the jabberd database and restart.
Jabberd will automatically re-create the database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>spacewalk-service stop
 rm -Rf /var/lib/jabberd/db/*
 spacewalk-service start</pre>
</div>
</div>
<div class="paragraph">
<p>An alternative approach would be to test another database, but SUSE Manager does not deliver drivers for this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>rcosa-dispatcher stop
 rcjabberd stop
 cd /var/lib/jabberd/db
 rm *
 cp /usr/share/doc/packages/jabberd/db-setup.sqlite .
 sqlite3 sqlite.db &lt; db-setup.sqlite
 chown jabber:jabber *
 rcjabberd start
 rcosa-dispatcher start</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_capturing_xmpp_network_data_for_debugging_purposes"><a class="anchor" href="#_capturing_xmpp_network_data_for_debugging_purposes"></a><a class="link" href="#_capturing_xmpp_network_data_for_debugging_purposes">19.3.3. Capturing XMPP Network Data for Debugging Purposes</a></h4>
<div class="paragraph">
<p>If you are experiencing bugs regarding OSAD, it can be useful to dump network messages in order to help with debugging.
The following procedures provide information on capturing data from both the client and server side.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: Server Side Capture</div>
<ol class="arabic">
<li>
<p>Install the <span class="package">tcpdump</span> package on the SUSE Manager Server as root: <code class="command">zypper in tcpdump </code></p>
</li>
<li>
<p>Stop the OSA dispatcher and Jabber processes with <code class="command">rcosa-dispatcher stop</code> and <code class="command">rcjabberd stop.</code></p>
</li>
<li>
<p>Start data capture on port 5222: <code class="command">tcpdump -s 0 port 5222 -w server_dump.pcap</code></p>
</li>
<li>
<p>Start the OSA dispatcher and Jabber processes: <code class="command">rcosa-dispatcher start</code> and <code class="command">rcjabberd start</code>.</p>
</li>
<li>
<p>Open a second terminal and execute the following commands: <code class="command">rcosa-dispatcher start</code> and <code class="command">rcjabberd start</code>.</p>
</li>
<li>
<p>Operate the SUSE Manager server and clients so the bug you formerly experienced is reproduced.</p>
</li>
<li>
<p>Once you have finished your capture re-open terminal 1 and stop the capture of data with: <span class="keyseq"><kbd>CTRL</kbd>+<kbd>c</kbd></span></p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Procedure: Client Side Capture</div>
<ol class="arabic">
<li>
<p>Install the tcpdump package on your client as root: <code class="command">zypper in tcpdump</code></p>
</li>
<li>
<p>Stop the OSA process: <code class="command">rcosad stop</code>.</p>
</li>
<li>
<p>Begin data capture on port 5222: <code class="command">tcpdump -s 0 port 5222 -w client_client_dump.pcap</code></p>
</li>
<li>
<p>Open a second terminal and start the OSA process: <code class="command">rcosad start</code></p>
</li>
<li>
<p>Operate the SUSE Manager server and clients so the bug you formerly experienced is reproduced.</p>
</li>
<li>
<p>Once you have finished your capture re-open terminal 1 and stop the capture of data with: <span class="keyseq"><kbd>CTRL</kbd>+<kbd>c</kbd></span></p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_engineering_notes_analyzing_captured_data"><a class="anchor" href="#_engineering_notes_analyzing_captured_data"></a><a class="link" href="#_engineering_notes_analyzing_captured_data">19.3.4. Engineering Notes: Analyzing Captured Data</a></h4>
<div class="paragraph">
<p>This section provides information on analyzing the previously captured data from client and server.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Obtain the certificate file from your SUSE Manager server: /etc/pki/spacewalk/jabberd/server.pem</p>
</li>
<li>
<p>Edit the certificate file removing all lines before <code>----BEGIN RSA PRIVATE KEY-----</code>, save it as key.pem</p>
</li>
<li>
<p>Install Wireshark as root with: <code class="command">zypper in wireshark</code></p>
</li>
<li>
<p>Open the captured file in wireshark.</p>
</li>
<li>
<p>From <span class="menuseq"><b class="menu">Eidt</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">]menu:Preferences[</b></span> select SSL from the left pane.</p>
</li>
<li>
<p>Select RSA keys list: <span class="menuseq"><b class="menu">Edit</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">]menu:New[</b></span></p>
<div class="ulist">
<ul>
<li>
<p>IP Address any</p>
</li>
<li>
<p>Port: 5222</p>
</li>
<li>
<p>Protocol: xmpp</p>
</li>
<li>
<p>Key File: open the key.pem file previously edited.</p>
</li>
<li>
<p>Password: leave blank</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information see also:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://wiki.wireshark.org/SSL" class="bare">https://wiki.wireshark.org/SSL</a></p>
</li>
<li>
<p><a href="https://bugs.wireshark.org/bugzilla/show_bug.cgi?id=3444" class="bare">https://bugs.wireshark.org/bugzilla/show_bug.cgi?id=3444</a></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bp.troubleshooting.timeouts"><a class="anchor" href="#bp.troubleshooting.timeouts"></a><a class="link" href="#bp.troubleshooting.timeouts">19.4. RPC Connection Timeout Settings</a></h3>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph">
<p>RPC connection timeouts are configurable on the  server, SUSE Manager Proxy server, and the clients.
For example, if package downloads take longer then expected, you can increase timeout values. <code class="command">spacewalk-proxy restart</code> should be run after the setting is added or modified.</p>
</div>
<div class="paragraph">
<p>Set the following variables to a value in seconds specifying how long an RPC connection may take at maximum:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Server {mdash}<code class="path">/etc/rhn/rhn.conf</code> </dt>
<dd>
<div class="listingblock">
<div class="content">
<pre>server.timeout =`number`</pre>
</div>
</div>
</dd>
<dt class="hdlist1">Proxy Server {mdash}<code class="path">/etc/rhn/rhn.conf</code> </dt>
<dd>
<div class="listingblock">
<div class="content">
<pre>proxy.timeout =`number`</pre>
</div>
</div>
</dd>
<dt class="hdlist1">SUSE Linux Enterprise Server Clients (using <span class="package">zypp-plugin-spacewalk</span> ) {mdash}<code class="path">/etc/zypp/zypp.conf</code> </dt>
<dd>
<div class="listingblock">
<div class="content">
<pre>## Valid values:  [0,3600]
## Default value: 180
download.transfer_timeout = 180</pre>
</div>
</div>
<div class="paragraph">
<p>This is the maximum time in seconds that a transfer operation is allowed to take.
This is useful for preventing batch jobs from hanging for hours due to slow networks or links going down.
If limiting operations to less than a few minutes, you risk aborting perfectly normal operations.</p>
</div>
</dd>
<dt class="hdlist1">Red Hat Enterprise Linux Clients (using <span class="package">yum-rhn-plugin</span> ) {mdash}<code class="path">/etc/yum.conf</code> </dt>
<dd>
<div class="listingblock">
<div class="content">
<pre>timeout =`number`</pre>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="bp.troubleshooting.package.inconsistency"><a class="anchor" href="#bp.troubleshooting.package.inconsistency"></a><a class="link" href="#bp.troubleshooting.package.inconsistency">19.5. Client/Server Package Inconsistency</a></h3>
<div class="paragraph">
<p>In some cases, updates are available in the web interface, but not appearing on the client.
If you schedule an update on the client, it will fail with an error stating that no updates are available.
This can be caused by a metadata regeneration problem, or because update packages have been locked.</p>
</div>
<div class="paragraph">
<p>The notice that updates are available will appear immediately, but new metadata is only generated on the server after synchronizing.
In this case, an inconsistency can occur if taskomatic crashes, or because taskomatic is still running and creating new metadata.</p>
</div>
<div class="paragraph">
<p>To address this issue, check the <code class="path">/var/log/rhn/rhn_taskomatic_daemon.log</code> file to determine if any processess are still running, or an exception which could indicate a crash.
In the case of a crash, restart taskomatic.</p>
</div>
<div class="paragraph">
<p>Check package locks and exclude lists to determine if packages are locked or excluded on the client:</p>
</div>
<div class="paragraph">
<p>On Expanded Support Platform, check <code class="path">/etc/yum.conf</code> and search for <code>exclude=</code>.</p>
</div>
<div class="paragraph">
<p>On SUSE Linux Enterprise Server, use the <code class="command">zypper locks</code> command.</p>
</div>
</div>
<div class="sect2">
<h3 id="bp.troubleshooting.Corrupt.Repo.Data"><a class="anchor" href="#bp.troubleshooting.Corrupt.Repo.Data"></a><a class="link" href="#bp.troubleshooting.Corrupt.Repo.Data">19.6. Corrupted Repository Data</a></h3>
<div class="paragraph">
<p>If the information in <code class="path">/var/cache/rhn/repodata/sles12-sp3-updates-x86_64</code> becomes out of date, it will cause problems with updating the server.
The repository data file can be regenerated using the <code class="command">spacemd</code> command:</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: Rebuild repodata file</div>
<ol class="arabic">
<li>
<p>Remove all files from <code class="path">/var/cache/rhn/repodata/sles12-sp3-updates-x86_64</code></p>
</li>
<li>
<p>Regenerate the file with <code>spacecmd softwarechannel_regenerateyumcache sles12-sp3-updates-x86_64</code></p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="bp.troubleshooting.Local.Issuer.Certificate"><a class="anchor" href="#bp.troubleshooting.Local.Issuer.Certificate"></a><a class="link" href="#bp.troubleshooting.Local.Issuer.Certificate">19.7. Unable to Get Local Issuer Certificate</a></h3>
<div class="paragraph">
<p>Some older bootstrap scripts will will create a link to the local certificate in the wrong place, which can cause problems with zypper returning an <code>Unrecognized error</code> about the local issuer certificate.
In this case, ensure that the link to the local issuer certificate has been created in <code class="path">/etc/ssl/certs/</code>, and consider updating your bootstrap scripts.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mgr.additional.resources"><a class="anchor" href="#mgr.additional.resources"></a><a class="link" href="#mgr.additional.resources">20. Additional Resources</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter contains links to helpful resources.</p>
</div>
<div class="sect2">
<h3 id="_learning_yaml_syntax_for_salt_states"><a class="anchor" href="#_learning_yaml_syntax_for_salt_states"></a><a class="link" href="#_learning_yaml_syntax_for_salt_states">20.1. Learning YAML Syntax for Salt States</a></h3>
<div class="paragraph">
<p>Learn how to write states and pillars with YAML.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.saltstack.com/en/latest/topics/yaml/index.html" class="bare">https://docs.saltstack.com/en/latest/topics/yaml/index.html</a></p>
</li>
<li>
<p><a href="http://yaml-online-parser.appspot.com/" class="bare">http://yaml-online-parser.appspot.com/</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_getting_started_with_jinja_templates"><a class="anchor" href="#_getting_started_with_jinja_templates"></a><a class="link" href="#_getting_started_with_jinja_templates">20.2. Getting Started with Jinja Templates</a></h3>
<div class="paragraph">
<p>Learn how to begin writing templates in Jinja</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.saltstack.com/en/latest/topics/jinja/index.html" class="bare">https://docs.saltstack.com/en/latest/topics/jinja/index.html</a></p>
</li>
<li>
<p><a href="http://jinja.pocoo.org/docs/dev/" class="bare">http://jinja.pocoo.org/docs/dev/</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_salt_best_practices"><a class="anchor" href="#_salt_best_practices"></a><a class="link" href="#_salt_best_practices">20.3. Salt Best Practices</a></h3>
<div class="paragraph">
<p>Best practices from the Salt team.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.saltstack.com/en/latest/topics/best_practices.html" class="bare">https://docs.saltstack.com/en/latest/topics/best_practices.html</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mgr.product.comparison"><a class="anchor" href="#mgr.product.comparison"></a><a class="link" href="#mgr.product.comparison">21. A  2.1 and 3.2 Product Comparison</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>You may already have experience managing your systems using  2.1.
The good news is all the features you are used to working with, (regarding the traditional stack) have not changed.
The only real exception is that the original built-in monitoring feature has been removed.
Icinga, a third party monitoring solution is included within the SUSE Manager Tools Channel for SLES 12.
 3.2 supports managing systems via the popular IT orchestration engine Salt, in addition to the previously existing traditional management stack.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
<div class="title">Selecting a Management Method</div>
<div class="paragraph">
<p>You cannot and should not mix a single system with both methods although you can have Salt managed systems and traditionally managed systems coexisting and managed by a  server.
You may for example have a development department and assign all machines in this department as Salt minions, likewise you could also have a production department and assign machines as traditional bootstrap clients.
Remember a single machine is either traditionally managed or Salt but never both.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Keep in mind that minions are not traditional clients and their feature set is currently limited.
Future maintenance updates will provide feature parity over time and your feedback for prioritization of these features is welcome! The following tables provide a comparison between each feature set.
This includes features in development and features available only to their parent management stack.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. Comparing Traditional Management and Salt Management</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature/Function</th>
<th class="tableblock halign-left valign-top">Traditional Management</th>
<th class="tableblock halign-left valign-top">Salt Management</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Registration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootstrap/rhnreg_ks</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootstrap scripts and WebUI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Install Packages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Install Patches</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remote Commands</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">System Package States</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsupported</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">System Custom States</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsupported</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Group Custom States</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsupported</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Organization Custom States</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsupported</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">System Set Manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service Pack Migration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Virtualization Host Management: <em>Auto-installation/bare metal installation support</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported (read-only)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">System Redeployment: <em>With Auto-installation</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coming Soon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contact Methods: <em>How the server communicates with a client</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">osad, rhnsd, ssh push</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zeromq: Salt default salt-ssh</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Red Hat Network Clients <em>RHEL 6, 7</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SUSE Manager Proxy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action Chains</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software Crash Reporting</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsupported</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Staging</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duplicate Package Reporting <em>Example: Multiple Versions of the Linux Kernel</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SCAP Auditing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for Multiple Organizations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported  **</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported **</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Package Verification</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Under Review</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">System Locking</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Under Review</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration File Management</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Snapshots and Profiles</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Under Review (Profiles are supported)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Power Management</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coming Soon</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title=":warning:"></i>
</td>
<td class="content">
<div class="title">Isolation Enforcement **</div>
<div class="paragraph">
<p> 2.1 is multi-tenant and organizations are completely isolated from one another.
This isolation includes both privacy and security.</p>
</div>
<div class="paragraph">
<p>For example: User A in Org_1 cannot see user B in Org_2.
(This relates to any data specific to an organization including: servers, channels, activation keys, configuration channels, files and so on.)</p>
</div>
<div class="paragraph">
<p>In  3.2 Salt currently does not support any level of multi-tenancy and therefore information specific to an organization is accessible across organizations.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>salt '*' cmd.run "some_dangerous_command"</pre>
</div>
</div>
<div class="paragraph">
<p>The above command will target all organization, groups and single systems including their files, channels, activation keys etc.
This should be kept in mind when working with Salt.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following table provides an overview of differences in functionality between  2.1 and 3.2.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 3. Comparing  2.1 and 3.2 Functionality</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Functionality</th>
<th class="tableblock halign-left valign-top">SUSE Manager 2.1</th>
<th class="tableblock halign-left valign-top">SUSE Manager 3.2</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration Management</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Based on Static Configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Redesigned with Salt Integration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration Management</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No Concept of States</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">States are Supported</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subscription Management</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Limited Functionality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">New Design, Full Featured</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Monitoring</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Traditional Monitoring Supported until End of Life</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nagios Compatible, Icinga Monitoring Server is Included</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Installation Approach</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Appliance Based</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Installed as an Add-on</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compatibility</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compatibility Carried Forward to  3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maintains full  2.1 Functionality <em>Traditional Monitoring Removed</em></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_gnu_licenses"><a class="anchor" href="#_gnu_licenses"></a><a class="link" href="#_gnu_licenses">Appendix A: GNU Licenses</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This appendix contains the GNU Free Documentation License version 1.2.</p>
</div>
<div class="paragraph">
<p><a href="common_gfdl1.2_i.html#common-license" class="page">GNU Free Documentation License V(1.2)</a></p>
</div>
</div>
</div>
</article>
  </main>
</div>
<footer class="footer">
  <p>Copyright (C) 2017-2018 <a href="https://jcayouette.github.io/personal-blog">Belief and Reason</a></p>
  <p>Except where otherwise noted, jcayouette.github.io/personal-blog, BoR, are licensed under the <a href="https://www.mozilla.org/en-US/MPL/2.0/">Mozilla Public License Version 2.0</a> (MPL-2.0).</p>
</footer>
<script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<!-- fetched from https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js -->
<script>
function focusSearchInput () { document.querySelector('#search-input').focus() }
var search = docsearch({
  appId: '#',
  apiKey: '#',
  indexName: '#',
  inputSelector: '#search-input',
  autocompleteOptions: { hint: false, keyboardShortcuts: ['s'] },
  algoliaOptions: { hitsPerPage: 10 }
}).autocomplete
search.on('autocomplete:closed', function () { search.autocomplete.setVal() })
focusSearchInput()
window.addEventListener('load', focusSearchInput)
</script>
<script src="../../_/js/site.js"></script>
<script src="../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>
  </body>
</html>
