<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> in the Public Cloud:  Server and  Proxy in the Public Cloud :: Uyuni Documentation (Prototype)</title>
    <meta name="generator" content="Antora 1.0.3">
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="stylesheet" href="../../_/css/site-extra.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css">
    <!-- fetched from https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css -->
    <link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <a href="https://jcayouette.github.io/personal-blog">Belief and Reason</a>
        <span class="separator">//</span>
        <a href="../..">Library</a>
      </div>
      <div class="navbar-item">
        <input id="search-input" type="text" placeholder="Search docs">
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <div class="navbar-link">Projects</div>
          <div class="navbar-dropdown">
            <div class="navbar-item"><strong>Resources</strong></div>
            <a class="navbar-item" href="https://github.com/jcayouette/personal-blog">Repository</a>
            <a class="navbar-item" href="https://github.com/jcayouette/personal-blog/issues">Issue Tracker</a>
<!--
            <hr class="navbar-divider">
            <div class="navbar-item"><strong>Custom UI (coming soon!)</strong></div>
            <a class="navbar-item" href="https://gitlab.com/antora/antora-ui-default">Repository</a>
            <a class="navbar-item" href="https://gitlab.com/antora/antora-ui-default/issues">Issue Tracker</a>
            <hr class="navbar-divider">
          -->
            <a class="navbar-item" href="https://github.com/jcayouette/blob/master/contributing.adoc">Contributing</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <div class="navbar-link">Community</div>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="https://discord.gg/vmrAYE3">Discord Chat</a>
          </div>
        </div>
        <a class="navbar-item" href="https://twitter.com/BaR-project">
          <span class="icon">
            <svg aria-hidden="true" data-icon="twitter" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
              <path fill="#57aaee" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path>
            </svg>
          </span>
        </a>
      </div>
    </div>
  </nav>
</header>
<div class="main-wrapper">
<div class="navigation-container" data-component="uyuni" data-version="3.2">
  <aside class="navigation">
    <div class="panels">
<div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="MAIN-manager.html">Uyuni</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="book_mgr_getting_started.html">Getting Started</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="quickstart3_chap_install_overview.html">Overview and Requirements</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.introduction">Introduction</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.prereq">Prerequisites for Installation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.prereq.scc">SUSE SCC Credentials</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.prereq.installmedia">Get Uyuni</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.prereq.hardware">Hardware Requirements</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.prereq.network">Network Requirements</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.prereq.clientos">Supported Client Systems</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="quickstart3_chap_suma_installation_jeos.html">Installation via JeOS</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.kvm.settings">Configuring KVM</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#jeos.kvm.settings">JeOS KVM Settings</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#jeos.susemgr.prep">Preparing JeOS for Uyuni</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quickstart3_chap_suma_installation_sles.html">Installation via SLES</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quickstart3_chap_suma_setup_with_yast.html">Setup and Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quickstart3_chap_suma_keys_and_first_client.html">Connecting Clients</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quickstart3_chap_suma_salt_gs.html">Introduction to Salt</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="book_mgr_best_practices.html">Best Practices</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="book_suma_reference_manual.html">WebUI Reference</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="book_suma_advanced_topics.html">Advanced Topics</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="navigation-explore" data-panel="explore">
  <div class="context">
    <span class="title">Uyuni</span>
    <span class="version">3.2</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Uyuni</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../dev/MAIN-manager.html">dev</a>
        </li>
        <li class="version is-current">
          <a href="MAIN-manager.html">3.2</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
  <main class="main">
<div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
  <a href="../dev/MAIN-manager.html" class="home-link"></a>
<nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="MAIN-manager.html">Uyuni</a></li>
    <li class="crumb"><a href="public-cloud-setup.html"> in the Public Cloud:  Server and  Proxy in the Public Cloud</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="versions-menu-toggle" title="Show other versions of page">3.2</button>
  <div class="versions-menu">
    <a class="version" href="../dev/public-cloud-setup.html">dev</a>
    <a class="version is-current" href="public-cloud-setup.html">3.2</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/jcayouette/uyuni-doc-test/edit/maintenance/3.2/docs/modules/ROOT/pages/public-cloud-setup.adoc">Edit this Page</a></div>
</div>
<article class="doc">
<h1> in the Public Cloud:  Server and  Proxy in the Public Cloud</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#instance-requirements">1. Instance Requirements</a></li>
<li><a href="#setup">2. Setup</a>
<ul class="sectlevel2">
<li><a href="#using-separate-storage-volume">2.1. Using Separate Storage Volume</a></li>
</ul>
</li>
<li><a href="#registration-of-cloned-systems">3. Registration of Cloned Systems</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p> delivers best-in-class Linux server management capabilities.
For detailed information about the product please refer to the <a href="https://www.suse.com/documentation/suse_manager">SUSEManager</a> documentation.</p>
</div>
<div class="paragraph">
<p>The  Server and  Proxy images published by SUSE in selected Public Cloud environments are provided as Bring Your Own Subscription (BYOS) images.
 Server instances need to be registered with the SUSE Customer Center (SCC).
Subscriptions of  Proxy instances are handled through their parent  Server.
After an instance is launched,  needs to be set up and configured following the procedure in the  documentation.</p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="instance-requirements"><a class="anchor" href="#instance-requirements"></a><a class="link" href="#instance-requirements">1. Instance Requirements</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Select an instance size that meets the system requirements as documented in the  documentation.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Minimal main memory: &gt;12G</p>
</li>
<li>
<p>The  setup procedure performs a Forward-confirmed reverse DNS lookup. This must succeed in order for the setup procedure to complete successfully and for  to operate as expected. Therefore it is important that the hostname and IP configuration be performed prior to running the  setup procedure.</p>
</li>
<li>
<p> Server and  Proxy instances are expected to run in a network configuration that provides you control over DNS entries and that is shielded from the Internet at large. Within this network configuration DNS (Domain Name Service) resolution must be provided, such that <code>hostname -f</code> returns the FQDN (Full Qualified Domain Name). The DNS resolution is not only important for the  Server procedure but is also important when clients are configured to be managed via . Configuring DNS is Cloud Framework dependent, please refer to the cloud service provider documentation for detailed instructions.</p>
</li>
<li>
<p>Minimal free disk space for  15G.</p>
<div class="paragraph">
<p>For Public Cloud instances we recommend that the repositories and the  Server database, and respectively the  Proxy squid cache, be located on an external virtual disk.
The details for this setup are provided in <a href="#using-separate-storage-volume">Using Separate Storage Volume</a>.</p>
</div>
<div class="paragraph">
<p>Storing the database and the repositories on an external virtual disk ensures that the data is not lost should the instance need to be terminated for some reason.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please ensure that the selected instance type matches the requirements listed above.
Although we recommend that the database and the repositories are stored on a separate device it is still recommended to set the root volume size of the instance to 20G.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="setup"><a class="anchor" href="#setup"></a><a class="link" href="#setup">2. Setup</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Run an instance of the  Server or  Proxy image as published by SUSE.
The images are identifiable by the suse, manager, server or proxy, and byos keywords in each public cloud environment.
The  instance must run in a network access restricted environment such as the private subnet of a VPC or with an appropriate firewall setting such that it can only be accessed by machines in the IP ranges you use.
A generally accessible  instance violates the terms of the  EULA.
Access to the web interface of SUSE Manager requires https.</p>
</div>
<div class="paragraph">
<p> requires a stable and reliable hostname, changing the hostname can create errors.
In this procedure, all commands need to be executed as the root user.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: Setting the Hostname</div>
<ol class="arabic">
<li>
<p>Disable hostname setup by editing the DHCP configuration file at <code class="path">/etc/sysconfig/network/dhcp</code>, and adding this line:</p>
<div class="listingblock">
<div class="content">
<pre>DHCLIENT_SET_HOSTNAME="no"</pre>
</div>
</div>
</li>
<li>
<p>Set the hostname locally using the <code class="command">hostnamectl</code> command.
Ensure you use the system name, not the fully qualified domain name (FQDN).
The FQDN is set by the cloud framework; for example if  <strong>cloud_instance.cloud.net</strong> is the FQDN, <strong>cloud_instance</strong> is the system name and <strong>cloud.net</strong> is the domain name:</p>
<div class="listingblock">
<div class="content">
<pre>hostnamectl set-hostname system_name</pre>
</div>
</div>
</li>
<li>
<p>Create a DNS entry in your network environment for domain name resolution, or force correct resolution by editing the <code class="path">/etc/hosts</code> file:</p>
<div class="listingblock">
<div class="content">
<pre>$ echo "${local_address} suma.cloud.net suma" &gt;&gt; /etc/hosts</pre>
</div>
</div>
<div class="paragraph">
<p>You can locate the local address by checking your public cloud web console, or from the command line using these commands:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Amazon EC2 instance:</p>
<div class="listingblock">
<div class="content">
<pre>$ ec2metadata --local-ipv4</pre>
</div>
</div>
</li>
<li>
<p>Google Compute Engine:</p>
<div class="listingblock">
<div class="content">
<pre>$ gcemetadata --query instance --network-interfaces --ip</pre>
</div>
</div>
</li>
<li>
<p>Microsoft Azure:</p>
<div class="listingblock">
<div class="content">
<pre>$ azuremetadata --internal-ip</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Forcing DNS resolution by modifying the <code class="path">/etc/hosts</code> file will work correctly in most environments.
However, you will have to perform the same modification for any client that is to be managed with this  instance.
In most cases, it will be easier to manage the DNS resolution by creating a DNS entry in your network environment.</p>
</div>
<div class="paragraph">
<p>One other method for managing hostname resolution is by editing the <code class="path">/etc/resolv.conf</code> file.
Depending on the order of your setup, for example if you started the  instance prior to setting up DNS services the file may not contain the appropriate <strong>search</strong> directive.
Double check that the proper search directive exists in <code class="path">/etc/resolv.conf</code>.
In our example the directive would be <strong>search cloud.net</strong>.
If the directive is missing add it to the file.</p>
</div>
<div class="paragraph">
<p>For an update of the DNS records for the instance within the DNS service of your network environment, refer to the cloud service provider documentation for detailed instructions:
<strong>* <a href="http://docs.aws.amazon.com/AmazonVPC/latest/UserGuide/vpc-dns.html"> DNS setup on Amazon EC2</a>
</strong>* <a href="https://cloud.google.com/compute/docs/networking"> DNS setup on Google Compute Engine</a>
<strong>*</strong> <a href="https://azure.microsoft.com/en-us/documentation/articles/dns-operations-recordsets"> DNS setup on Microsoft Azure</a></p>
</div>
<div class="paragraph">
<p>If you run a  Server instance, you can run YaST after the instance is launched to ensure the external storage is attached and prepared according to <a href="#using-separate-storage-volume">Using Separate Storage Volume</a>, and the DNS resolution is set up as described:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ /sbin/yast2 susemanagersetup</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the setup of  from this point forward does not differ from the documentation in the <a href="https://www.suse.com/documentation/suse_manager">SUSE Manager Guide</a>.</p>
</div>
<div class="paragraph">
<p>The  setup procedure in YaST is designed as a one pass process with no rollback or cleanup capability.
Therefore, if the setup procedure is interrupted or ends with an error, it is not recommended that you repeat the setup process or attempts to manually fix the configuration.
These methods are likely to result in a faulty  installation.
If you experience errors during setup, start a new instance, and begin the setup procedure again on a clean system.</p>
</div>
<div class="paragraph">
<p>If you receive a message that there is not enough space available for setup, ensure that your root volume is at least 20GB and double check that the instructions in <a href="#using-separate-storage-volume">Using Separate Storage Volume</a> have been completed correctly.</p>
</div>
<div class="paragraph">
<p> Server for the Public Cloud comes with a bootstrap data module pre-installed.
The bootstrap module contains optimized package lists for bootstrapping instances started from SUSE Linux Enterprise images published by SUSE.
If you intend to register such an instance, when you creatr the bootstrap repository run the <code class="command">mgr-create-bootstrap-repo</code> script using this command, to create a bootstrap repository suitable for SUSE Linux Enterprise 12 SP1 instances.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mgr-create-bootstrap-repo --datamodule=mgr_pubcloud_bootstrap_data -c SLE-12-SP1-x86_64</pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="https://www.suse.com/documentation/suse-manager-3/book.suma.getting-started/data/create_tools_repository.html">Creating the SUSE Manager Tools Repository</a> for more information on bootstrapping.</p>
</div>
<div class="paragraph">
<p>Prior to registering instances started from on demand images remove the following packages from the instance to be registered:
&#8230;&#8203; cloud-regionsrv-client
&#8230;&#8203; <strong>For Amazon EC2</strong></p>
</div>
<div class="paragraph">
<p>+
regionServiceClientConfigEC2</p>
</div>
<div class="paragraph">
<p>+
regionServiceCertsEC2
&#8230;&#8203; <strong>For Google Compute Engine</strong></p>
</div>
<div class="paragraph">
<p>+
cloud-regionsrv-client-plugin-gce</p>
</div>
<div class="paragraph">
<p>+
regionServiceClientConfigGCE</p>
</div>
<div class="paragraph">
<p>+
regionServiceCertsGCE
&#8230;&#8203; <strong>For Microsoft Azure</strong></p>
</div>
<div class="paragraph">
<p>+
regionServiceClientConfigAzure</p>
</div>
<div class="paragraph">
<p>+
regionServiceCertsAzure</p>
</div>
<div class="paragraph">
<p>+
If these packages are not removed it is possible to create interference between the repositories provided by  and the repositories provided by the SUSE operated update infrastructure.</p>
</div>
<div class="paragraph">
<p>+
Additionally remove the line from the <code class="path">/etc/hosts</code>
file that contains the <strong>susecloud.net</strong> reference.
** If you run a  Proxy instance</p>
</div>
<div class="paragraph">
<p>+
Launch the instance, optionally with external storage configured.
If you use external storage (recommended), prepare it according to <a href="#using-separate-storage-volume">Using Separate Storage Volume</a>.
It is recommended but not required to prepare the storage before configuring  proxy, as the suma-storage script will migrate any existing cached data to the external storage.
After preparing the instance, register the system with the parent SUSE Manager, which could be a  Server or another  Proxy.
See the <a href="https://www.suse.com/documentation/suse-manager-3/singlehtml/suse_manager21/book_susemanager_proxyquick/book_susemanager_proxyquick.html"> SUSE Manager Proxy Setup guide</a> for details.
Once registered, run</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ /usr/sbin/configure-proxy.sh</pre>
</div>
</div>
<div class="paragraph">
<p>+
to configure your  Proxy instance.
. After the completion of the configuration step,  should be functional and running. For  Server, the setup process created an administrator user with following user name:</p>
</div>
<div class="paragraph">
<p>+
* User name: <code>admin</code></p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Account credentials for admin user</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Amazon EC2</th>
<th class="tableblock halign-left valign-top">Google Compute Engine</th>
<th class="tableblock halign-left valign-top">Microsoft Azure</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code class="replaceable">Instance-ID</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code class="replaceable">Instance-ID</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code class="replaceable">Instance-Name</code><strong>-suma</strong></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>+
The current value for the <code class="replaceable">Instance-ID</code> or <code class="replaceable">Instance-Name</code> in case of the Azure Cloud, can be obtained from the public cloud Web console or from within a terminal session as follows:
** Obtain instance id from within Amazon EC2 instance</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ec2metadata --instance-id</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Obtain instance id from within Google Compute Engine instance</p>
<div class="listingblock">
<div class="content">
<pre>$ gcemetadata --query instance --id</pre>
</div>
</div>
</li>
<li>
<p>Obtain instance name from within Microsoft Azure instance</p>
<div class="listingblock">
<div class="content">
<pre>$ azuremetadata --instance-name</pre>
</div>
</div>
<div class="paragraph">
<p>After logging in through the  Server WebUI, <strong>change</strong> the default password.</p>
</div>
<div class="paragraph">
<p> Proxy does not have administration access to the WebUI.
It can be managed through its parent  Server.</p>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="using-separate-storage-volume"><a class="anchor" href="#using-separate-storage-volume"></a><a class="link" href="#using-separate-storage-volume">2.1. Using Separate Storage Volume</a></h3>
<div class="paragraph">
<p>We recommend that the repositories and the database for  be stored on a virtual storage device.
This best practice will avoid data loss in cases where the  instance may need to be terminated.
These steps <strong>must</strong> be performed <strong>prior</strong> to running the YaST   setup procedure.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Provision a disk device in the public cloud environment, refer to the cloud service provider documentation for detailed instructions. The size of the disk is dependent on the number of distributions and channels you intend to manage with .
For sizing information refer to <a href="https://www.suse.com/support/kb/doc.php?id=7015050">SUSE Manager sizing examples</a>. A rule of thumb is 25 GB per distribution per channel.</p>
</li>
<li>
<p>Once attached the device appears as Unix device node in your instance. For the following command to work this device node name is required. In many cases the attached storage appears as <strong>/dev/sdb</strong>. In order to check which disk devices exists on your system, call the following command:</p>
<div class="listingblock">
<div class="content">
<pre>$ hwinfo --disk | grep -E "Device File:"</pre>
</div>
</div>
</li>
<li>
<p>With the device name at hand the process of re-linking the directories in the filesystem  uses to store data is handled by the suma-storage script. In the following example we use <code class="path">/dev/sdb</code> as the device name.</p>
<div class="listingblock">
<div class="content">
<pre>$ /usr/bin/suma-storage /dev/sdb</pre>
</div>
</div>
<div class="paragraph">
<p>After the call all database and repository files used by SUSE Manager Server are moved to the newly created xfs based storage.
In case your instance is a  Proxy, the script will move the Squid cache, which caches the software packages, to the newly created storage.
The xfs partition is mounted below the path <code class="path">/manager_storage</code>.
.</p>
</div>
</li>
<li>
<p>Create an entry in /etc/fstab (optional)</p>
<div class="paragraph">
<p>Different cloud frameworks treat the attachment of external storage devices differently at instance boot time.
Please refer to the cloud environment documentation for guidance about the fstab entry.</p>
</div>
<div class="paragraph">
<p>If your cloud framework recommends to add an fstab entry, add the following line to the <strong>/etc/fstab</strong> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/dev/sdb1 /manager_storage xfs defaults 1 1</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registration-of-cloned-systems"><a class="anchor" href="#registration-of-cloned-systems"></a><a class="link" href="#registration-of-cloned-systems">3. Registration of Cloned Systems</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p> cannot distinguish between different instances that use the same system ID.
If you register a second instance with the same system ID as a previous instance,  will overwrite the original system data with the new system data.
This can occur when you launch multiple instances from the same image, or when an image is created from a running instance.
However, it is possible to clone systems and register them successfully by deleting the cloned system&#8217;s ID, and generating a new ID.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: Registering Cloned Systems</div>
<ol class="arabic">
<li>
<p>Clone the system using your preferred hypervisor&#8217;s cloning mechanism.</p>
</li>
<li>
<p>On the cloned system, change the hostname and IP addresses, and check the <code class="path">/etc/hosts</code> file to ensure you have the right host entries.</p>
</li>
<li>
<p>Stop the <code class="command">rhnsd</code> daemon with <code class="command">/etc/init.d/rhnsd stop</code> or <code class="command">rcosad stop</code>.</p>
</li>
<li>
<p>For SLES 11 or Red Hat Enterprise Linux 5 or 6 clients, run these commands:</p>
<div class="listingblock">
<div class="content">
<pre># rm /var/lib/dbus/machine-id
# dbus-uuidgen --ensure</pre>
</div>
</div>
</li>
<li>
<p>For SLES 12 or Red Hat Enterprise Linux 7 clients, run these commands:</p>
<div class="listingblock">
<div class="content">
<pre># rm /etc/machine-id
# rm /var/lib/dbus/machine-id
# dbus-uuidgen --ensure
# systemd-machine-id-setup</pre>
</div>
</div>
</li>
<li>
<p>If you are using Salt, then you will also need to run these commands:</p>
<div class="listingblock">
<div class="content">
<pre># service salt-minion stop
# rm -rf /var/cache/salt</pre>
</div>
</div>
</li>
<li>
<p>If you are using a traditional registered system, clean up the working files with this command:</p>
<div class="listingblock">
<div class="content">
<pre># rm -f /etc/sysconfig/rhn/{osad-auth.conf,systemid}</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The bootstrap should now run with a new system ID, rather than a duplicate.</p>
</div>
<div class="paragraph">
<p>If you are onboarding Salt minion clones, then you will also need to check if they have the same Salt minion ID.
You will need to delete the minion ID on each cloned minion, using the <code class="command">rm</code> command.
Each operating system type stores this file in a slightly different location, check the table for the appropriate command.</p>
</div>
<div class="paragraph">
<div class="title">Minion ID File Location</div>
<p>Each operating system stores the minion ID file in a slightly different location, check the table for the appropriate command.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operating System</th>
<th class="tableblock halign-left valign-top">Commands</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SLES 12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code class="command">rm /etc/salt/minion_id</code></p>
<p class="tableblock">                     <code class="command">rm  -f /etc/zypp/credentials.d/{SCCcredentials,NCCcredentials}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SLES 11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code class="command">rm /etc/salt/minion_id</code></p>
<p class="tableblock">                     <code class="command">suse_register -E</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SLES 10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code class="command">rm -rf /etc/{zmd,zypp}</code></p>
<p class="tableblock">                     <code class="command">rm -rf /var/lib/zypp/</code>
                     Do not delete <code class="path">/var/lib/zypp/db/products/</code></p>
<p class="tableblock">                     <code class="command">rm -rf /var/lib/zmd/</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Red Hat Enterprise Linux 5, 6, 7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code class="command"> rm  -f /etc/NCCcredentials</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Once you have deleted the minion ID file, re-run the bootstrap script, and restart the minion to see the cloned system in  with the new ID.</p>
</div>
</div>
</div>
</article>
  </main>
</div>
<footer class="footer">
  <p>Copyright (C) 2017-2018 <a href="https://jcayouette.github.io/personal-blog">Belief and Reason</a></p>
  <p>Except where otherwise noted, jcayouette.github.io/personal-blog, BoR, are licensed under the <a href="https://www.mozilla.org/en-US/MPL/2.0/">Mozilla Public License Version 2.0</a> (MPL-2.0).</p>
</footer>
<script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<!-- fetched from https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js -->
<script>
function focusSearchInput () { document.querySelector('#search-input').focus() }
var search = docsearch({
  appId: '#',
  apiKey: '#',
  indexName: '#',
  inputSelector: '#search-input',
  autocompleteOptions: { hint: false, keyboardShortcuts: ['s'] },
  algoliaOptions: { hitsPerPage: 10 }
}).autocomplete
search.on('autocomplete:closed', function () { search.autocomplete.setVal() })
focusSearchInput()
window.addEventListener('load', focusSearchInput)
</script>
<script src="../../_/js/site.js"></script>
<script src="../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>
  </body>
</html>
