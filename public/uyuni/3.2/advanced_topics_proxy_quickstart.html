<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> 3.2 Proxy :: Uyuni Documentation (Prototype)</title>
    <meta name="generator" content="Antora 1.0.3">
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="stylesheet" href="../../_/css/site-extra.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css">
    <!-- fetched from https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css -->
    <link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <a href="https://jcayouette.github.io/personal-blog">Belief and Reason</a>
        <span class="separator">//</span>
        <a href="../..">Library</a>
      </div>
      <div class="navbar-item">
        <input id="search-input" type="text" placeholder="Search docs">
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <div class="navbar-link">Projects</div>
          <div class="navbar-dropdown">
            <div class="navbar-item"><strong>Resources</strong></div>
            <a class="navbar-item" href="https://github.com/jcayouette/personal-blog">Repository</a>
            <a class="navbar-item" href="https://github.com/jcayouette/personal-blog/issues">Issue Tracker</a>
<!--
            <hr class="navbar-divider">
            <div class="navbar-item"><strong>Custom UI (coming soon!)</strong></div>
            <a class="navbar-item" href="https://gitlab.com/antora/antora-ui-default">Repository</a>
            <a class="navbar-item" href="https://gitlab.com/antora/antora-ui-default/issues">Issue Tracker</a>
            <hr class="navbar-divider">
          -->
            <a class="navbar-item" href="https://github.com/jcayouette/blob/master/contributing.adoc">Contributing</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <div class="navbar-link">Community</div>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="https://discord.gg/vmrAYE3">Discord Chat</a>
          </div>
        </div>
        <a class="navbar-item" href="https://twitter.com/BaR-project">
          <span class="icon">
            <svg aria-hidden="true" data-icon="twitter" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
              <path fill="#57aaee" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path>
            </svg>
          </span>
        </a>
      </div>
    </div>
  </nav>
</header>
<div class="main-wrapper">
<div class="navigation-container" data-component="uyuni" data-version="3.2">
  <aside class="navigation">
    <div class="panels">
<div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="MAIN-manager.html">Uyuni</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="book_mgr_getting_started.html">Getting Started</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="quickstart3_chap_install_overview.html">Overview and Requirements</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.introduction">Introduction</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.prereq">Prerequisites for Installation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.prereq.scc">SUSE SCC Credentials</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.prereq.installmedia">Get Uyuni</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.prereq.hardware">Hardware Requirements</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.prereq.network">Network Requirements</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.prereq.clientos">Supported Client Systems</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="quickstart3_chap_suma_installation_jeos.html">Installation via JeOS</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quickstart.sect.kvm.settings">Configuring KVM</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#jeos.kvm.settings">JeOS KVM Settings</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#jeos.susemgr.prep">Preparing JeOS for Uyuni</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quickstart3_chap_suma_installation_sles.html">Installation via SLES</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quickstart3_chap_suma_setup_with_yast.html">Setup and Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quickstart3_chap_suma_keys_and_first_client.html">Connecting Clients</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quickstart3_chap_suma_salt_gs.html">Introduction to Salt</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="book_mgr_best_practices.html">Best Practices</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="book_suma_reference_manual.html">WebUI Reference</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="book_suma_advanced_topics.html">Advanced Topics</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="navigation-explore" data-panel="explore">
  <div class="context">
    <span class="title">Uyuni</span>
    <span class="version">3.2</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Uyuni</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../dev/MAIN-manager.html">dev</a>
        </li>
        <li class="version is-current">
          <a href="MAIN-manager.html">3.2</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
  <main class="main">
<div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
  <a href="../dev/MAIN-manager.html" class="home-link"></a>
<nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="MAIN-manager.html">Uyuni</a></li>
    <li class="crumb"><a href="advanced_topics_proxy_quickstart.html"> 3.2 Proxy</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="versions-menu-toggle" title="Show other versions of page">3.2</button>
  <div class="versions-menu">
    <a class="version" href="../dev/advanced_topics_proxy_quickstart.html">dev</a>
    <a class="version is-current" href="advanced_topics_proxy_quickstart.html">3.2</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/jcayouette/uyuni-doc-test/edit/maintenance/3.2/docs/modules/ROOT/pages/advanced_topics_proxy_quickstart.adoc">Edit this Page</a></div>
</div>
<article class="doc">
<h1> 3.2 Proxy</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#at.manager.proxy.concepts">Overview</a></li>
<li><a href="#at.manager.proxy.inst-and-clients">Proxy Installation and Connecting Clients</a>
<ul class="sectlevel2">
<li><a href="#at.manager.proxy.requirements">Requirements</a></li>
<li><a href="#at.manager.proxy.inst">Installation and Setup</a></li>
<li><a href="#at.manager.proxy.run.pattern">Install the <code class="path">suma_proxy</code> pattern</a></li>
<li><a href="#at.manager.proxy.run.copycert">Copy Server Certificate and Key</a></li>
<li><a href="#at.manager.proxy.run.confproxy">Running <code class="command">configure-proxy.sh</code></a></li>
<li><a href="#at.manager.proxy.register.saltclients">Registering Salt Clients via SUSE Manager Proxy</a></li>
<li><a href="#at.manager.proxy.register.clients">Registering Clients via SUSE Manager Proxy with a Script</a></li>
<li><a href="#at.additional.info.about.client.registration.on.proxies">Additional Information about Client Registration on Proxies</a></li>
</ul>
</li>
<li><a href="#advanced.topics.proxy.pxe">Enabling PXE Boot via SUSE Manager Proxy</a>
<ul class="sectlevel2">
<li><a href="#advanced.topics.proxy.pxe.sync">Synchronizing Profiles and System Information</a></li>
<li><a href="#advanced.topics.proxy.pxe.dhcp">Configuring DHCP for PXE via SUSE Manager Proxy</a></li>
</ul>
</li>
<li><a href="#advanced.topics.proxy.migration3">Migrating  3 Proxy to Version 3.1</a>
<ul class="sectlevel2">
<li><a href="#at.replacing.a.susemgrproxy">Replacing a SUSE Manager Proxy</a></li>
<li><a href="#at.upgrade.a.susemgrproxy">Upgrading a SUSE Manager Proxy from 3 to 3.1</a></li>
</ul>
</li>
<li><a href="#advanced.topics.proxy.migration">Migrating   2.1 Proxy to Version 3.1</a>
<ul class="sectlevel2">
<li><a href="#advanced.topics.proxy.migration.replace">Replacing a SUSE Manager Proxy</a></li>
<li><a href="#advanced.topics.proxy.migration.upgrade">Upgrading a SUSE Manager Proxy from 2.1 to 3.1</a></li>
</ul>
</li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>This chapter explains how to install and set up  3.2 Proxy.
It also provides notes about migrating a previous proxy such as version 2.1, 3.0, or 3.1 to version 3.2.</p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="at.manager.proxy.concepts"><a class="anchor" href="#at.manager.proxy.concepts"></a><a class="link" href="#at.manager.proxy.concepts">Overview</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p> 3.2 Proxy is a  add-on that caches software packages on an internal, central server.
The proxy caches patch updates from SUSE or custom RPMs generated by third-party organizations.
A proxy allows you to use bandwidth more effectively because client systems connect to the proxy for updates, and the  server is no longer required to handle all client requests.
The proxy also supports transparent custom package deployment.</p>
</div>
<div class="paragraph">
<p> Proxy is an open source (GPLv2) solution that provides the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Cache software packages within a Squid proxy.</p>
</li>
<li>
<p>Client systems see the SUSE Manager Proxy as a  server instance.</p>
</li>
<li>
<p>The SUSE Manager Proxy is registered as a client system with the  server.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The primary goal of a SUSE Manager Proxy is to improve  performance by reducing bandwidth requirements and accelerating response time.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="at.manager.proxy.inst-and-clients"><a class="anchor" href="#at.manager.proxy.inst-and-clients"></a><a class="link" href="#at.manager.proxy.inst-and-clients">Proxy Installation and Connecting Clients</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="at.manager.proxy.requirements"><a class="anchor" href="#at.manager.proxy.requirements"></a><a class="link" href="#at.manager.proxy.requirements">Requirements</a></h3>
<div class="paragraph">
<p>The following section provides SUSE Manager Proxy requirements.</p>
</div>
<div class="paragraph">
<div class="title">Supported Client Systems</div>
<p>For supported clients and their requirements, see Supported Client Systems.</p>
</div>
<div class="paragraph">
<div class="title">Hardware Requirements</div>
<p>Hardware requirements highly depend on your usage scenario.
When planning proxy environments, consider the amount of data you want to cache on your proxy.
If your proxy should be a 1:1 mirror of your , the same amount of disk space is required.
For specific hardware requirements, see the following table.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Hardware</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multi-core 64-bit CPU (x86_64).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RAM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum 4&#160; GB for a non-production server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum 16&#160; GB for a production server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Free Disk Space</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum 100&#160; GB for base installation and at least 50 GB for caching per SUSE product and +100 GB per Red Hat product; a resizeable partition strongly recommended.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title=":bulb:"></i>
</td>
<td class="content">
<div class="title">Storage for Proxy Data</div>
<div class="paragraph">
<p>SUSE recommends storing the squid proxy caching data on a separate disk formatted with the XFS file system.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">SSL Certificate Password</div>
<p>For installing the proxy, you need the SSL certificate password entered during the initial installation of .</p>
</div>
<div class="paragraph">
<div class="title">Network Requirements</div>
<p>For additional network requirements, see Additional Requirements.</p>
</div>
<div class="paragraph">
<div class="title">SUSE Customer Center</div>
<p>For using SUSE Manager Proxy, you need an account at SUSE Customer Center (SCC) where your purchased products and product subscriptions are registered.
Make sure you have the following subscriptions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One or more subscriptions for SUSE Manager Proxy .</p>
</li>
<li>
<p>One or more subscriptions for  .</p>
</li>
<li>
<p>Subscriptions for the products on the client systems you want to register with  via SUSE Manager Proxy .</p>
</li>
<li>
<p>Subscriptions to client entitlements for the client system you want to register with  via SUSE Manager Proxy .</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Network Time Protocol (NTP)</div>
<p>The connection to the Web server via Secure Sockets Layer (SSL) requires correct time settings on the server, proxy and clients.
For this reason, all systems must use NTP.
For more information, see <a href="https://www.suse.com/documentation/sles-12/book_sle_admin/data/cha_netz_xntp.html" class="bare">https://www.suse.com/documentation/sles-12/book_sle_admin/data/cha_netz_xntp.html</a>.</p>
</div>
<div class="paragraph">
<div class="title">Virtual Environments</div>
<p>The following virtual environments are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.linux-kvm.org/page/Main_Page" class="bare">http://www.linux-kvm.org/page/Main_Page</a></p>
</li>
<li>
<p><a href="http://www.vmware.com/" class="bare">http://www.vmware.com/</a></p>
</li>
<li>
<p><a href="http://www.microsoft.com/en-us/server-cloud/solutions/virtualization.aspx" class="bare">http://www.microsoft.com/en-us/server-cloud/solutions/virtualization.aspx</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For running SUSE Manager Proxy
in virtual environments, use the following settings for the virtual machine (VM):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>At least 1 GB of RAM</p>
</li>
<li>
<p>Bridged network</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="at.manager.proxy.inst"><a class="anchor" href="#at.manager.proxy.inst"></a><a class="link" href="#at.manager.proxy.inst">Installation and Setup</a></h3>
<div class="paragraph">
<p>The following section will guide you through the installation and setup procedure.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
<div class="title">Registering Proxies</div>
<div class="paragraph">
<p> Proxy systems are registered as traditional clients using a bootstrap script.
Currently there is no method to register proxy systems using Salt.
A SUSE Manager Proxy can serve both Traditional and Salt clients.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="at.manager.proxy.install.prep" class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
<div class="title">Procedure: Registering the Proxy</div>
<div class="paragraph">
<p>First completely download the channels (SUSE Linux Enterprise 12 SP3) and then create the activation key.
Only then you can select the correct child channels.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create an activation key based on the SUSE Linux Enterprise 12 SP3 base channel.
For more information about activation keys, see <a href="#create.act.keys">[create.act.keys]</a>.</p>
<div class="imageblock">
<div class="content">
<img src="_images/proxy-key.png" alt="proxy key">
</div>
<div class="title">Figure 1. Proxy Activation Key</div>
</div>
</li>
<li>
<p>Click the <b class="menuref">Child Channels</b> subtab and select the  3.2 Proxy child channel with the matching update channel (<code class="systemitem">SUSE Manager Proxy-3.2-Pool</code> and <code class="systemitem">SUSE-Manager-Proxy-3.2-Updates</code> ).
These child channels are required for providing the proxy packages and updates.
As for normal SLES clients, <code class="systemitem">SLES12-SP3-Updates</code> plus <code class="systemitem">SLE-Manager-Tools12-Pool</code> and <code class="systemitem">SLE-Manager-Tools12-Updates</code> are required.</p>
<div class="imageblock">
<div class="content">
<img src="_images/sles12-proxy-child.png" alt="sles12 proxy child">
</div>
<div class="title">Figure 2. Base and Child Proxy Channel</div>
</div>
</li>
</ol>
</div>
<div id="at.manager.proxy.install.prep.bss" class="olist arabic">
<ol class="arabic">
<li>
<p>Modify a bootstrap script for the proxy.
Ensure unchecking <b class="menuref">Bootstrap using Salt</b> , because in this case the proxy must be bootstrapped as a so-called traditional client.
For more information about bootstrap scripts, see <a href="#modify.bootstrap.script">[modify.bootstrap.script]</a>.</p>
</li>
<li>
<p>Bootstrap the client with the bootstrap script.</p>
</li>
<li>
<p>You will see a list of channels to which your client is already subscribed to.
Select the two unchecked proxy channels which include the <code class="systemitem">SUSE Manager Proxy-3.2-Pool</code> and <code class="systemitem">SUSE-Manager-Proxy-3.2-Updates</code> , then select <b class="menuref">Change Subscriptions</b> to continue.
This will provide the required repositories for the proxy packages from the  server to the client.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A few more steps are still needed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>install the <code class="path">suma_proxy</code> pattern (see <a href="#at.manager.proxy.run.pattern">Install the <code class="path">suma_proxy</code> pattern</a>);</p>
</li>
<li>
<p>copy the SSL certificate and key from the server (see <a href="#at.manager.proxy.run.copycert">Copy Server Certificate and Key</a>);</p>
</li>
<li>
<p>run <code class="command">configure-proxy.sh</code> (see <a href="#at.manager.proxy.run.confproxy">Running <code class="command">configure-proxy.sh</code></a>);</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You will then be able to register your clients against the proxy using the WebUI or a bootstrap script as if it were a  server.
For more information, see <a href="#at.manager.proxy.register.saltclients">Registering Salt Clients via SUSE Manager Proxy</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="at.manager.proxy.run.pattern"><a class="anchor" href="#at.manager.proxy.run.pattern"></a><a class="link" href="#at.manager.proxy.run.pattern">Install the <code class="path">suma_proxy</code> pattern</a></h3>
<div class="paragraph">
<p>Make sure the <code class="path">suma_proxy</code> pattern version 2.5.1.3 or later is installed using the following command on the proxy as root:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>zypper in -t pattern suma_proxy</pre>
</div>
</div>
<div class="paragraph">
<p>The new salt-broker service will be automatically started at the end of the package installation.
This service forwards the Salt interactions to the  server.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
<div class="title">Proxy Chains</div>
<div class="paragraph">
<p>It is possible to arrange Salt proxies in a chain.
In such a case, the upstream proxy is named &#8220;parent&#8221;.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Make sure the proxie&#8217;s TCP ports <code>4505</code> and <code>4506</code> are open and that the proxy can reach the  server (or another upstream proxy) on these ports.</p>
</div>
</div>
<div class="sect2">
<h3 id="at.manager.proxy.run.copycert"><a class="anchor" href="#at.manager.proxy.run.copycert"></a><a class="link" href="#at.manager.proxy.run.copycert">Copy Server Certificate and Key</a></h3>
<div class="paragraph">
<p>The proxy will share some SSL information with the  server, so the next step is to copy the certificate and its key from the  server or the upstream proxy.</p>
</div>
<div class="paragraph">
<p>As root, enter the following commands on the proxy using your  server or chained proxy named as <code class="replaceable">PARENT</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>cd /root/ssl-build scp root@`PARENT`:/root/ssl-build/RHN-ORG-PRIVATE-SSL-KEY scp root@`PARENT`:/root/ssl-build/RHN-ORG-TRUSTED-SSL-CERT scp root@`PARENT`:/root/ssl-build/rhn-ca-openssl.cnf .</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
<div class="title">Known Limitation</div>
<div class="paragraph">
<p>The SUSE Manager Proxy functionality is only supported if the SSL certificate was signed by the same CA as the  Server certificate.
Using certificates signed by different CAs for Proxies and Server is not supported.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="at.manager.proxy.run.confproxy"><a class="anchor" href="#at.manager.proxy.run.confproxy"></a><a class="link" href="#at.manager.proxy.run.confproxy">Running <code class="command">configure-proxy.sh</code></a></h3>
<div class="paragraph">
<p>The <code class="command">configure-proxy.sh</code> script will finalize the setup of your SUSE Manager Proxy.</p>
</div>
<div class="paragraph">
<p>Now execute the interactive <code class="command">configure-proxy.sh</code> script.
Pressing <kbd>Enter</kbd> without further input will make the script use the default values provided between brackets <code>[]</code>.
Here is some information about the requested settings:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"> Parent</dt>
<dd>
<p>A  parent can be either another proxy server or a  server.</p>
</dd>
<dt class="hdlist1">HTTP Proxy</dt>
<dd>
<p>A HTTP proxy enables your  proxy to access the Web.
This is needed if where direct access to the Web is prohibited by a firewall.</p>
</dd>
<dt class="hdlist1">Proxy Version to Activate</dt>
<dd>
<p>Normally, the correct value (3.0, 3.1, or 3.2) should be offered as a default.</p>
</dd>
<dt class="hdlist1">Traceback Email</dt>
<dd>
<p>An email address where to report problems.</p>
</dd>
<dt class="hdlist1">Use SSL</dt>
<dd>
<p>For safety reasons, press <code>Y</code>.</p>
</dd>
<dt class="hdlist1">Do You Want to Import Existing Certificates?</dt>
<dd>
<p>Answer <code>N</code>.
This ensures using the new certificates that were copied previously from the  server.</p>
</dd>
<dt class="hdlist1">Organization</dt>
<dd>
<p>The next questions are about the characteristics to use for the SSL certificate of the proxy.
The organization might be the same organization that was used on the server, unless of course your proxy is not in the same organization as your main server.</p>
</dd>
<dt class="hdlist1">Organization Unit</dt>
<dd>
<p>The default value here is the proxy&#8217;s hostname.</p>
</dd>
<dt class="hdlist1">City</dt>
<dd>
<p>Further information attached to the proxy&#8217;s certificate.
Beware the country code must be made of two upper case letters.
For further information on country codes, refer to the online <a href="https://www.iso.org/obp/ui/#search">list of alpha-2 codes</a>.</p>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title=":bulb:"></i>
</td>
<td class="content">
<div class="title">Country Code</div>
<div class="paragraph">
<p>As the country code enter the country code set during the SUSE Manager installation.
For example, if your proxy is in US and your  in DE, you must enter <code>DE</code> for the proxy.</p>
</div>
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1">Cname Aliases (Separated by Space)</dt>
<dd>
<p>Use this if your proxy server can be accessed through various DNS CNAME aliases.
Otherwise it can be left empty.</p>
</dd>
<dt class="hdlist1">CA Password</dt>
<dd>
<p>Enter the password that was used for the certificate of your  server.</p>
</dd>
<dt class="hdlist1">Do You Want to Use an Existing SSH Key for Proxying SSH-Push Salt Minions?</dt>
<dd>
<p>Use this option if you want to reuse a SSH key that was used for SSH-Push Salt minions on the server.</p>
</dd>
<dt class="hdlist1">Create and Populate Configuration Channel rhn_proxy_config_1000010001?</dt>
<dd>
<p>Accept default <code>Y</code>.</p>
</dd>
<dt class="hdlist1">SUSE Manager Username</dt>
<dd>
<p>Use same user name and password as on the  server.</p>
</dd>
<dt class="hdlist1">Activate advertising proxy via SLP?</dt>
<dd>
<p>SLP stands for Service Location Protocol.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>If parts are missing, such as CA key and public certificate, the script prints commands that you must execute to integrate the needed files.
When the mandatory files are copied, re-run <code class="command">configure-proxy.sh</code>.
Also restart the script if a HTTP error was met during script execution.</p>
</div>
<div class="paragraph">
<p><code class="command">configure-proxy.sh</code> activates services required by  Proxy, such as <code class="systemitem">squid</code>, <code class="systemitem">apache2</code>, <code class="systemitem">salt-broker</code>, and <code class="systemitem">jabberd</code>.</p>
</div>
<div class="paragraph">
<p>To check the status of the proxy system and its clients, click the proxy system&#8217;s details page on the WebUI (<span class="menuseq"><b class="menu">Systems</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Proxy</b></span>, then the system name). <span class="menuseq"><b class="menu">Connection</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">] and menu:Proxy[</b></span> subtabs display the respective status information.</p>
</div>
</div>
<div class="sect2">
<h3 id="at.manager.proxy.register.saltclients"><a class="anchor" href="#at.manager.proxy.register.saltclients"></a><a class="link" href="#at.manager.proxy.register.saltclients">Registering Salt Clients via SUSE Manager Proxy</a></h3>
<div class="paragraph">
<p>Proxy servers may now act as a broker and package cache for Salt minions.
These minions can be registered with a bootstrap script like the traditional clients, or directly from the WebUI or the command line.</p>
</div>
<div class="paragraph">
<p>Registering Salt clients via SUSE Manager Proxy from the WebUI
is done almost the same way as registering clients directly with the  server.
The difference is that you specify the name of the proxy in the <span class="menuseq"><b class="menu">Proxy</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">] drop-box on menu:Salt[Bootstrapping</b></span> page.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/proxy-saltbootstrap.png" alt="proxy saltbootstrap">
</div>
<div class="title">Figure 3. Bootstrapping a Salt Client With a Proxy</div>
</div>
<div class="olist arabic">
<div class="title">Procedure: Register a Salt client through a proxy from command line</div>
<ol class="arabic">
<li>
<p>Instead of the WebUI , you may use the command line to register a minion through a proxy.
To do so, add the proxy FQDN as the master in the minions configuration file located at:</p>
<div class="listingblock">
<div class="content">
<pre>/etc/salt/minion</pre>
</div>
</div>
<div class="paragraph">
<p>or alternatively:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/etc/salt/minion.d/`name`.conf</pre>
</div>
</div>
</li>
<li>
<p>Add the FQDN to the minion file:</p>
<div class="listingblock">
<div class="content">
<pre>master: proxy123.example.com</pre>
</div>
</div>
<div class="paragraph">
<p>Save and restart the salt-minion service with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>systemctl restart salt-minion</pre>
</div>
</div>
</li>
<li>
<p>On the proxy, accept the new minion key with:</p>
<div class="listingblock">
<div class="content">
<pre>salt-key -a 'minion'</pre>
</div>
</div>
<div class="paragraph">
<p>The minion will now connect to the proxy exclusively for Salt operations and normal HTTP package downloads.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="at.manager.proxy.register.clients"><a class="anchor" href="#at.manager.proxy.register.clients"></a><a class="link" href="#at.manager.proxy.register.clients">Registering Clients via SUSE Manager Proxy with a Script</a></h3>
<div class="paragraph">
<p>Registering clients (either traditional or Salt) via SUSE Manager Proxy with a script is done almost the same way as registering clients directly with the  server.
The difference is that you create the bootstrap script on the SUSE Manager Proxy with a command-line tool.
The bootstrap script then deploys all necessary information to the clients.
The bootstrap script refers some parameters (such as activation keys or GPG keys) that depend on your specific setup.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a client activation key on the  server using the WebUI.
See <a href="#create.act.keys">[create.act.keys]</a>.</p>
</li>
<li>
<p>On the proxy, execute the <code class="command">mgr-bootstrap</code> command-line tool as {rootuser}.
If needed, use the additional command-line switches to tune your bootstrap script. An important option is <code class="command">--traditional</code> that enables to opt for a traditional client instead of a salt minion.</p>
<div class="paragraph">
<p>To view available options type <code class="command">mgr-bootstrap --help</code> from the command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># ``mgr-bootstrap --activation-keys=key-string``</pre>
</div>
</div>
</li>
<li>
<p>Optionally edit the resulting bootstrap script.
Execute the bootstrap script on the clients as described in <a href="#connect.first.client">[connect.first.client]</a>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The clients are registered with the SUSE Manager Proxy specified in the bootstrap script.</p>
</div>
</div>
<div class="sect2">
<h3 id="at.additional.info.about.client.registration.on.proxies"><a class="anchor" href="#at.additional.info.about.client.registration.on.proxies"></a><a class="link" href="#at.additional.info.about.client.registration.on.proxies">Additional Information about Client Registration on Proxies</a></h3>
<div class="paragraph">
<p>Within the WebUI, standard proxy pages will show information about client, no matter whether minions or traditional clients.</p>
</div>
<div class="paragraph">
<p>A list of clients connected to a proxy can be located under <span class="menuseq"><b class="menu">Systems</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">] &lt;proxy name</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">menu:Details[</b></span><b class="menuref">Proxy</b>.</p>
</div>
<div class="paragraph">
<p>A list of chained proxies for a minion can be located under <span class="menuseq"><b class="menu">Systems</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">] &lt;minion name</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">menu:Details[</b></span><b class="menuref">Connection</b></p>
</div>
<div class="paragraph">
<p>If you decide to move any of your clients between proxies or the server you will need to repeat the registration process from scratch.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="advanced.topics.proxy.pxe"><a class="anchor" href="#advanced.topics.proxy.pxe"></a><a class="link" href="#advanced.topics.proxy.pxe">Enabling PXE Boot via SUSE Manager Proxy</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="advanced.topics.proxy.pxe.sync"><a class="anchor" href="#advanced.topics.proxy.pxe.sync"></a><a class="link" href="#advanced.topics.proxy.pxe.sync">Synchronizing Profiles and System Information</a></h3>
<div class="paragraph">
<p>To enable PXE boot via a proxy server, additional software must be installed and configured on both the  server and the SUSE Manager Proxy server.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the  server install <span class="package">susemanager-tftpsync</span> :</p>
<div class="listingblock">
<div class="content">
<pre>zypper in susemanager-tftpsync</pre>
</div>
</div>
</li>
<li>
<p>On the SUSE Manager Proxy server install <span class="package">susemanager-tftpsync-recv</span> :</p>
<div class="listingblock">
<div class="content">
<pre>zypper in susemanager-tftpsync-recv</pre>
</div>
</div>
</li>
<li>
<p>Run the <code class="command">configure-tftpsync.sh</code> setup script and enter the requested information:</p>
<div class="listingblock">
<div class="content">
<pre>configure-tftpsync.sh</pre>
</div>
</div>
<div class="paragraph">
<p>It asks for hostname and IP address of the  server and of the proxy itself.
Additionally, it asks for the tftpboot directory on the proxy.</p>
</div>
</li>
<li>
<p>On the  server, run <code class="command">configure-tftpsync.sh</code> to configure the upload to the SUSE Manager Proxy server:</p>
<div class="listingblock">
<div class="content">
<pre>configure-tftpsync.sh FQDN_of_Proxy_Server</pre>
</div>
</div>
</li>
<li>
<p>To initiate an initial synchronization on the SUSE Manager Server run:</p>
<div class="listingblock">
<div class="content">
<pre>cobbler sync</pre>
</div>
</div>
<div class="paragraph">
<p>Also can also be done after each a change within Cobbler that needs to be synchronized immediately.
Otherwise Cobbler synchronization will also run automatically when needed.
For more information about Cobbler, see <a href="#advanced.topics.cobbler">[advanced.topics.cobbler]</a>.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="advanced.topics.proxy.pxe.dhcp"><a class="anchor" href="#advanced.topics.proxy.pxe.dhcp"></a><a class="link" href="#advanced.topics.proxy.pxe.dhcp">Configuring DHCP for PXE via SUSE Manager Proxy</a></h3>
<div class="paragraph">
<p> is using Cobbler to provide provisioning.
PXE (tftp) is installed and activated by default.
To enable systems to find the PXE boot on the SUSE Manager Proxy server add the following to the DHCP configuration for the zone containing the systems to be provisioned:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>next-server:`IP_Address_of_SUSE_Manager_Proxy_Server`filename: "pxelinux.0"</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="advanced.topics.proxy.migration3"><a class="anchor" href="#advanced.topics.proxy.migration3"></a><a class="link" href="#advanced.topics.proxy.migration3">Migrating  3 Proxy to Version 3.1</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The recommended order for migrations is to first migrate the server and then the proxies.
Note that a  3 Proxy works correctly with  3.1.</p>
</div>
<div class="paragraph">
<p>For the migration of the proxies there are two possible approaches:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Existing  proxies may be upgraded to version 3.1 with {yast} or <code class="command">zypper</code> migration.</p>
</li>
<li>
<p>Alternatively, the proxies may be replaced by new ones.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This section documents both approaches.</p>
</div>
<div class="sect2">
<h3 id="at.replacing.a.susemgrproxy"><a class="anchor" href="#at.replacing.a.susemgrproxy"></a><a class="link" href="#at.replacing.a.susemgrproxy">Replacing a SUSE Manager Proxy</a></h3>
<div class="paragraph">
<p>A SUSE Manager Proxy is <code>dumb</code> in the sense that it does not contain any information about the clients which are connected to it.
A SUSE Manager Proxy can therefore be replaced by a new one.
Naturally, the replacement proxy must have the same name and IP address as its predecessor.</p>
</div>
<div class="paragraph">
<p>In order to replace a SUSE Manager Proxy and keeping the clients registered to the proxy leave the old proxy in .
Create a reactivation key for this system and then register the new proxy using the reactivation key.
If you do not use the reactivation key, you will need to re-registered all the clients against the new proxy.</p>
</div>
<div id="proc.advanced.topics.proxy.migration3.replace" class="olist arabic">
<div class="title">Procedure: Replacing a SUSE Manager Proxyand Keeping the ClientsRegistered</div>
<ol class="arabic">
<li>
<p>Before starting the actual migration procedure, save the data from the old proxy, if needed.
Consider copying important data to a central place that can also be accessed by the new server:</p>
<div class="ulist">
<ul>
<li>
<p>Copy the scripts that are still needed.</p>
</li>
<li>
<p>Copy the activation keys from the previous server.
Of course, it is always better to re-create the keys.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Shutdown the server.</p>
</li>
<li>
<p>Install a new  3.1 Proxy, see <a href="#at.manager.proxy.inst-and-clients">Proxy Installation and Connecting Clients</a>.</p>
</li>
<li>
<p>In the SUSE Manager WebUI select the newly installed SUSE Manager Proxy and delete it from the systems list.</p>
</li>
<li>
<p>In the WebUI , create a reactivation key for the old proxy system: On the System Details of the old proxy click <span class="menuseq"><b class="menu">Reactivation</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">].
Then click menu:Generate New Key[</b></span> , and remember it (write it on a piece of paper or copy it to the clipboard).
For more information about reactivation keys, see <a href="#s5-sm-system-details-react">[s5-sm-system-details-react]</a>.</p>
</li>
<li>
<p>After the installation of the new proxy, perform the following actions (if needed):</p>
<div class="ulist">
<ul>
<li>
<p>Copy the centrally saved data to the new proxy system.</p>
</li>
<li>
<p>Install any other needed software.</p>
</li>
<li>
<p>If the proxy is also used for autoinstallation, do not forget to setup TFTP synchronization.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
<div class="title">Proxy Installation and Client Connections</div>
<div class="paragraph">
<p>During the installation of the proxy, clients will not be able to reach the  server.
After a SUSE Manager Proxy system has been deleted from the systems list, all clients connected to this proxy will be (incorrectly) listed as <code>directly connected</code> to the  server.
After the first successful operation on a client <em>such as execution of a remote command or installation of a package or patch</em> this information will automatically be corrected.
This may take a few hours.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="at.upgrade.a.susemgrproxy"><a class="anchor" href="#at.upgrade.a.susemgrproxy"></a><a class="link" href="#at.upgrade.a.susemgrproxy">Upgrading a SUSE Manager Proxy from 3 to 3.1</a></h3>
<div class="paragraph">
<p>In most situations upgrading the proxy will be your preferred solution as this retains all cached packages.
Selecting this route saves time especially regarding proxies connected to  server via low-bandwith links.
This upgrade is similar to a standard client migration.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title=":warning:"></i>
</td>
<td class="content">
<div class="title">Synchronizing Target Channels</div>
<div class="paragraph">
<p>Before successfully initializing the product migration, you first must make sure that the migration target channels are completely mirrored.
For the upgrade to  3.1 Proxy, at least the <code class="systemitem">SUSE Linux Enterprise Server 12 SP3</code> base channel with the <code class="systemitem">SUSE Manager Proxy 3.1</code> child channel for your architecture is required.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure: Migrating Proxy to 3.1</div>
<ol class="arabic">
<li>
<p>Direct your browser to the WebUI where your proxy is registered, and login.</p>
</li>
<li>
<p>On the <span class="menuseq"><b class="menu">Systems</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Systems</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Proxy</b></span> page select your proxy client system from the table.</p>
<div class="imageblock">
<div class="content">
<img src="_images/suma_proxy_old_details_page.png" alt="suma proxy old details page">
</div>
</div>
</li>
<li>
<p>On the system&#8217;s detail page select the <span class="menuseq"><b class="menu">Software</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">] tab</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">then the menu:SP Migration[</b></span> tab.</p>
<div class="imageblock">
<div class="content">
<img src="_images/suma_proxy_old_details_spmigration.png" alt="suma proxy old details spmigration">
</div>
</div>
</li>
<li>
<p>From this page you will see installed products listed on your proxy client, and the available target products.
Select the wanted <b class="menuref">Target Products</b> , which include <code class="systemitem">SUSE Linux Enterprise Server 12 SP3</code> and <code class="systemitem">SUSE Manager Proxy 3.1</code> .</p>
<div class="imageblock">
<div class="content">
<img src="_images/suma_proxy_migration_target.png" alt="suma proxy migration target">
</div>
</div>
<div class="paragraph">
<p>Then confirm with <b class="menuref">Select Channels</b>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/suma_proxy_migration_channels.png" alt="suma proxy migration channels">
</div>
</div>
</li>
<li>
<p>From the <b class="menuref">Schedule Migration</b> menu, and then <b class="button">Confirm</b> .</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Check the <b class="menuref">System Status</b> on the system&#8217;s details when the migration is done.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/suma_proxy_migrated.png" alt="suma proxy migrated">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
<div class="title">Checking <code>refresh_pattern</code> in <code class="path">/etc/squid/squid.conf</code></div>
<div class="paragraph">
<p>If you migrate from an early SUSE Manager Proxy 3.0 add the following <code>refresh_pattern</code> to <code class="path">/etc/squid/squid.conf</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># salt minions get the repodata via a different URL
refresh_pattern /rhn/manager/download/.*/repodata/.*$ 0 1% 1440 ignore-no-cache reload-into-ims refresh-ims</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finally consider scheduling a reboot.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="advanced.topics.proxy.migration"><a class="anchor" href="#advanced.topics.proxy.migration"></a><a class="link" href="#advanced.topics.proxy.migration">Migrating   2.1 Proxy to Version 3.1</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>For the migration of  2.1 Proxies there are two possible approaches&#8212;&#8203;this section documents both approaches:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Existing  proxies may be replaced by newly installed and reconfigured proxies, see <a href="#advanced.topics.proxy.migration.replace">Replacing a SUSE Manager Proxy</a>.
This is the recommended method.</p>
</li>
<li>
<p>Proxies may be auto-upgraded to version 3.1 by means of {yast} auto-installation, see <a href="#advanced.topics.proxy.migration.upgrade">Upgrading a SUSE Manager Proxy from 2.1 to 3.1</a>.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title=":bulb:"></i>
</td>
<td class="content">
<div class="title">Order of Server and Proxy Migration</div>
<div class="paragraph">
<p>The recommended order for migrations is to first migrate the server and then the proxies.
A  2.1 Proxy works correctly with  3.1.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="advanced.topics.proxy.migration.replace"><a class="anchor" href="#advanced.topics.proxy.migration.replace"></a><a class="link" href="#advanced.topics.proxy.migration.replace">Replacing a SUSE Manager Proxy</a></h3>
<div class="paragraph">
<p>A SUSE Manager Proxy is <code>dumb</code> in the sense that it does not contain any information about the clients which are connected to it.
A SUSE Manager Proxy can therefore be replaced by a new one.
The replacement proxy must have the same name and IP address as its predecessor.</p>
</div>
<div class="paragraph">
<p>In order to replace a SUSE Manager Proxy and keeping the clients registered to the proxy leave the old proxy in .
Create a reactivation key for this system and then register the new proxy using the reactivation key.
If you do not use the reactivation key, you will need to re-registered all the clients against the new proxy.</p>
</div>
<div id="proc.advanced.topics.proxy.migration21.replace" class="olist arabic">
<div class="title">Procedure: Replacing a SUSE Manager Proxyand Keeping the ClientsRegistered</div>
<ol class="arabic">
<li>
<p>Before starting the actual migration procedure, save the important data from the old proxy.
Copy the data to a central place that also the new server can access:</p>
<div class="ulist">
<ul>
<li>
<p>Copy the scripts that are still needed.</p>
</li>
<li>
<p>Copy the activation keys from the existing server.
Of course, it is always better to re-create the keys.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Shutdown the server.</p>
</li>
<li>
<p>Install a new  3.1 Proxy, see <a href="#at.manager.proxy.inst-and-clients">Proxy Installation and Connecting Clients</a>.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
<div class="title">Proxy Installation and Client Connections</div>
<div class="paragraph">
<p>During the installation of the proxy, clients will not be able to reach the  server.
After a SUSE Manager Proxy system has been deleted from the systems list, all clients connected to this proxy will be (incorrectly) listed as <code>directly connected</code> to the  server.
After the first successful operation on a client <em>such as execution of a remote command or installation of a package or patch</em> this information will automatically be corrected.
This may take a few hours.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the SUSE Manager WebUI select the newly installed SUSE Manager Proxy and delete it from the systems list.</p>
</li>
<li>
<p>In the WebUI , create a reactivation key for the old proxy system: On the System Details of the old proxy click <span class="menuseq"><b class="menu">Reactivation</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">].
Then click menu:Generate New Key[</b></span> , and remember it (write it on a piece of paper or copy it to the clipboard).
For more information about reactivation keys, see <a href="#s5-sm-system-details-react">[s5-sm-system-details-react]</a>.</p>
</li>
<li>
<p>After the installation of the new proxy, perform the following actions (if needed):</p>
<div class="ulist">
<ul>
<li>
<p>Copy the centrally saved data back to the new proxy system.</p>
</li>
<li>
<p>Install any other needed software.</p>
</li>
<li>
<p>If the proxy is also used for autoinstallation, do not forget to setup TFTP synchronization.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="advanced.topics.proxy.migration.upgrade"><a class="anchor" href="#advanced.topics.proxy.migration.upgrade"></a><a class="link" href="#advanced.topics.proxy.migration.upgrade">Upgrading a SUSE Manager Proxy from 2.1 to 3.1</a></h3>
<div class="paragraph">
<p>In other situations upgrading the proxy will be the preferred solution as it retains all cached packages.
This route saves time especially regarding proxies connected to a  server via low-bandwith links.
This upgrade can be automated by using the {yast} auto-installation feature.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: Upgrading SUSE Manager Proxyfrom 2.1 to 3.1</div>
<ol class="arabic">
<li>
<p>Create an auto-installable distribution based on SLES 12 SP3.
 3.1 Proxy is an add-on for SLES 12 SP3.
Refer to the <a href="#ref.webui.systems.autoinst">[ref.webui.systems.autoinst]</a> on creating an auto-installable distribution.</p>
</li>
<li>
<p>To start the auto-installation of a proxy, some additional packages must be installed that are only available in the  Tools channel.
These tools were not available for proxies when in the past the system was shipped as an appliance.
To gain access to the required packages for use with proxies, the underlying SLES 11 SP3 channel (<code class="systemitem">SLES11-SP3-SUSE-Manager-Tools</code> ) needs to be cloned and assigned to the to-be-upgraded proxies.
After these steps have been completed, create an auto-installation profile.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In the following example you will see an auto-install profile.
The label <code>Proxy31</code> is used both for the auto-installable distribution as well as for the auto-install profile.
Use the following auto-installation as template and create the auto-installation profile by uploading the edited file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE profile&gt;
&lt;profile xmlns="http://www.suse.com/1.0/yast2ns"
         xmlns:config="http://www.suse.com/1.0/configns"&gt;
  &lt;general&gt;
  $SNIPPET('spacewalk/sles_no_signature_checks')
    &lt;mode&gt;
      &lt;confirm config:type="boolean"&gt;false&lt;/confirm&gt;
    &lt;/mode&gt;
  &lt;/general&gt;
  &lt;add-on&gt;
    &lt;add_on_products config:type="list"&gt;
      &lt;listentry&gt;
        &lt;ask_on_error config:type="boolean"&gt;true&lt;/ask_on_error&gt;
        &lt;media_url&gt;http://$redhat_management_server/ks/dist/child/sles12-sp3-updates-x86_64/Proxy31&lt;/media_url&gt;
        &lt;name&gt;SLES12 SP3 Updates&lt;/name&gt;
        &lt;product&gt;SLES12-SP3&lt;/product&gt;
        &lt;product_dir&gt;/&lt;/product_dir&gt;
      &lt;/listentry&gt;
      &lt;listentry&gt;
        &lt;ask_on_error config:type="boolean"&gt;true&lt;/ask_on_error&gt;
        &lt;media_url&gt;http://$redhat_management_server/ks/dist/child/sle-manager-tools12-pool-x86_64-sp3/Proxy31&lt;/media_url&gt;
        &lt;name&gt;SLE12 Manager Tools Pool&lt;/name&gt;
        &lt;product&gt;SLES12&lt;/product&gt;
        &lt;product_dir&gt;/&lt;/product_dir&gt;
      &lt;/listentry&gt;
      &lt;listentry&gt;
        &lt;ask_on_error config:type="boolean"&gt;true&lt;/ask_on_error&gt;
        &lt;media_url&gt;http://$redhat_management_server/ks/dist/child/sle-manager-tools12-updates-x86_64-sp3/Proxy31&lt;/media_url&gt;
        &lt;name&gt;SLE12 Manager Tools Updates&lt;/name&gt;
        &lt;product&gt;SLES12&lt;/product&gt;
        &lt;product_dir&gt;/&lt;/product_dir&gt;
      &lt;/listentry&gt;
      &lt;listentry&gt;
        &lt;ask_on_error config:type="boolean"&gt;true&lt;/ask_on_error&gt;
        &lt;media_url&gt;http://$redhat_management_server/ks/dist/child/suse-manager-proxy-3.1-pool-x86_64/Proxy31&lt;/media_url&gt;
        &lt;name&gt;SLE12 Proxy 3.1 Pool&lt;/name&gt;
        &lt;product&gt;SLES12&lt;/product&gt;
        &lt;product_dir&gt;/&lt;/product_dir&gt;
      &lt;/listentry&gt;
      &lt;listentry&gt;
        &lt;ask_on_error config:type="boolean"&gt;true&lt;/ask_on_error&gt;
        &lt;media_url&gt;http://$redhat_management_server/ks/dist/child/suse-manager-proxy-3.1-updates-x86_64/Proxy31&lt;/media_url&gt;
        &lt;name&gt;SLE12 Proxy 3.1 Update&lt;/name&gt;
        &lt;product&gt;SLES12&lt;/product&gt;
        &lt;product_dir&gt;/&lt;/product_dir&gt;
      &lt;/listentry&gt;
    &lt;/add_on_products&gt;
  &lt;/add-on&gt;
  &lt;upgrade&gt;
    &lt;only_installed_packages config:type="boolean"&gt;false&lt;/only_installed_packages&gt;
    &lt;stop_on_solver_conflict config:type="boolean"&gt;true&lt;/stop_on_solver_conflict&gt;
  &lt;/upgrade&gt;
  &lt;backup&gt;
    &lt;sysconfig config:type="boolean"&gt;true&lt;/sysconfig&gt;
    &lt;modified config:type="boolean"&gt;true&lt;/modified&gt;
    &lt;remove_old config:type="boolean"&gt;false&lt;/remove_old&gt;
  &lt;/backup&gt;
  &lt;networking&gt;
    &lt;keep_install_network config:type="boolean"&gt;true&lt;/keep_install_network&gt;
    &lt;start_immediately config:type="boolean"&gt;true&lt;/start_immediately&gt;
  &lt;/networking&gt;
  &lt;scripts&gt;
    &lt;pre-scripts config:type="list"&gt;
      &lt;script&gt;
        &lt;filename&gt;remove_initrd_koan.sh&lt;/filename&gt;
        &lt;source&gt;

        mount /dev/sda1 /mnt
        rm -f /mnt/initrd_koan
        umount /mnt

        &lt;/source&gt;
      &lt;/script&gt;
    &lt;/pre-scripts&gt;
    &lt;chroot-scripts config:type="list"&gt;
      &lt;script&gt;
        &lt;filename&gt;migration_fix_script.sh&lt;/filename&gt;
        &lt;chrooted config:type="boolean"&gt;true&lt;/chrooted&gt;
        &lt;source&gt;&lt;![CDATA[ ln -sf /usr/share/rhn/RHN-ORG-TRUSTED-SSL-CERT /etc/pki/trust/anchors/
/usr/sbin/update-ca-certificates ]]&gt;
&lt;/source&gt;
      &lt;/script&gt;
    &lt;/chroot-scripts&gt;
    &lt;init-scripts config:type="list"&gt;
      &lt;script&gt;
        &lt;filename&gt;sles_register.sh&lt;/filename&gt;
        &lt;source&gt;

         $SNIPPET('spacewalk/sles_register')
         chmod 640 /etc/sysconfig/rhn/systemid
         chown root:www /etc/sysconfig/rhn/systemid
         systemctl enable squid
         systemctl start squid

        &lt;/source&gt;
      &lt;/script&gt;
    &lt;/init-scripts&gt;
  &lt;/scripts&gt;
&lt;/profile&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Ensure all channels referenced in this file are available and fully synced.
Replace the label <code>Proxy31</code> with the correct reference chosen for your auto-installation profile.
It is recommended to create a new activation key, for example: <code>1-sles12sp3</code> which has the relevant channels assigned; later this key will be used to subscribe the upgraded proxy with the correct channels.
The following base channel should be assigned:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SLES12-SP3-Pool</pre>
</div>
</div>
<div class="paragraph">
<p>Also include the following child channels:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SLE-Manager-Tools12-Pool
SLE-Manager-Tools12-Updates
SLES12-SP3-Updates
SUSE-Manager-Proxy-3.1-Pool
SUSE-Manager-Proxy-3.1-Updates</pre>
</div>
</div>
<div class="paragraph">
<p>In <code>Kernel Options</code> enter the following value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>autoupgrade=1 Y2DEBUG=1</pre>
</div>
</div>
<div class="paragraph">
<p>The debug setting is not required but can help investigate problems in case something goes wrong; the <code class="parameter">autoupgrade</code> parameter is vital! Do not remove it.</p>
</div>
<div class="paragraph">
<p>Save your changes then click on "Variables" and enter the following value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>registration_key=1-sles12sp3</pre>
</div>
</div>
<div class="paragraph">
<p>Specify the name of the key which has all respective channels assigned to it.
The auto-install file contains a script named <code class="command">remove_initrd_koan.sh</code>.
In this script you should specify the device name of your <code class="path">/boot</code> partition.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
<div class="title">remove_initrd_koan.sh</div>
<div class="paragraph">
<p>The purpose of this script is to act as a workaround for the following problem: During installation the initrd of the installation media (SLES12SP3) is in use.
This initrd is rather large (around 50 MB), so there is not enough space left when the new kernel is being installed.
Therefore this script deletes the initial ramdisk file once it has been booted.
The partition of your boot partition might differ, so it should be explicitly specified in the autoinstall file.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>During auto-installation this script attempts to delete the initial ramdisk file once it has booted.
Your boot partition may differ, so ensure it is explicitly specified within the auto-install file.</p>
</div>
<div class="paragraph">
<p>If this step is bypassed or mixed up (for example: specifying a wrong value) it&#8217;s fine.
During installation of the new kernel, {yast} will detect that there is not enough space available and will stop.
You may switch to another console (there is a shell running on virtual console 2) and reclaim some disk space by issuing the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>rm /mnt/boot/initrd_koan</pre>
</div>
</div>
<div class="paragraph">
<p>When you have completed this step, switch back to the console where {yast} is running (console 7) and click <b class="menuref">Retry</b>.
Installation of the kernel will continue and succeed.
The system will reboot, a few automated init scripts will run and the proxy will be upgraded to the  3.1 based on SLES12SP3 and will be fully functional.</p>
</div>
</div>
</div>
</div>
</article>
  </main>
</div>
<footer class="footer">
  <p>Copyright (C) 2017-2018 <a href="https://jcayouette.github.io/personal-blog">Belief and Reason</a></p>
  <p>Except where otherwise noted, jcayouette.github.io/personal-blog, BoR, are licensed under the <a href="https://www.mozilla.org/en-US/MPL/2.0/">Mozilla Public License Version 2.0</a> (MPL-2.0).</p>
</footer>
<script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<!-- fetched from https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js -->
<script>
function focusSearchInput () { document.querySelector('#search-input').focus() }
var search = docsearch({
  appId: '#',
  apiKey: '#',
  indexName: '#',
  inputSelector: '#search-input',
  autocompleteOptions: { hint: false, keyboardShortcuts: ['s'] },
  algoliaOptions: { hitsPerPage: 10 }
}).autocomplete
search.on('autocomplete:closed', function () { search.autocomplete.setVal() })
focusSearchInput()
window.addEventListener('load', focusSearchInput)
</script>
<script src="../../_/js/site.js"></script>
<script src="../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>
  </body>
</html>
